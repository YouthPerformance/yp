var Bi=Object.defineProperty;var hn=e=>{throw TypeError(e)};var Mi=(e,t,r)=>t in e?Bi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var A=(e,t,r)=>Mi(e,typeof t!="symbol"?t+"":t,r),Ni=(e,t,r)=>t.has(e)||hn("Cannot "+r);var M=(e,t,r)=>(Ni(e,t,"read from private field"),r?r.call(e):t.get(e)),ye=(e,t,r)=>t.has(e)?hn("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r);import{f as V,a as P,c as _e}from"../chunks/iRdQ0xtj.js";import{o as Hi,a as $i}from"../chunks/DZ-iLIYQ.js";import{h as dn,V as se,g as b,s as F,J as qi,O as G,T as We,M as Wi,K as Q,U as it,Q as K,P as pn,R as he}from"../chunks/CapEeF5M.js";import{s as Be}from"../chunks/BvqUIVqr.js";import{i as W}from"../chunks/CqVPvQJw.js";import{d as Vi}from"../chunks/Bvma8HCH.js";import{t as Gi,s as Sr}from"../chunks/CRBBPxwk.js";import{b as Ki}from"../chunks/D4Jhb63t.js";import{g as Zt}from"../chunks/CS0qxZ5J.js";import{X as $}from"../chunks/C52gXIN9.js";function Xi(e,t,r,n){var i=e.__style;if(dn||i!==t){var o=Gi(t);(!dn||o!==e.getAttribute("style"))&&(o==null?e.removeAttribute("style"):e.style.cssText=o),e.__style=t}return n}const Ji=!1,Zi=!1,Kl=Object.freeze(Object.defineProperty({__proto__:null,prerender:Zi,ssr:Ji},Symbol.toStringTag,{value:"Module"})),Yi={facingMode:"user",width:1280,height:720,frameRate:60};var Lt,zt,Bt,Mt;class Qi{constructor(t={}){ye(this,Lt,se(null));ye(this,zt,se(!1));ye(this,Bt,se(null));ye(this,Mt,se(0));A(this,"config");A(this,"videoTrack",null);this.config={...Yi,...t}}get stream(){return b(M(this,Lt))}set stream(t){F(M(this,Lt),t,!0)}get isActive(){return b(M(this,zt))}set isActive(t){F(M(this,zt),t,!0)}get error(){return b(M(this,Bt))}set error(t){F(M(this,Bt),t,!0)}get actualFrameRate(){return b(M(this,Mt))}set actualFrameRate(t){F(M(this,Mt),t,!0)}async start(){try{this.error=null;const t={video:{facingMode:this.config.facingMode,width:{ideal:this.config.width},height:{ideal:this.config.height},frameRate:{ideal:this.config.frameRate}},audio:!1},r=await navigator.mediaDevices.getUserMedia(t);this.stream=r,this.isActive=!0,this.videoTrack=r.getVideoTracks()[0];const n=this.videoTrack.getSettings();return this.actualFrameRate=n.frameRate??this.config.frameRate,r}catch(t){const r=t instanceof Error?t.message:"Camera access failed";throw this.error=r,r.includes("Permission denied")||r.includes("NotAllowedError")?new $("CAMERA_PERMISSION_DENIED","Camera permission was denied",!0):new $("CAPTURE_FAILED",r,!1)}}stop(){this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.videoTrack=null,this.isActive=!1}async switchCamera(){return this.config.facingMode=this.config.facingMode==="user"?"environment":"user",this.stop(),this.start()}getSettings(){var t;return((t=this.videoTrack)==null?void 0:t.getSettings())??null}getDimensions(){const t=this.getSettings();return{width:(t==null?void 0:t.width)??this.config.width,height:(t==null?void 0:t.height)??this.config.height}}}Lt=new WeakMap,zt=new WeakMap,Bt=new WeakMap,Mt=new WeakMap;async function eo(){const e=[],t=[],r="VideoEncoder"in window&&"VideoFrame"in window,n=r&&!mn();r&&mn()?e.push("WebCodecs disabled on iOS Safari due to compatibility issues - using MediaRecorder"):n||e.push("WebCodecs not available - using MediaRecorder fallback");const i="MediaRecorder"in window;!i&&!n&&t.push("Neither WebCodecs nor MediaRecorder available");const o="DeviceMotionEvent"in window;o||e.push("DeviceMotion not available - sensor data will be empty");let s=!1,u=!1;try{const v=await navigator.mediaDevices.enumerateDevices();s=v.some(S=>S.kind==="videoinput"),u=v.some(S=>S.kind==="audioinput"),s||t.push("No camera detected")}catch{t.push("Cannot enumerate media devices")}return{isCompatible:t.length===0&&(n||i),hasWebCodecs:n,hasMediaRecorder:i,hasDeviceMotion:o,hasCamera:s,hasMicrophone:u,warnings:e,errors:t}}async function to(){if(typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function")try{return await DeviceMotionEvent.requestPermission()==="granted"}catch{return!1}return!0}function mn(){const e=navigator.userAgent;return/iPad|iPhone|iPod/.test(e)&&!e.includes("CriOS")&&!e.includes("FxiOS")}class ro{constructor(){A(this,"samples",[]);A(this,"isCapturing",!1);A(this,"boundHandler");A(this,"permissionGranted",!1);this.boundHandler=this.handleMotion.bind(this)}async requestPermission(){return this.permissionGranted=await to(),this.permissionGranted}start(){this.isCapturing||(this.samples=[],this.isCapturing=!0,window.addEventListener("devicemotion",this.boundHandler,!0))}stop(){if(!this.isCapturing)return[];window.removeEventListener("devicemotion",this.boundHandler,!0),this.isCapturing=!1;const t=[...this.samples];return this.samples=[],t}getSampleCount(){return this.samples.length}isAvailable(){return"DeviceMotionEvent"in window}handleMotion(t){var n,i,o,s,u,h;if(!this.isCapturing)return;const r={timestamp:Date.now(),accelerationX:((n=t.accelerationIncludingGravity)==null?void 0:n.x)??0,accelerationY:((i=t.accelerationIncludingGravity)==null?void 0:i.y)??0,accelerationZ:((o=t.accelerationIncludingGravity)==null?void 0:o.z)??0,rotationAlpha:((s=t.rotationRate)==null?void 0:s.alpha)??null,rotationBeta:((u=t.rotationRate)==null?void 0:u.beta)??null,rotationGamma:((h=t.rotationRate)==null?void 0:h.gamma)??null};this.samples.push(r)}}function no(e){return JSON.stringify(e)}var qr=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},a=(e,t,r)=>(qr(e,t,"read from private field"),r?r.call(e):t.get(e)),E=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},ne=(e,t,r,n)=>(qr(e,t,"write to private field"),t.set(e,r),r),io=(e,t,r,n)=>({set _(i){ne(e,t,i)},get _(){return a(e,t,n)}}),U=(e,t,r)=>(qr(e,t,"access private method"),r),k=new Uint8Array(8),Pe=new DataView(k.buffer),ee=e=>[(e%256+256)%256],I=e=>(Pe.setUint16(0,e,!1),[k[0],k[1]]),oo=e=>(Pe.setInt16(0,e,!1),[k[0],k[1]]),Nn=e=>(Pe.setUint32(0,e,!1),[k[1],k[2],k[3]]),w=e=>(Pe.setUint32(0,e,!1),[k[0],k[1],k[2],k[3]]),ao=e=>(Pe.setInt32(0,e,!1),[k[0],k[1],k[2],k[3]]),Ze=e=>(Pe.setUint32(0,Math.floor(e/2**32),!1),Pe.setUint32(4,e,!1),[k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7]]),Wr=e=>(Pe.setInt16(0,2**8*e,!1),[k[0],k[1]]),Ue=e=>(Pe.setInt32(0,2**16*e,!1),[k[0],k[1],k[2],k[3]]),Cr=e=>(Pe.setInt32(0,2**30*e,!1),[k[0],k[1],k[2],k[3]]),ge=(e,t=!1)=>{let r=Array(e.length).fill(null).map((n,i)=>e.charCodeAt(i));return t&&r.push(0),r},lr=e=>e&&e[e.length-1],Vr=e=>{let t;for(let r of e)(!t||r.presentationTimestamp>t.presentationTimestamp)&&(t=r);return t},ke=(e,t,r=!0)=>{let n=e*t;return r?Math.round(n):n},Hn=e=>{let t=e*(Math.PI/180),r=Math.cos(t),n=Math.sin(t);return[r,n,0,-n,r,0,0,0,1]},$n=Hn(0),qn=e=>[Ue(e[0]),Ue(e[1]),Cr(e[2]),Ue(e[3]),Ue(e[4]),Cr(e[5]),Ue(e[6]),Ue(e[7]),Cr(e[8])],Tt=e=>!e||typeof e!="object"?e:Array.isArray(e)?e.map(Tt):Object.fromEntries(Object.entries(e).map(([t,r])=>[t,Tt(r)])),ht=e=>e>=0&&e<2**32,X=(e,t,r)=>({type:e,contents:t&&new Uint8Array(t.flat(10)),children:r}),z=(e,t,r,n,i)=>X(e,[ee(t),Nn(r),n??[]],i),so=e=>{let t=512;return e.fragmented?X("ftyp",[ge("iso5"),w(t),ge("iso5"),ge("iso6"),ge("mp41")]):X("ftyp",[ge("isom"),w(t),ge("isom"),e.holdsAvc?ge("avc1"):[],ge("mp41")])},xr=e=>({type:"mdat",largeSize:e}),lo=e=>({type:"free",size:e}),er=(e,t,r=!1)=>X("moov",null,[uo(t,e),...e.map(n=>fo(n,t)),r?Ho(e):null]),uo=(e,t)=>{let r=ke(Math.max(0,...t.filter(s=>s.samples.length>0).map(s=>{const u=Vr(s.samples);return u.presentationTimestamp+u.duration})),kr),n=Math.max(...t.map(s=>s.id))+1,i=!ht(e)||!ht(r),o=i?Ze:w;return z("mvhd",+i,0,[o(e),o(e),w(kr),o(r),Ue(1),Wr(1),Array(10).fill(0),qn($n),Array(24).fill(0),w(n)])},fo=(e,t)=>X("trak",null,[co(e,t),ho(e,t)]),co=(e,t)=>{let r=Vr(e.samples),n=ke(r?r.presentationTimestamp+r.duration:0,kr),i=!ht(t)||!ht(n),o=i?Ze:w,s;return e.info.type==="video"?s=typeof e.info.rotation=="number"?Hn(e.info.rotation):e.info.rotation:s=$n,z("tkhd",+i,3,[o(t),o(t),w(e.id),w(0),o(n),Array(8).fill(0),I(0),I(0),Wr(e.info.type==="audio"?1:0),I(0),qn(s),Ue(e.info.type==="video"?e.info.width:0),Ue(e.info.type==="video"?e.info.height:0)])},ho=(e,t)=>X("mdia",null,[po(e,t),mo(e.info.type==="video"?"vide":"soun"),vo(e)]),po=(e,t)=>{let r=Vr(e.samples),n=ke(r?r.presentationTimestamp+r.duration:0,e.timescale),i=!ht(t)||!ht(n),o=i?Ze:w;return z("mdhd",+i,0,[o(t),o(t),w(e.timescale),o(n),I(21956),I(0)])},mo=e=>z("hdlr",0,0,[ge("mhlr"),ge(e),w(0),w(0),w(0),ge("mp4-muxer-hdlr",!0)]),vo=e=>X("minf",null,[e.info.type==="video"?yo():go(),bo(),So(e)]),yo=()=>z("vmhd",0,1,[I(0),I(0),I(0),I(0)]),go=()=>z("smhd",0,0,[I(0),I(0)]),bo=()=>X("dinf",null,[wo()]),wo=()=>z("dref",0,0,[w(1)],[_o()]),_o=()=>z("url ",0,1),So=e=>{const t=e.compositionTimeOffsetTable.length>1||e.compositionTimeOffsetTable.some(r=>r.sampleCompositionTimeOffset!==0);return X("stbl",null,[Co(e),jo(e),Lo(e),zo(e),Bo(e),Mo(e),t?No(e):null])},Co=e=>z("stsd",0,0,[w(1)],[e.info.type==="video"?To(Yo[e.info.codec],e):Io(ea[e.info.codec],e)]),To=(e,t)=>X(e,[Array(6).fill(0),I(1),I(0),I(0),Array(12).fill(0),I(t.info.width),I(t.info.height),w(4718592),w(4718592),w(0),I(1),Array(32).fill(0),I(24),oo(65535)],[Qo[t.info.codec](t),t.info.decoderConfig.colorSpace?ko(t):null]),xo={bt709:1,bt470bg:5,smpte170m:6},Eo={bt709:1,smpte170m:6,"iec61966-2-1":13},Uo={rgb:0,bt709:1,bt470bg:5,smpte170m:6},ko=e=>X("colr",[ge("nclx"),I(xo[e.info.decoderConfig.colorSpace.primaries]),I(Eo[e.info.decoderConfig.colorSpace.transfer]),I(Uo[e.info.decoderConfig.colorSpace.matrix]),ee((e.info.decoderConfig.colorSpace.fullRange?1:0)<<7)]),Oo=e=>e.info.decoderConfig&&X("avcC",[...new Uint8Array(e.info.decoderConfig.description)]),Po=e=>e.info.decoderConfig&&X("hvcC",[...new Uint8Array(e.info.decoderConfig.description)]),Ro=e=>{if(!e.info.decoderConfig)return null;let t=e.info.decoderConfig;if(!t.colorSpace)throw new Error("'colorSpace' is required in the decoder config for VP9.");let r=t.codec.split("."),n=Number(r[1]),i=Number(r[2]),u=(Number(r[3])<<4)+(0<<1)+Number(t.colorSpace.fullRange);return z("vpcC",1,0,[ee(n),ee(i),ee(u),ee(2),ee(2),ee(2),I(0)])},Ao=()=>{let r=(1<<7)+1;return X("av1C",[r,0,0,0])},Io=(e,t)=>X(e,[Array(6).fill(0),I(1),I(0),I(0),w(0),I(t.info.numberOfChannels),I(16),I(0),I(0),Ue(t.info.sampleRate)],[ta[t.info.codec](t)]),Do=e=>{let t=new Uint8Array(e.info.decoderConfig.description);return z("esds",0,0,[w(58753152),ee(32+t.byteLength),I(1),ee(0),w(75530368),ee(18+t.byteLength),ee(64),ee(21),Nn(0),w(130071),w(130071),w(92307584),ee(t.byteLength),...t,w(109084800),ee(1),ee(2)])},Fo=e=>{var i;let t=3840,r=0;const n=(i=e.info.decoderConfig)==null?void 0:i.description;if(n){if(n.byteLength<18)throw new TypeError("Invalid decoder description provided for Opus; must be at least 18 bytes long.");const o=ArrayBuffer.isView(n)?new DataView(n.buffer,n.byteOffset,n.byteLength):new DataView(n);t=o.getUint16(10,!0),r=o.getInt16(14,!0)}return X("dOps",[ee(0),ee(e.info.numberOfChannels),I(t),w(e.info.sampleRate),Wr(r),ee(0)])},jo=e=>z("stts",0,0,[w(e.timeToSampleTable.length),e.timeToSampleTable.map(t=>[w(t.sampleCount),w(t.sampleDelta)])]),Lo=e=>{if(e.samples.every(r=>r.type==="key"))return null;let t=[...e.samples.entries()].filter(([,r])=>r.type==="key");return z("stss",0,0,[w(t.length),t.map(([r])=>w(r+1))])},zo=e=>z("stsc",0,0,[w(e.compactlyCodedChunkTable.length),e.compactlyCodedChunkTable.map(t=>[w(t.firstChunk),w(t.samplesPerChunk),w(1)])]),Bo=e=>z("stsz",0,0,[w(0),w(e.samples.length),e.samples.map(t=>w(t.size))]),Mo=e=>e.finalizedChunks.length>0&&lr(e.finalizedChunks).offset>=2**32?z("co64",0,0,[w(e.finalizedChunks.length),e.finalizedChunks.map(t=>Ze(t.offset))]):z("stco",0,0,[w(e.finalizedChunks.length),e.finalizedChunks.map(t=>w(t.offset))]),No=e=>z("ctts",0,0,[w(e.compositionTimeOffsetTable.length),e.compositionTimeOffsetTable.map(t=>[w(t.sampleCount),w(t.sampleCompositionTimeOffset)])]),Ho=e=>X("mvex",null,e.map($o)),$o=e=>z("trex",0,0,[w(e.id),w(1),w(0),w(0),w(0)]),vn=(e,t)=>X("moof",null,[qo(e),...t.map(Wo)]),qo=e=>z("mfhd",0,0,[w(e)]),Wn=e=>{let t=0,r=0,n=0,i=0,o=e.type==="delta";return r|=+o,o?t|=1:t|=2,t<<24|r<<16|n<<8|i},Wo=e=>X("traf",null,[Vo(e),Go(e),Ko(e)]),Vo=e=>{let t=0;t|=8,t|=16,t|=32,t|=131072;let r=e.currentChunk.samples[1]??e.currentChunk.samples[0],n={duration:r.timescaleUnitsToNextSample,size:r.size,flags:Wn(r)};return z("tfhd",0,t,[w(e.id),w(n.duration),w(n.size),w(n.flags)])},Go=e=>z("tfdt",1,0,[Ze(ke(e.currentChunk.startTimestamp,e.timescale))]),Ko=e=>{let t=e.currentChunk.samples.map(B=>B.timescaleUnitsToNextSample),r=e.currentChunk.samples.map(B=>B.size),n=e.currentChunk.samples.map(Wn),i=e.currentChunk.samples.map(B=>ke(B.presentationTimestamp-B.decodeTimestamp,e.timescale)),o=new Set(t),s=new Set(r),u=new Set(n),h=new Set(i),v=u.size===2&&n[0]!==n[1],S=o.size>1,g=s.size>1,J=!v&&u.size>1,me=h.size>1||[...h].some(B=>B!==0),j=0;return j|=1,j|=4*+v,j|=256*+S,j|=512*+g,j|=1024*+J,j|=2048*+me,z("trun",1,j,[w(e.currentChunk.samples.length),w(e.currentChunk.offset-e.currentChunk.moofOffset||0),v?w(n[0]):[],e.currentChunk.samples.map((B,D)=>[S?w(t[D]):[],g?w(r[D]):[],J?w(n[D]):[],me?ao(i[D]):[]])])},Xo=e=>X("mfra",null,[...e.map(Jo),Zo()]),Jo=(e,t)=>z("tfra",1,0,[w(e.id),w(63),w(e.finalizedChunks.length),e.finalizedChunks.map(n=>[Ze(ke(n.startTimestamp,e.timescale)),Ze(n.moofOffset),w(t+1),w(1),w(1)])]),Zo=()=>z("mfro",0,0,[w(0)]),Yo={avc:"avc1",hevc:"hvc1",vp9:"vp09",av1:"av01"},Qo={avc:Oo,hevc:Po,vp9:Ro,av1:Ao},ea={aac:"mp4a",opus:"Opus"},ta={aac:Do,opus:Fo},yr=class{},Vn=class extends yr{constructor(){super(...arguments),this.buffer=null}},Gn=class extends yr{constructor(e){if(super(),this.options=e,typeof e!="object")throw new TypeError("StreamTarget requires an options object to be passed to its constructor.");if(e.onData){if(typeof e.onData!="function")throw new TypeError("options.onData, when provided, must be a function.");if(e.onData.length<2)throw new TypeError("options.onData, when provided, must be a function that takes in at least two arguments (data and position). Ignoring the position argument, which specifies the byte offset at which the data is to be written, can lead to broken outputs.")}if(e.chunked!==void 0&&typeof e.chunked!="boolean")throw new TypeError("options.chunked, when provided, must be a boolean.");if(e.chunkSize!==void 0&&(!Number.isInteger(e.chunkSize)||e.chunkSize<1024))throw new TypeError("options.chunkSize, when provided, must be an integer and not smaller than 1024.")}},ra=class extends yr{constructor(e,t){if(super(),this.stream=e,this.options=t,!(e instanceof FileSystemWritableFileStream))throw new TypeError("FileSystemWritableFileStreamTarget requires a FileSystemWritableFileStream instance.");if(t!==void 0&&typeof t!="object")throw new TypeError("FileSystemWritableFileStreamTarget's options, when provided, must be an object.");if(t&&t.chunkSize!==void 0&&(!Number.isInteger(t.chunkSize)||t.chunkSize<=0))throw new TypeError("options.chunkSize, when provided, must be a positive integer")}},Ve,at,Kn=class{constructor(){this.pos=0,E(this,Ve,new Uint8Array(8)),E(this,at,new DataView(a(this,Ve).buffer)),this.offsets=new WeakMap}seek(e){this.pos=e}writeU32(e){a(this,at).setUint32(0,e,!1),this.write(a(this,Ve).subarray(0,4))}writeU64(e){a(this,at).setUint32(0,Math.floor(e/2**32),!1),a(this,at).setUint32(4,e,!1),this.write(a(this,Ve).subarray(0,8))}writeAscii(e){for(let t=0;t<e.length;t++)a(this,at).setUint8(t%8,e.charCodeAt(t)),t%8===7&&this.write(a(this,Ve));e.length%8!==0&&this.write(a(this,Ve).subarray(0,e.length%8))}writeBox(e){if(this.offsets.set(e,this.pos),e.contents&&!e.children)this.writeBoxHeader(e,e.size??e.contents.byteLength+8),this.write(e.contents);else{let t=this.pos;if(this.writeBoxHeader(e,0),e.contents&&this.write(e.contents),e.children)for(let i of e.children)i&&this.writeBox(i);let r=this.pos,n=e.size??r-t;this.seek(t),this.writeBoxHeader(e,n),this.seek(r)}}writeBoxHeader(e,t){this.writeU32(e.largeSize?1:t),this.writeAscii(e.type),e.largeSize&&this.writeU64(t)}measureBoxHeader(e){return 8+(e.largeSize?8:0)}patchBox(e){let t=this.pos;this.seek(this.offsets.get(e)),this.writeBox(e),this.seek(t)}measureBox(e){if(e.contents&&!e.children)return this.measureBoxHeader(e)+e.contents.byteLength;{let t=this.measureBoxHeader(e);if(e.contents&&(t+=e.contents.byteLength),e.children)for(let r of e.children)r&&(t+=this.measureBox(r));return t}}};Ve=new WeakMap;at=new WeakMap;var tr,Je,Ot,wt,rr,Er,na=class extends Kn{constructor(e){super(),E(this,rr),E(this,tr,void 0),E(this,Je,new ArrayBuffer(2**16)),E(this,Ot,new Uint8Array(a(this,Je))),E(this,wt,0),ne(this,tr,e)}write(e){U(this,rr,Er).call(this,this.pos+e.byteLength),a(this,Ot).set(e,this.pos),this.pos+=e.byteLength,ne(this,wt,Math.max(a(this,wt),this.pos))}finalize(){U(this,rr,Er).call(this,this.pos),a(this,tr).buffer=a(this,Je).slice(0,Math.max(a(this,wt),this.pos))}};tr=new WeakMap;Je=new WeakMap;Ot=new WeakMap;wt=new WeakMap;rr=new WeakSet;Er=function(e){let t=a(this,Je).byteLength;for(;t<e;)t*=2;if(t===a(this,Je).byteLength)return;let r=new ArrayBuffer(t),n=new Uint8Array(r);n.set(a(this,Ot),0),ne(this,Je,r),ne(this,Ot,n)};var ia=2**24,oa=2,xt,Ge,_t,je,pe,ur,Ur,Gr,Xn,Kr,Jn,Et,fr,Xr=class extends Kn{constructor(e){var t,r;super(),E(this,ur),E(this,Gr),E(this,Kr),E(this,Et),E(this,xt,void 0),E(this,Ge,[]),E(this,_t,void 0),E(this,je,void 0),E(this,pe,[]),ne(this,xt,e),ne(this,_t,((t=e.options)==null?void 0:t.chunked)??!1),ne(this,je,((r=e.options)==null?void 0:r.chunkSize)??ia)}write(e){a(this,Ge).push({data:e.slice(),start:this.pos}),this.pos+=e.byteLength}flush(){var r,n;if(a(this,Ge).length===0)return;let e=[],t=[...a(this,Ge)].sort((i,o)=>i.start-o.start);e.push({start:t[0].start,size:t[0].data.byteLength});for(let i=1;i<t.length;i++){let o=e[e.length-1],s=t[i];s.start<=o.start+o.size?o.size=Math.max(o.size,s.start+s.data.byteLength-o.start):e.push({start:s.start,size:s.data.byteLength})}for(let i of e){i.data=new Uint8Array(i.size);for(let o of a(this,Ge))i.start<=o.start&&o.start<i.start+i.size&&i.data.set(o.data,o.start-i.start);a(this,_t)?(U(this,ur,Ur).call(this,i.data,i.start),U(this,Et,fr).call(this)):(n=(r=a(this,xt).options).onData)==null||n.call(r,i.data,i.start)}a(this,Ge).length=0}finalize(){a(this,_t)&&U(this,Et,fr).call(this,!0)}};xt=new WeakMap;Ge=new WeakMap;_t=new WeakMap;je=new WeakMap;pe=new WeakMap;ur=new WeakSet;Ur=function(e,t){let r=a(this,pe).findIndex(u=>u.start<=t&&t<u.start+a(this,je));r===-1&&(r=U(this,Kr,Jn).call(this,t));let n=a(this,pe)[r],i=t-n.start,o=e.subarray(0,Math.min(a(this,je)-i,e.byteLength));n.data.set(o,i);let s={start:i,end:i+o.byteLength};if(U(this,Gr,Xn).call(this,n,s),n.written[0].start===0&&n.written[0].end===a(this,je)&&(n.shouldFlush=!0),a(this,pe).length>oa){for(let u=0;u<a(this,pe).length-1;u++)a(this,pe)[u].shouldFlush=!0;U(this,Et,fr).call(this)}o.byteLength<e.byteLength&&U(this,ur,Ur).call(this,e.subarray(o.byteLength),t+o.byteLength)};Gr=new WeakSet;Xn=function(e,t){let r=0,n=e.written.length-1,i=-1;for(;r<=n;){let o=Math.floor(r+(n-r+1)/2);e.written[o].start<=t.start?(r=o+1,i=o):n=o-1}for(e.written.splice(i+1,0,t),(i===-1||e.written[i].end<t.start)&&i++;i<e.written.length-1&&e.written[i].end>=e.written[i+1].start;)e.written[i].end=Math.max(e.written[i].end,e.written[i+1].end),e.written.splice(i+1,1)};Kr=new WeakSet;Jn=function(e){let r={start:Math.floor(e/a(this,je))*a(this,je),data:new Uint8Array(a(this,je)),written:[],shouldFlush:!1};return a(this,pe).push(r),a(this,pe).sort((n,i)=>n.start-i.start),a(this,pe).indexOf(r)};Et=new WeakSet;fr=function(e=!1){var t,r;for(let n=0;n<a(this,pe).length;n++){let i=a(this,pe)[n];if(!(!i.shouldFlush&&!e)){for(let o of i.written)(r=(t=a(this,xt).options).onData)==null||r.call(t,i.data.subarray(o.start,o.end),i.start+o.start);a(this,pe).splice(n--,1)}}};var aa=class extends Xr{constructor(e){var t;super(new Gn({onData:(r,n)=>e.stream.write({type:"write",data:r,position:n}),chunked:!0,chunkSize:(t=e.options)==null?void 0:t.chunkSize}))}},kr=1e3,sa=["avc","hevc","vp9","av1"],la=["aac","opus"],ua=2082844800,fa=["strict","offset","cross-track-offset"],_,C,cr,de,oe,re,lt,ft,Jr,Ke,Xe,Ut,Or,Zn,Pr,Yn,Zr,Qn,Rr,ei,Yr,ti,nr,Ar,Ee,Fe,Qr,ri,kt,hr,dr,en,dt,Kt,ir,Ir,ca=class{constructor(e){if(E(this,Or),E(this,Pr),E(this,Zr),E(this,Rr),E(this,Yr),E(this,nr),E(this,Ee),E(this,Qr),E(this,kt),E(this,dr),E(this,dt),E(this,ir),E(this,_,void 0),E(this,C,void 0),E(this,cr,void 0),E(this,de,void 0),E(this,oe,null),E(this,re,null),E(this,lt,Math.floor(Date.now()/1e3)+ua),E(this,ft,[]),E(this,Jr,1),E(this,Ke,[]),E(this,Xe,[]),E(this,Ut,!1),U(this,Or,Zn).call(this,e),e.video=Tt(e.video),e.audio=Tt(e.audio),e.fastStart=Tt(e.fastStart),this.target=e.target,ne(this,_,{firstTimestampBehavior:"strict",...e}),e.target instanceof Vn)ne(this,C,new na(e.target));else if(e.target instanceof Gn)ne(this,C,new Xr(e.target));else if(e.target instanceof ra)ne(this,C,new aa(e.target));else throw new Error(`Invalid target: ${e.target}`);U(this,Rr,ei).call(this),U(this,Pr,Yn).call(this)}addVideoChunk(e,t,r,n){if(!(e instanceof EncodedVideoChunk))throw new TypeError("addVideoChunk's first argument (sample) must be of type EncodedVideoChunk.");if(t&&typeof t!="object")throw new TypeError("addVideoChunk's second argument (meta), when provided, must be an object.");if(r!==void 0&&(!Number.isFinite(r)||r<0))throw new TypeError("addVideoChunk's third argument (timestamp), when provided, must be a non-negative real number.");if(n!==void 0&&!Number.isFinite(n))throw new TypeError("addVideoChunk's fourth argument (compositionTimeOffset), when provided, must be a real number.");let i=new Uint8Array(e.byteLength);e.copyTo(i),this.addVideoChunkRaw(i,e.type,r??e.timestamp,e.duration,t,n)}addVideoChunkRaw(e,t,r,n,i,o){if(!(e instanceof Uint8Array))throw new TypeError("addVideoChunkRaw's first argument (data) must be an instance of Uint8Array.");if(t!=="key"&&t!=="delta")throw new TypeError("addVideoChunkRaw's second argument (type) must be either 'key' or 'delta'.");if(!Number.isFinite(r)||r<0)throw new TypeError("addVideoChunkRaw's third argument (timestamp) must be a non-negative real number.");if(!Number.isFinite(n)||n<0)throw new TypeError("addVideoChunkRaw's fourth argument (duration) must be a non-negative real number.");if(i&&typeof i!="object")throw new TypeError("addVideoChunkRaw's fifth argument (meta), when provided, must be an object.");if(o!==void 0&&!Number.isFinite(o))throw new TypeError("addVideoChunkRaw's sixth argument (compositionTimeOffset), when provided, must be a real number.");if(U(this,ir,Ir).call(this),!a(this,_).video)throw new Error("No video track declared.");if(typeof a(this,_).fastStart=="object"&&a(this,oe).samples.length===a(this,_).fastStart.expectedVideoChunks)throw new Error(`Cannot add more video chunks than specified in 'fastStart' (${a(this,_).fastStart.expectedVideoChunks}).`);let s=U(this,nr,Ar).call(this,a(this,oe),e,t,r,n,i,o);if(a(this,_).fastStart==="fragmented"&&a(this,re)){for(;a(this,Xe).length>0&&a(this,Xe)[0].decodeTimestamp<=s.decodeTimestamp;){let u=a(this,Xe).shift();U(this,Ee,Fe).call(this,a(this,re),u)}s.decodeTimestamp<=a(this,re).lastDecodeTimestamp?U(this,Ee,Fe).call(this,a(this,oe),s):a(this,Ke).push(s)}else U(this,Ee,Fe).call(this,a(this,oe),s)}addAudioChunk(e,t,r){if(!(e instanceof EncodedAudioChunk))throw new TypeError("addAudioChunk's first argument (sample) must be of type EncodedAudioChunk.");if(t&&typeof t!="object")throw new TypeError("addAudioChunk's second argument (meta), when provided, must be an object.");if(r!==void 0&&(!Number.isFinite(r)||r<0))throw new TypeError("addAudioChunk's third argument (timestamp), when provided, must be a non-negative real number.");let n=new Uint8Array(e.byteLength);e.copyTo(n),this.addAudioChunkRaw(n,e.type,r??e.timestamp,e.duration,t)}addAudioChunkRaw(e,t,r,n,i){if(!(e instanceof Uint8Array))throw new TypeError("addAudioChunkRaw's first argument (data) must be an instance of Uint8Array.");if(t!=="key"&&t!=="delta")throw new TypeError("addAudioChunkRaw's second argument (type) must be either 'key' or 'delta'.");if(!Number.isFinite(r)||r<0)throw new TypeError("addAudioChunkRaw's third argument (timestamp) must be a non-negative real number.");if(!Number.isFinite(n)||n<0)throw new TypeError("addAudioChunkRaw's fourth argument (duration) must be a non-negative real number.");if(i&&typeof i!="object")throw new TypeError("addAudioChunkRaw's fifth argument (meta), when provided, must be an object.");if(U(this,ir,Ir).call(this),!a(this,_).audio)throw new Error("No audio track declared.");if(typeof a(this,_).fastStart=="object"&&a(this,re).samples.length===a(this,_).fastStart.expectedAudioChunks)throw new Error(`Cannot add more audio chunks than specified in 'fastStart' (${a(this,_).fastStart.expectedAudioChunks}).`);let o=U(this,nr,Ar).call(this,a(this,re),e,t,r,n,i);if(a(this,_).fastStart==="fragmented"&&a(this,oe)){for(;a(this,Ke).length>0&&a(this,Ke)[0].decodeTimestamp<=o.decodeTimestamp;){let s=a(this,Ke).shift();U(this,Ee,Fe).call(this,a(this,oe),s)}o.decodeTimestamp<=a(this,oe).lastDecodeTimestamp?U(this,Ee,Fe).call(this,a(this,re),o):a(this,Xe).push(o)}else U(this,Ee,Fe).call(this,a(this,re),o)}finalize(){if(a(this,Ut))throw new Error("Cannot finalize a muxer more than once.");if(a(this,_).fastStart==="fragmented"){for(let t of a(this,Ke))U(this,Ee,Fe).call(this,a(this,oe),t);for(let t of a(this,Xe))U(this,Ee,Fe).call(this,a(this,re),t);U(this,dr,en).call(this,!1)}else a(this,oe)&&U(this,kt,hr).call(this,a(this,oe)),a(this,re)&&U(this,kt,hr).call(this,a(this,re));let e=[a(this,oe),a(this,re)].filter(Boolean);if(a(this,_).fastStart==="in-memory"){let t;for(let n=0;n<2;n++){let i=er(e,a(this,lt)),o=a(this,C).measureBox(i);t=a(this,C).measureBox(a(this,de));let s=a(this,C).pos+o+t;for(let u of a(this,ft)){u.offset=s;for(let{data:h}of u.samples)s+=h.byteLength,t+=h.byteLength}if(s<2**32)break;t>=2**32&&(a(this,de).largeSize=!0)}let r=er(e,a(this,lt));a(this,C).writeBox(r),a(this,de).size=t,a(this,C).writeBox(a(this,de));for(let n of a(this,ft))for(let i of n.samples)a(this,C).write(i.data),i.data=null}else if(a(this,_).fastStart==="fragmented"){let t=a(this,C).pos,r=Xo(e);a(this,C).writeBox(r);let n=a(this,C).pos-t;a(this,C).seek(a(this,C).pos-4),a(this,C).writeU32(n)}else{let t=a(this,C).offsets.get(a(this,de)),r=a(this,C).pos-t;a(this,de).size=r,a(this,de).largeSize=r>=2**32,a(this,C).patchBox(a(this,de));let n=er(e,a(this,lt));if(typeof a(this,_).fastStart=="object"){a(this,C).seek(a(this,cr)),a(this,C).writeBox(n);let i=t-a(this,C).pos;a(this,C).writeBox(lo(i))}else a(this,C).writeBox(n)}U(this,dt,Kt).call(this),a(this,C).finalize(),ne(this,Ut,!0)}};_=new WeakMap;C=new WeakMap;cr=new WeakMap;de=new WeakMap;oe=new WeakMap;re=new WeakMap;lt=new WeakMap;ft=new WeakMap;Jr=new WeakMap;Ke=new WeakMap;Xe=new WeakMap;Ut=new WeakMap;Or=new WeakSet;Zn=function(e){if(typeof e!="object")throw new TypeError("The muxer requires an options object to be passed to its constructor.");if(!(e.target instanceof yr))throw new TypeError("The target must be provided and an instance of Target.");if(e.video){if(!sa.includes(e.video.codec))throw new TypeError(`Unsupported video codec: ${e.video.codec}`);if(!Number.isInteger(e.video.width)||e.video.width<=0)throw new TypeError(`Invalid video width: ${e.video.width}. Must be a positive integer.`);if(!Number.isInteger(e.video.height)||e.video.height<=0)throw new TypeError(`Invalid video height: ${e.video.height}. Must be a positive integer.`);const t=e.video.rotation;if(typeof t=="number"&&![0,90,180,270].includes(t))throw new TypeError(`Invalid video rotation: ${t}. Has to be 0, 90, 180 or 270.`);if(Array.isArray(t)&&(t.length!==9||t.some(r=>typeof r!="number")))throw new TypeError(`Invalid video transformation matrix: ${t.join()}`);if(e.video.frameRate!==void 0&&(!Number.isInteger(e.video.frameRate)||e.video.frameRate<=0))throw new TypeError(`Invalid video frame rate: ${e.video.frameRate}. Must be a positive integer.`)}if(e.audio){if(!la.includes(e.audio.codec))throw new TypeError(`Unsupported audio codec: ${e.audio.codec}`);if(!Number.isInteger(e.audio.numberOfChannels)||e.audio.numberOfChannels<=0)throw new TypeError(`Invalid number of audio channels: ${e.audio.numberOfChannels}. Must be a positive integer.`);if(!Number.isInteger(e.audio.sampleRate)||e.audio.sampleRate<=0)throw new TypeError(`Invalid audio sample rate: ${e.audio.sampleRate}. Must be a positive integer.`)}if(e.firstTimestampBehavior&&!fa.includes(e.firstTimestampBehavior))throw new TypeError(`Invalid first timestamp behavior: ${e.firstTimestampBehavior}`);if(typeof e.fastStart=="object"){if(e.video){if(e.fastStart.expectedVideoChunks===void 0)throw new TypeError("'fastStart' is an object but is missing property 'expectedVideoChunks'.");if(!Number.isInteger(e.fastStart.expectedVideoChunks)||e.fastStart.expectedVideoChunks<0)throw new TypeError("'expectedVideoChunks' must be a non-negative integer.")}if(e.audio){if(e.fastStart.expectedAudioChunks===void 0)throw new TypeError("'fastStart' is an object but is missing property 'expectedAudioChunks'.");if(!Number.isInteger(e.fastStart.expectedAudioChunks)||e.fastStart.expectedAudioChunks<0)throw new TypeError("'expectedAudioChunks' must be a non-negative integer.")}}else if(![!1,"in-memory","fragmented"].includes(e.fastStart))throw new TypeError("'fastStart' option must be false, 'in-memory', 'fragmented' or an object.");if(e.minFragmentDuration!==void 0&&(!Number.isFinite(e.minFragmentDuration)||e.minFragmentDuration<0))throw new TypeError("'minFragmentDuration' must be a non-negative number.")};Pr=new WeakSet;Yn=function(){var e;if(a(this,C).writeBox(so({holdsAvc:((e=a(this,_).video)==null?void 0:e.codec)==="avc",fragmented:a(this,_).fastStart==="fragmented"})),ne(this,cr,a(this,C).pos),a(this,_).fastStart==="in-memory")ne(this,de,xr(!1));else if(a(this,_).fastStart!=="fragmented"){if(typeof a(this,_).fastStart=="object"){let t=U(this,Zr,Qn).call(this);a(this,C).seek(a(this,C).pos+t)}ne(this,de,xr(!0)),a(this,C).writeBox(a(this,de))}U(this,dt,Kt).call(this)};Zr=new WeakSet;Qn=function(){if(typeof a(this,_).fastStart!="object")return;let e=0,t=[a(this,_).fastStart.expectedVideoChunks,a(this,_).fastStart.expectedAudioChunks];for(let r of t)r&&(e+=8*Math.ceil(2/3*r),e+=4*r,e+=12*Math.ceil(2/3*r),e+=4*r,e+=8*r);return e+=4096,e};Rr=new WeakSet;ei=function(){if(a(this,_).video&&ne(this,oe,{id:1,info:{type:"video",codec:a(this,_).video.codec,width:a(this,_).video.width,height:a(this,_).video.height,rotation:a(this,_).video.rotation??0,decoderConfig:null},timescale:a(this,_).video.frameRate??57600,samples:[],finalizedChunks:[],currentChunk:null,firstDecodeTimestamp:void 0,lastDecodeTimestamp:-1,timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,compactlyCodedChunkTable:[]}),a(this,_).audio&&(ne(this,re,{id:a(this,_).video?2:1,info:{type:"audio",codec:a(this,_).audio.codec,numberOfChannels:a(this,_).audio.numberOfChannels,sampleRate:a(this,_).audio.sampleRate,decoderConfig:null},timescale:a(this,_).audio.sampleRate,samples:[],finalizedChunks:[],currentChunk:null,firstDecodeTimestamp:void 0,lastDecodeTimestamp:-1,timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,compactlyCodedChunkTable:[]}),a(this,_).audio.codec==="aac")){let e=U(this,Yr,ti).call(this,2,a(this,_).audio.sampleRate,a(this,_).audio.numberOfChannels);a(this,re).info.decoderConfig={codec:a(this,_).audio.codec,description:e,numberOfChannels:a(this,_).audio.numberOfChannels,sampleRate:a(this,_).audio.sampleRate}}};Yr=new WeakSet;ti=function(e,t,r){let i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350].indexOf(t),o=r,s="";s+=e.toString(2).padStart(5,"0"),s+=i.toString(2).padStart(4,"0"),i===15&&(s+=t.toString(2).padStart(24,"0")),s+=o.toString(2).padStart(4,"0");let u=Math.ceil(s.length/8)*8;s=s.padEnd(u,"0");let h=new Uint8Array(s.length/8);for(let v=0;v<s.length;v+=8)h[v/8]=parseInt(s.slice(v,v+8),2);return h};nr=new WeakSet;Ar=function(e,t,r,n,i,o,s){let u=n/1e6,h=(n-(s??0))/1e6,v=i/1e6,S=U(this,Qr,ri).call(this,u,h,e);return u=S.presentationTimestamp,h=S.decodeTimestamp,o!=null&&o.decoderConfig&&(e.info.decoderConfig===null?e.info.decoderConfig=o.decoderConfig:Object.assign(e.info.decoderConfig,o.decoderConfig)),{presentationTimestamp:u,decodeTimestamp:h,duration:v,data:t,size:t.byteLength,type:r,timescaleUnitsToNextSample:ke(v,e.timescale)}};Ee=new WeakSet;Fe=function(e,t){a(this,_).fastStart!=="fragmented"&&e.samples.push(t);const r=ke(t.presentationTimestamp-t.decodeTimestamp,e.timescale);if(e.lastTimescaleUnits!==null){let i=ke(t.decodeTimestamp,e.timescale,!1),o=Math.round(i-e.lastTimescaleUnits);if(e.lastTimescaleUnits+=o,e.lastSample.timescaleUnitsToNextSample=o,a(this,_).fastStart!=="fragmented"){let s=lr(e.timeToSampleTable);s.sampleCount===1?(s.sampleDelta=o,s.sampleCount++):s.sampleDelta===o?s.sampleCount++:(s.sampleCount--,e.timeToSampleTable.push({sampleCount:2,sampleDelta:o}));const u=lr(e.compositionTimeOffsetTable);u.sampleCompositionTimeOffset===r?u.sampleCount++:e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:r})}}else e.lastTimescaleUnits=0,a(this,_).fastStart!=="fragmented"&&(e.timeToSampleTable.push({sampleCount:1,sampleDelta:ke(t.duration,e.timescale)}),e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:r}));e.lastSample=t;let n=!1;if(!e.currentChunk)n=!0;else{let i=t.presentationTimestamp-e.currentChunk.startTimestamp;if(a(this,_).fastStart==="fragmented"){let o=a(this,oe)??a(this,re);const s=a(this,_).minFragmentDuration??1;e===o&&t.type==="key"&&i>=s&&(n=!0,U(this,dr,en).call(this))}else n=i>=.5}n&&(e.currentChunk&&U(this,kt,hr).call(this,e),e.currentChunk={startTimestamp:t.presentationTimestamp,samples:[]}),e.currentChunk.samples.push(t)};Qr=new WeakSet;ri=function(e,t,r){var s,u;const n=a(this,_).firstTimestampBehavior==="strict",i=r.lastDecodeTimestamp===-1;if(n&&i&&t!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received DTS=${t}).Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of thedocument, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
`);if(a(this,_).firstTimestampBehavior==="offset"||a(this,_).firstTimestampBehavior==="cross-track-offset"){r.firstDecodeTimestamp===void 0&&(r.firstDecodeTimestamp=t);let h;a(this,_).firstTimestampBehavior==="offset"?h=r.firstDecodeTimestamp:h=Math.min(((s=a(this,oe))==null?void 0:s.firstDecodeTimestamp)??1/0,((u=a(this,re))==null?void 0:u.firstDecodeTimestamp)??1/0),t-=h,e-=h}if(t<r.lastDecodeTimestamp)throw new Error(`Timestamps must be monotonically increasing (DTS went from ${r.lastDecodeTimestamp*1e6} to ${t*1e6}).`);return r.lastDecodeTimestamp=t,{presentationTimestamp:e,decodeTimestamp:t}};kt=new WeakSet;hr=function(e){if(a(this,_).fastStart==="fragmented")throw new Error("Can't finalize individual chunks if 'fastStart' is set to 'fragmented'.");if(e.currentChunk){if(e.finalizedChunks.push(e.currentChunk),a(this,ft).push(e.currentChunk),(e.compactlyCodedChunkTable.length===0||lr(e.compactlyCodedChunkTable).samplesPerChunk!==e.currentChunk.samples.length)&&e.compactlyCodedChunkTable.push({firstChunk:e.finalizedChunks.length,samplesPerChunk:e.currentChunk.samples.length}),a(this,_).fastStart==="in-memory"){e.currentChunk.offset=0;return}e.currentChunk.offset=a(this,C).pos;for(let t of e.currentChunk.samples)a(this,C).write(t.data),t.data=null;U(this,dt,Kt).call(this)}};dr=new WeakSet;en=function(e=!0){if(a(this,_).fastStart!=="fragmented")throw new Error("Can't finalize a fragment unless 'fastStart' is set to 'fragmented'.");let t=[a(this,oe),a(this,re)].filter(u=>u&&u.currentChunk);if(t.length===0)return;let r=io(this,Jr)._++;if(r===1){let u=er(t,a(this,lt),!0);a(this,C).writeBox(u)}let n=a(this,C).pos,i=vn(r,t);a(this,C).writeBox(i);{let u=xr(!1),h=0;for(let S of t)for(let g of S.currentChunk.samples)h+=g.size;let v=a(this,C).measureBox(u)+h;v>=2**32&&(u.largeSize=!0,v=a(this,C).measureBox(u)+h),u.size=v,a(this,C).writeBox(u)}for(let u of t){u.currentChunk.offset=a(this,C).pos,u.currentChunk.moofOffset=n;for(let h of u.currentChunk.samples)a(this,C).write(h.data),h.data=null}let o=a(this,C).pos;a(this,C).seek(a(this,C).offsets.get(i));let s=vn(r,t);a(this,C).writeBox(s),a(this,C).seek(o);for(let u of t)u.finalizedChunks.push(u.currentChunk),a(this,ft).push(u.currentChunk),u.currentChunk=null;e&&U(this,dt,Kt).call(this)};dt=new WeakSet;Kt=function(){a(this,C)instanceof Xr&&a(this,C).flush()};ir=new WeakSet;Ir=function(){if(a(this,Ut))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};const ha={width:1280,height:720,bitrate:4e6,framerate:60,keyFrameInterval:60};class tn{constructor(t={}){A(this,"config");A(this,"encoder",null);A(this,"muxer",null);A(this,"frameCount",0);A(this,"startTime",0);A(this,"isEncoding",!1);this.config={...ha,...t}}static isSupported(){return"VideoEncoder"in window&&"VideoFrame"in window}async initialize(){if(!tn.isSupported())throw new $("UNSUPPORTED_BROWSER","WebCodecs not supported");this.muxer=new ca({target:new Vn,video:{codec:"avc",width:this.config.width,height:this.config.height},fastStart:"in-memory"}),this.encoder=new VideoEncoder({output:(t,r)=>{if(this.muxer){const n=r??void 0;try{this.muxer.addVideoChunk(t,n)}catch(i){console.warn("Muxer chunk error, retrying without meta:",i),this.muxer.addVideoChunk(t)}}},error:t=>{throw console.error("Encoder error:",t),new $("ENCODING_FAILED",t.message)}}),this.encoder.configure({codec:"avc1.42E01F",width:this.config.width,height:this.config.height,bitrate:this.config.bitrate,framerate:this.config.framerate,hardwareAcceleration:"prefer-hardware",avc:{format:"avc"}}),this.frameCount=0,this.isEncoding=!0}encodeFrame(t){if(!this.encoder||!this.isEncoding)return;this.frameCount===0&&(this.startTime=performance.now());const r=this.frameCount%this.config.keyFrameInterval===0;this.encoder.encode(t,{keyFrame:r}),this.frameCount++,t.close()}async finalize(){if(!this.encoder||!this.muxer)throw new $("ENCODING_FAILED","Encoder not initialized");this.isEncoding=!1,await this.encoder.flush(),this.muxer.finalize();const r=this.muxer.target.buffer;return this.encoder.close(),this.encoder=null,this.muxer=null,new Uint8Array(r)}getStats(){const t=performance.now()-this.startTime,r=this.frameCount/(t/1e3);return{frameCount:this.frameCount,elapsedMs:t,actualFps:r}}abort(){this.encoder&&(this.encoder.close(),this.encoder=null),this.muxer=null,this.isEncoding=!1}}const da={mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:4e6};class pr{constructor(t={}){A(this,"recorder",null);A(this,"chunks",[]);A(this,"config");A(this,"startTime",0);this.config={...da,...t}}static isSupported(){return"MediaRecorder"in window}static getBestMimeType(){const t=["video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm","video/mp4"];for(const r of t)if(MediaRecorder.isTypeSupported(r))return r;return"video/webm"}initialize(t){if(!pr.isSupported())throw new $("UNSUPPORTED_BROWSER","MediaRecorder not supported");const r=pr.getBestMimeType();this.recorder=new MediaRecorder(t,{mimeType:r,videoBitsPerSecond:this.config.videoBitsPerSecond}),this.chunks=[],this.recorder.ondataavailable=n=>{n.data.size>0&&this.chunks.push(n.data)},this.recorder.onerror=n=>{throw console.error("MediaRecorder error:",n),new $("CAPTURE_FAILED","Recording failed")}}start(){if(!this.recorder)throw new $("CAPTURE_FAILED","Recorder not initialized");this.startTime=performance.now(),this.chunks=[],this.recorder.start(100)}async stop(){return new Promise((t,r)=>{if(!this.recorder){r(new $("CAPTURE_FAILED","Recorder not initialized"));return}this.recorder.onstop=async()=>{var n;try{const o=await new Blob(this.chunks,{type:(n=this.recorder)==null?void 0:n.mimeType}).arrayBuffer();t(new Uint8Array(o))}catch{r(new $("ENCODING_FAILED","Failed to process recording"))}},this.recorder.stop()})}getElapsedMs(){return performance.now()-this.startTime}abort(){this.recorder&&this.recorder.state!=="inactive"&&this.recorder.stop(),this.recorder=null,this.chunks=[]}}async function ni(e){const t=await crypto.subtle.digest("SHA-256",e.buffer);return ma(t)}async function pa(e){const r=new TextEncoder().encode(e);return ni(r)}function ma(e){const t=new Uint8Array(e);return Array.from(t).map(r=>r.toString(16).padStart(2,"0")).join("")}function Dr(e){"@babel/helpers - typeof";return Dr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dr(e)}function va(e,t,r){return Object.defineProperty(e,"prototype",{writable:!1}),e}function ya(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ga(e,t,r){return t=Rt(t),ba(e,rn()?Reflect.construct(t,r||[],Rt(e).constructor):t.apply(e,r))}function ba(e,t){if(t&&(Dr(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return wa(e)}function wa(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _a(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Pt(e,t)}function Fr(e){var t=typeof Map=="function"?new Map:void 0;return Fr=function(n){if(n===null||!Ca(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(n))return t.get(n);t.set(n,i)}function i(){return Sa(n,arguments,Rt(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Pt(i,n)},Fr(e)}function Sa(e,t,r){if(rn())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var i=new(e.bind.apply(e,n));return r&&Pt(i,r.prototype),i}function rn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rn=function(){return!!e})()}function Ca(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch{return typeof e=="function"}}function Pt(e,t){return Pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},Pt(e,t)}function Rt(e){return Rt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Rt(e)}var Yt=function(e){function t(r){var n,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(ya(this,t),n=ga(this,t,[r]),n.originalRequest=o,n.originalResponse=s,n.causingError=i,i!=null&&(r+=", caused by ".concat(i.toString())),o!=null){var u=o.getHeader("X-Request-ID")||"n/a",h=o.getMethod(),v=o.getURL(),S=s?s.getStatus():"n/a",g=s?s.getBody()||"":"n/a";r+=", originated from request (method: ".concat(h,", url: ").concat(v,", response code: ").concat(S,", response text: ").concat(g,", request id: ").concat(u,")")}return n.message=r,n}return _a(t,e),va(t)}(Fr(Error));function At(e){"@babel/helpers - typeof";return At=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},At(e)}function Ta(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xa(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ua(n.key),n)}}function Ea(e,t,r){return t&&xa(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ua(e){var t=ka(e,"string");return At(t)=="symbol"?t:t+""}function ka(e,t){if(At(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(At(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Oa=function(){function e(){Ta(this,e)}return Ea(e,[{key:"listAllUploads",value:function(){return Promise.resolve([])}},{key:"findUploadsByFingerprint",value:function(r){return Promise.resolve([])}},{key:"removeUpload",value:function(r){return Promise.resolve()}},{key:"addUpload",value:function(r,n){return Promise.resolve(null)}}])}();const ii="3.7.8",Pa=ii,mt=typeof Buffer=="function",yn=typeof TextDecoder=="function"?new TextDecoder:void 0,gn=typeof TextEncoder=="function"?new TextEncoder:void 0,Ra="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",St=Array.prototype.slice.call(Ra),Qt=(e=>{let t={};return e.forEach((r,n)=>t[r]=n),t})(St),Aa=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,ae=String.fromCharCode.bind(String),bn=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),oi=e=>e.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_"),ai=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),si=e=>{let t,r,n,i,o="";const s=e.length%3;for(let u=0;u<e.length;){if((r=e.charCodeAt(u++))>255||(n=e.charCodeAt(u++))>255||(i=e.charCodeAt(u++))>255)throw new TypeError("invalid character found");t=r<<16|n<<8|i,o+=St[t>>18&63]+St[t>>12&63]+St[t>>6&63]+St[t&63]}return s?o.slice(0,s-3)+"===".substring(s):o},nn=typeof btoa=="function"?e=>btoa(e):mt?e=>Buffer.from(e,"binary").toString("base64"):si,jr=mt?e=>Buffer.from(e).toString("base64"):e=>{let r=[];for(let n=0,i=e.length;n<i;n+=4096)r.push(ae.apply(null,e.subarray(n,n+4096)));return nn(r.join(""))},or=(e,t=!1)=>t?oi(jr(e)):jr(e),Ia=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?ae(192|t>>>6)+ae(128|t&63):ae(224|t>>>12&15)+ae(128|t>>>6&63)+ae(128|t&63)}else{var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return ae(240|t>>>18&7)+ae(128|t>>>12&63)+ae(128|t>>>6&63)+ae(128|t&63)}},Da=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,li=e=>e.replace(Da,Ia),wn=mt?e=>Buffer.from(e,"utf8").toString("base64"):gn?e=>jr(gn.encode(e)):e=>nn(li(e)),ct=(e,t=!1)=>t?oi(wn(e)):wn(e),_n=e=>ct(e,!0),Fa=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,ja=e=>{switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),r=t-65536;return ae((r>>>10)+55296)+ae((r&1023)+56320);case 3:return ae((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return ae((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},ui=e=>e.replace(Fa,ja),fi=e=>{if(e=e.replace(/\s+/g,""),!Aa.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let t,r,n,i=[];for(let o=0;o<e.length;)t=Qt[e.charAt(o++)]<<18|Qt[e.charAt(o++)]<<12|(r=Qt[e.charAt(o++)])<<6|(n=Qt[e.charAt(o++)]),r===64?i.push(ae(t>>16&255)):n===64?i.push(ae(t>>16&255,t>>8&255)):i.push(ae(t>>16&255,t>>8&255,t&255));return i.join("")},on=typeof atob=="function"?e=>atob(ai(e)):mt?e=>Buffer.from(e,"base64").toString("binary"):fi,ci=mt?e=>bn(Buffer.from(e,"base64")):e=>bn(on(e).split("").map(t=>t.charCodeAt(0))),hi=e=>ci(di(e)),La=mt?e=>Buffer.from(e,"base64").toString("utf8"):yn?e=>yn.decode(ci(e)):e=>ui(on(e)),di=e=>ai(e.replace(/[-_]/g,t=>t=="-"?"+":"/")),Lr=e=>La(di(e)),za=e=>{if(typeof e!="string")return!1;const t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},pi=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),mi=function(){const e=(t,r)=>Object.defineProperty(String.prototype,t,pi(r));e("fromBase64",function(){return Lr(this)}),e("toBase64",function(t){return ct(this,t)}),e("toBase64URI",function(){return ct(this,!0)}),e("toBase64URL",function(){return ct(this,!0)}),e("toUint8Array",function(){return hi(this)})},vi=function(){const e=(t,r)=>Object.defineProperty(Uint8Array.prototype,t,pi(r));e("toBase64",function(t){return or(this,t)}),e("toBase64URI",function(){return or(this,!0)}),e("toBase64URL",function(){return or(this,!0)})},Ba=()=>{mi(),vi()},Ma={version:ii,VERSION:Pa,atob:on,atobPolyfill:fi,btoa:nn,btoaPolyfill:si,fromBase64:Lr,toBase64:ct,encode:ct,encodeURI:_n,encodeURL:_n,utob:li,btou:ui,decode:Lr,isValid:za,fromUint8Array:or,toUint8Array:hi,extendString:mi,extendUint8Array:vi,extendBuiltins:Ba};var Sn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Na(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ha=function(t,r){if(r=r.split(":")[0],t=+t,!t)return!1;switch(r){case"http":case"ws":return t!==80;case"https":case"wss":return t!==443;case"ftp":return t!==21;case"gopher":return t!==70;case"file":return!1}return t!==0},an={},$a=Object.prototype.hasOwnProperty,qa;function Cn(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch{return null}}function Tn(e){try{return encodeURIComponent(e)}catch{return null}}function Wa(e){for(var t=/([^=?#&]+)=?([^&]*)/g,r={},n;n=t.exec(e);){var i=Cn(n[1]),o=Cn(n[2]);i===null||o===null||i in r||(r[i]=o)}return r}function Va(e,t){t=t||"";var r=[],n,i;typeof t!="string"&&(t="?");for(i in e)if($a.call(e,i)){if(n=e[i],!n&&(n===null||n===qa||isNaN(n))&&(n=""),i=Tn(i),n=Tn(n),i===null||n===null)continue;r.push(i+"="+n)}return r.length?t+r.join("&"):""}an.stringify=Va;an.parse=Wa;var yi=Ha,gr=an,Ga=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,gi=/[\n\r\t]/g,Ka=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,bi=/:\d+$/,Xa=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,Ja=/^[a-zA-Z]:/;function sn(e){return(e||"").toString().replace(Ga,"")}var zr=[["#","hash"],["?","query"],function(t,r){return Oe(r.protocol)?t.replace(/\\/g,"/"):t},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],xn={hash:1,query:1};function wi(e){var t;typeof window<"u"?t=window:typeof Sn<"u"?t=Sn:typeof self<"u"?t=self:t={};var r=t.location||{};e=e||r;var n={},i=typeof e,o;if(e.protocol==="blob:")n=new Re(unescape(e.pathname),{});else if(i==="string"){n=new Re(e,{});for(o in xn)delete n[o]}else if(i==="object"){for(o in e)o in xn||(n[o]=e[o]);n.slashes===void 0&&(n.slashes=Ka.test(e.href))}return n}function Oe(e){return e==="file:"||e==="ftp:"||e==="http:"||e==="https:"||e==="ws:"||e==="wss:"}function _i(e,t){e=sn(e),e=e.replace(gi,""),t=t||{};var r=Xa.exec(e),n=r[1]?r[1].toLowerCase():"",i=!!r[2],o=!!r[3],s=0,u;return i?o?(u=r[2]+r[3]+r[4],s=r[2].length+r[3].length):(u=r[2]+r[4],s=r[2].length):o?(u=r[3]+r[4],s=r[3].length):u=r[4],n==="file:"?s>=2&&(u=u.slice(2)):Oe(n)?u=r[4]:n?i&&(u=u.slice(2)):s>=2&&Oe(t.protocol)&&(u=r[4]),{protocol:n,slashes:i||Oe(n),slashesCount:s,rest:u}}function Za(e,t){if(e==="")return t;for(var r=(t||"/").split("/").slice(0,-1).concat(e.split("/")),n=r.length,i=r[n-1],o=!1,s=0;n--;)r[n]==="."?r.splice(n,1):r[n]===".."?(r.splice(n,1),s++):s&&(n===0&&(o=!0),r.splice(n,1),s--);return o&&r.unshift(""),(i==="."||i==="..")&&r.push(""),r.join("/")}function Re(e,t,r){if(e=sn(e),e=e.replace(gi,""),!(this instanceof Re))return new Re(e,t,r);var n,i,o,s,u,h,v=zr.slice(),S=typeof t,g=this,J=0;for(S!=="object"&&S!=="string"&&(r=t,t=null),r&&typeof r!="function"&&(r=gr.parse),t=wi(t),i=_i(e||"",t),n=!i.protocol&&!i.slashes,g.slashes=i.slashes||n&&t.slashes,g.protocol=i.protocol||t.protocol||"",e=i.rest,(i.protocol==="file:"&&(i.slashesCount!==2||Ja.test(e))||!i.slashes&&(i.protocol||i.slashesCount<2||!Oe(g.protocol)))&&(v[3]=[/(.*)/,"pathname"]);J<v.length;J++){if(s=v[J],typeof s=="function"){e=s(e,g);continue}o=s[0],h=s[1],o!==o?g[h]=e:typeof o=="string"?(u=o==="@"?e.lastIndexOf(o):e.indexOf(o),~u&&(typeof s[2]=="number"?(g[h]=e.slice(0,u),e=e.slice(u+s[2])):(g[h]=e.slice(u),e=e.slice(0,u)))):(u=o.exec(e))&&(g[h]=u[1],e=e.slice(0,u.index)),g[h]=g[h]||n&&s[3]&&t[h]||"",s[4]&&(g[h]=g[h].toLowerCase())}r&&(g.query=r(g.query)),n&&t.slashes&&g.pathname.charAt(0)!=="/"&&(g.pathname!==""||t.pathname!=="")&&(g.pathname=Za(g.pathname,t.pathname)),g.pathname.charAt(0)!=="/"&&Oe(g.protocol)&&(g.pathname="/"+g.pathname),yi(g.port,g.protocol)||(g.host=g.hostname,g.port=""),g.username=g.password="",g.auth&&(u=g.auth.indexOf(":"),~u?(g.username=g.auth.slice(0,u),g.username=encodeURIComponent(decodeURIComponent(g.username)),g.password=g.auth.slice(u+1),g.password=encodeURIComponent(decodeURIComponent(g.password))):g.username=encodeURIComponent(decodeURIComponent(g.auth)),g.auth=g.password?g.username+":"+g.password:g.username),g.origin=g.protocol!=="file:"&&Oe(g.protocol)&&g.host?g.protocol+"//"+g.host:"null",g.href=g.toString()}function Ya(e,t,r){var n=this;switch(e){case"query":typeof t=="string"&&t.length&&(t=(r||gr.parse)(t)),n[e]=t;break;case"port":n[e]=t,yi(t,n.protocol)?t&&(n.host=n.hostname+":"+t):(n.host=n.hostname,n[e]="");break;case"hostname":n[e]=t,n.port&&(t+=":"+n.port),n.host=t;break;case"host":n[e]=t,bi.test(t)?(t=t.split(":"),n.port=t.pop(),n.hostname=t.join(":")):(n.hostname=t,n.port="");break;case"protocol":n.protocol=t.toLowerCase(),n.slashes=!r;break;case"pathname":case"hash":if(t){var i=e==="pathname"?"/":"#";n[e]=t.charAt(0)!==i?i+t:t}else n[e]=t;break;case"username":case"password":n[e]=encodeURIComponent(t);break;case"auth":var o=t.indexOf(":");~o?(n.username=t.slice(0,o),n.username=encodeURIComponent(decodeURIComponent(n.username)),n.password=t.slice(o+1),n.password=encodeURIComponent(decodeURIComponent(n.password))):n.username=encodeURIComponent(decodeURIComponent(t))}for(var s=0;s<zr.length;s++){var u=zr[s];u[4]&&(n[u[1]]=n[u[1]].toLowerCase())}return n.auth=n.password?n.username+":"+n.password:n.username,n.origin=n.protocol!=="file:"&&Oe(n.protocol)&&n.host?n.protocol+"//"+n.host:"null",n.href=n.toString(),n}function Qa(e){(!e||typeof e!="function")&&(e=gr.stringify);var t,r=this,n=r.host,i=r.protocol;i&&i.charAt(i.length-1)!==":"&&(i+=":");var o=i+(r.protocol&&r.slashes||Oe(r.protocol)?"//":"");return r.username?(o+=r.username,r.password&&(o+=":"+r.password),o+="@"):r.password?(o+=":"+r.password,o+="@"):r.protocol!=="file:"&&Oe(r.protocol)&&!n&&r.pathname!=="/"&&(o+="@"),(n[n.length-1]===":"||bi.test(r.hostname)&&!r.port)&&(n+=":"),o+=n+r.pathname,t=typeof r.query=="object"?e(r.query):r.query,t&&(o+=t.charAt(0)!=="?"?"?"+t:t),r.hash&&(o+=r.hash),o}Re.prototype={set:Ya,toString:Qa};Re.extractProtocol=_i;Re.location=wi;Re.trimLeft=sn;Re.qs=gr;var es=Re;const ts=Na(es);function rs(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,r=e==="x"?t:t&3|8;return r.toString(16)})}function Br(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Br=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(c,l,f){c[l]=f.value},o=typeof Symbol=="function"?Symbol:{},s=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",h=o.toStringTag||"@@toStringTag";function v(c,l,f){return Object.defineProperty(c,l,{value:f,enumerable:!0,configurable:!0,writable:!0}),c[l]}try{v({},"")}catch{v=function(f,d,m){return f[d]=m}}function S(c,l,f,d){var m=l&&l.prototype instanceof be?l:be,p=Object.create(m.prototype),x=new Ae(d||[]);return i(p,"_invoke",{value:vt(c,f,x)}),p}function g(c,l,f){try{return{type:"normal",arg:c.call(l,f)}}catch(d){return{type:"throw",arg:d}}}t.wrap=S;var J="suspendedStart",me="suspendedYield",j="executing",B="completed",D={};function be(){}function fe(){}function q(){}var le={};v(le,s,function(){return this});var Se=Object.getPrototypeOf,ce=Se&&Se(Se(Te([])));ce&&ce!==r&&n.call(ce,s)&&(le=ce);var ue=q.prototype=be.prototype=Object.create(le);function Le(c){["next","throw","return"].forEach(function(l){v(c,l,function(f){return this._invoke(l,f)})})}function we(c,l){function f(m,p,x,O){var R=g(c[m],c,p);if(R.type!=="throw"){var te=R.arg,Z=te.value;return Z&&Ye(Z)=="object"&&n.call(Z,"__await")?l.resolve(Z.__await).then(function(ie){f("next",ie,x,O)},function(ie){f("throw",ie,x,O)}):l.resolve(Z).then(function(ie){te.value=ie,x(te)},function(ie){return f("throw",ie,x,O)})}O(R.arg)}var d;i(this,"_invoke",{value:function(p,x){function O(){return new l(function(R,te){f(p,x,R,te)})}return d=d?d.then(O,O):O()}})}function vt(c,l,f){var d=J;return function(m,p){if(d===j)throw Error("Generator is already running");if(d===B){if(m==="throw")throw p;return{value:e,done:!0}}for(f.method=m,f.arg=p;;){var x=f.delegate;if(x){var O=Me(x,f);if(O){if(O===D)continue;return O}}if(f.method==="next")f.sent=f._sent=f.arg;else if(f.method==="throw"){if(d===J)throw d=B,f.arg;f.dispatchException(f.arg)}else f.method==="return"&&f.abrupt("return",f.arg);d=j;var R=g(c,l,f);if(R.type==="normal"){if(d=f.done?B:me,R.arg===D)continue;return{value:R.arg,done:f.done}}R.type==="throw"&&(d=B,f.method="throw",f.arg=R.arg)}}}function Me(c,l){var f=l.method,d=c.iterator[f];if(d===e)return l.delegate=null,f==="throw"&&c.iterator.return&&(l.method="return",l.arg=e,Me(c,l),l.method==="throw")||f!=="return"&&(l.method="throw",l.arg=new TypeError("The iterator does not provide a '"+f+"' method")),D;var m=g(d,c.iterator,l.arg);if(m.type==="throw")return l.method="throw",l.arg=m.arg,l.delegate=null,D;var p=m.arg;return p?p.done?(l[c.resultName]=p.value,l.next=c.nextLoc,l.method!=="return"&&(l.method="next",l.arg=e),l.delegate=null,D):p:(l.method="throw",l.arg=new TypeError("iterator result is not an object"),l.delegate=null,D)}function Ne(c){var l={tryLoc:c[0]};1 in c&&(l.catchLoc=c[1]),2 in c&&(l.finallyLoc=c[2],l.afterLoc=c[3]),this.tryEntries.push(l)}function Ce(c){var l=c.completion||{};l.type="normal",delete l.arg,c.completion=l}function Ae(c){this.tryEntries=[{tryLoc:"root"}],c.forEach(Ne,this),this.reset(!0)}function Te(c){if(c||c===""){var l=c[s];if(l)return l.call(c);if(typeof c.next=="function")return c;if(!isNaN(c.length)){var f=-1,d=function m(){for(;++f<c.length;)if(n.call(c,f))return m.value=c[f],m.done=!1,m;return m.value=e,m.done=!0,m};return d.next=d}}throw new TypeError(Ye(c)+" is not iterable")}return fe.prototype=q,i(ue,"constructor",{value:q,configurable:!0}),i(q,"constructor",{value:fe,configurable:!0}),fe.displayName=v(q,h,"GeneratorFunction"),t.isGeneratorFunction=function(c){var l=typeof c=="function"&&c.constructor;return!!l&&(l===fe||(l.displayName||l.name)==="GeneratorFunction")},t.mark=function(c){return Object.setPrototypeOf?Object.setPrototypeOf(c,q):(c.__proto__=q,v(c,h,"GeneratorFunction")),c.prototype=Object.create(ue),c},t.awrap=function(c){return{__await:c}},Le(we.prototype),v(we.prototype,u,function(){return this}),t.AsyncIterator=we,t.async=function(c,l,f,d,m){m===void 0&&(m=Promise);var p=new we(S(c,l,f,d),m);return t.isGeneratorFunction(l)?p:p.next().then(function(x){return x.done?x.value:p.next()})},Le(ue),v(ue,h,"Generator"),v(ue,s,function(){return this}),v(ue,"toString",function(){return"[object Generator]"}),t.keys=function(c){var l=Object(c),f=[];for(var d in l)f.push(d);return f.reverse(),function m(){for(;f.length;){var p=f.pop();if(p in l)return m.value=p,m.done=!1,m}return m.done=!0,m}},t.values=Te,Ae.prototype={constructor:Ae,reset:function(l){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(Ce),!l)for(var f in this)f.charAt(0)==="t"&&n.call(this,f)&&!isNaN(+f.slice(1))&&(this[f]=e)},stop:function(){this.done=!0;var l=this.tryEntries[0].completion;if(l.type==="throw")throw l.arg;return this.rval},dispatchException:function(l){if(this.done)throw l;var f=this;function d(te,Z){return x.type="throw",x.arg=l,f.next=te,Z&&(f.method="next",f.arg=e),!!Z}for(var m=this.tryEntries.length-1;m>=0;--m){var p=this.tryEntries[m],x=p.completion;if(p.tryLoc==="root")return d("end");if(p.tryLoc<=this.prev){var O=n.call(p,"catchLoc"),R=n.call(p,"finallyLoc");if(O&&R){if(this.prev<p.catchLoc)return d(p.catchLoc,!0);if(this.prev<p.finallyLoc)return d(p.finallyLoc)}else if(O){if(this.prev<p.catchLoc)return d(p.catchLoc,!0)}else{if(!R)throw Error("try statement without catch or finally");if(this.prev<p.finallyLoc)return d(p.finallyLoc)}}}},abrupt:function(l,f){for(var d=this.tryEntries.length-1;d>=0;--d){var m=this.tryEntries[d];if(m.tryLoc<=this.prev&&n.call(m,"finallyLoc")&&this.prev<m.finallyLoc){var p=m;break}}p&&(l==="break"||l==="continue")&&p.tryLoc<=f&&f<=p.finallyLoc&&(p=null);var x=p?p.completion:{};return x.type=l,x.arg=f,p?(this.method="next",this.next=p.finallyLoc,D):this.complete(x)},complete:function(l,f){if(l.type==="throw")throw l.arg;return l.type==="break"||l.type==="continue"?this.next=l.arg:l.type==="return"?(this.rval=this.arg=l.arg,this.method="return",this.next="end"):l.type==="normal"&&f&&(this.next=f),D},finish:function(l){for(var f=this.tryEntries.length-1;f>=0;--f){var d=this.tryEntries[f];if(d.finallyLoc===l)return this.complete(d.completion,d.afterLoc),Ce(d),D}},catch:function(l){for(var f=this.tryEntries.length-1;f>=0;--f){var d=this.tryEntries[f];if(d.tryLoc===l){var m=d.completion;if(m.type==="throw"){var p=m.arg;Ce(d)}return p}}throw Error("illegal catch attempt")},delegateYield:function(l,f,d){return this.delegate={iterator:Te(l),resultName:f,nextLoc:d},this.method==="next"&&(this.arg=e),D}},t}function En(e,t,r,n,i,o,s){try{var u=e[o](s),h=u.value}catch(v){r(v);return}u.done?t(h):Promise.resolve(h).then(n,i)}function ns(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function s(h){En(o,n,i,s,u,"next",h)}function u(h){En(o,n,i,s,u,"throw",h)}s(void 0)})}}function Si(e,t){return as(e)||os(e,t)||Ci(e,t)||is()}function is(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function os(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,o,s,u=[],h=!0,v=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(h=(n=o.call(r)).done)&&(u.push(n.value),u.length!==t);h=!0);}catch(S){v=!0,i=S}finally{try{if(!h&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(v)throw i}}return u}}function as(e){if(Array.isArray(e))return e}function Ye(e){"@babel/helpers - typeof";return Ye=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ye(e)}function ss(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ci(e))||t){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,u;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){s=!0,u=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(s)throw u}}}}function Ci(e,t){if(e){if(typeof e=="string")return Un(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Un(e,t)}}function Un(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function kn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function ot(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?kn(Object(r),!0).forEach(function(n){ls(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kn(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ls(e,t,r){return t=Ti(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function us(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function On(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ti(n.key),n)}}function fs(e,t,r){return t&&On(e.prototype,t),r&&On(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ti(e){var t=cs(e,"string");return Ye(t)=="symbol"?t:t+""}function cs(e,t){if(Ye(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Ye(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var ar="tus-v1",sr="ietf-draft-03",Ct="ietf-draft-05",hs={endpoint:null,uploadUrl:null,metadata:{},metadataForPartialUploads:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:xi,chunkSize:Number.POSITIVE_INFINITY,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null,protocol:ar},mr=function(){function e(t,r){us(this,e),"resume"in r&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=r,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=t,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}return fs(e,[{key:"findPreviousUploads",value:function(){var r=this;return this.options.fingerprint(this.file,this.options).then(function(n){return r._urlStorage.findUploadsByFingerprint(n)})}},{key:"resumeFromPreviousUpload",value:function(r){this.url=r.uploadUrl||null,this._parallelUploadUrls=r.parallelUploadUrls||null,this._urlStorageKey=r.urlStorageKey}},{key:"start",value:function(){var r=this,n=this.file;if(!n){this._emitError(new Error("tus: no file or stream to upload provided"));return}if(![ar,sr,Ct].includes(this.options.protocol)){this._emitError(new Error("tus: unsupported protocol ".concat(this.options.protocol)));return}if(!this.options.endpoint&&!this.options.uploadUrl&&!this.url){this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));return}var i=this.options.retryDelays;if(i!=null&&Object.prototype.toString.call(i)!=="[object Array]"){this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"));return}if(this.options.parallelUploads>1)for(var o=0,s=["uploadUrl","uploadSize","uploadLengthDeferred"];o<s.length;o++){var u=s[o];if(this.options[u]){this._emitError(new Error("tus: cannot use the ".concat(u," option when parallelUploads is enabled")));return}}if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1){this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));return}if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length){this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"));return}}this.options.fingerprint(n,this.options).then(function(h){return r._fingerprint=h,r._source?r._source:r.options.fileReader.openFile(n,r.options.chunkSize)}).then(function(h){if(r._source=h,r.options.uploadLengthDeferred)r._size=null;else if(r.options.uploadSize!=null){if(r._size=Number(r.options.uploadSize),Number.isNaN(r._size)){r._emitError(new Error("tus: cannot convert `uploadSize` option into a number"));return}}else if(r._size=r._source.size,r._size==null){r._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));return}r.options.parallelUploads>1||r._parallelUploadUrls!=null?r._startParallelUpload():r._startSingleUpload()}).catch(function(h){r._emitError(h)})}},{key:"_startParallelUpload",value:function(){var r,n=this,i=this._size,o=0;this._parallelUploads=[];var s=this._parallelUploadUrls!=null?this._parallelUploadUrls.length:this.options.parallelUploads,u=(r=this.options.parallelUploadBoundaries)!==null&&r!==void 0?r:ps(this._source.size,s);this._parallelUploadUrls&&u.forEach(function(S,g){S.uploadUrl=n._parallelUploadUrls[g]||null}),this._parallelUploadUrls=new Array(u.length);var h=u.map(function(S,g){var J=0;return n._source.slice(S.start,S.end).then(function(me){var j=me.value;return new Promise(function(B,D){var be=ot(ot({},n.options),{},{uploadUrl:S.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:n.options.metadataForPartialUploads,headers:ot(ot({},n.options.headers),{},{"Upload-Concat":"partial"}),onSuccess:B,onError:D,onProgress:function(le){o=o-J+le,J=le,n._emitProgress(o,i)},onUploadUrlAvailable:function(){n._parallelUploadUrls[g]=fe.url,n._parallelUploadUrls.filter(function(le){return!!le}).length===u.length&&n._saveUploadInUrlStorage()}}),fe=new e(j,be);fe.start(),n._parallelUploads.push(fe)})})}),v;Promise.all(h).then(function(){v=n._openRequest("POST",n.options.endpoint),v.setHeader("Upload-Concat","final;".concat(n._parallelUploadUrls.join(" ")));var S=Pn(n.options.metadata);return S!==""&&v.setHeader("Upload-Metadata",S),n._sendRequest(v,null)}).then(function(S){if(!st(S.getStatus(),200)){n._emitHttpError(v,S,"tus: unexpected response while creating upload");return}var g=S.getHeader("Location");if(g==null){n._emitHttpError(v,S,"tus: invalid or missing Location header");return}n.url=Dn(n.options.endpoint,g),"Created upload at ".concat(n.url),n._emitSuccess(S)}).catch(function(S){n._emitError(S)})}},{key:"_startSingleUpload",value:function(){if(this._aborted=!1,this.url!=null){"Resuming upload from previous URL: ".concat(this.url),this._resumeUpload();return}if(this.options.uploadUrl!=null){"Resuming upload from provided URL: ".concat(this.options.uploadUrl),this.url=this.options.uploadUrl,this._resumeUpload();return}this._createUpload()}},{key:"abort",value:function(r){var n=this;if(this._parallelUploads!=null){var i=ss(this._parallelUploads),o;try{for(i.s();!(o=i.n()).done;){var s=o.value;s.abort(r)}}catch(u){i.e(u)}finally{i.f()}}return this._req!==null&&this._req.abort(),this._aborted=!0,this._retryTimeout!=null&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),!r||this.url==null?Promise.resolve():e.terminate(this.url,this.options).then(function(){return n._removeFromUrlStorage()})}},{key:"_emitHttpError",value:function(r,n,i,o){this._emitError(new Yt(i,o,r,n))}},{key:"_emitError",value:function(r){var n=this;if(!this._aborted){if(this.options.retryDelays!=null){var i=this._offset!=null&&this._offset>this._offsetBeforeRetry;if(i&&(this._retryAttempt=0),In(r,this._retryAttempt,this.options)){var o=this.options.retryDelays[this._retryAttempt++];this._offsetBeforeRetry=this._offset,this._retryTimeout=setTimeout(function(){n.start()},o);return}}if(typeof this.options.onError=="function")this.options.onError(r);else throw r}}},{key:"_emitSuccess",value:function(r){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),typeof this.options.onSuccess=="function"&&this.options.onSuccess({lastResponse:r})}},{key:"_emitProgress",value:function(r,n){typeof this.options.onProgress=="function"&&this.options.onProgress(r,n)}},{key:"_emitChunkComplete",value:function(r,n,i){typeof this.options.onChunkComplete=="function"&&this.options.onChunkComplete(r,n,i)}},{key:"_createUpload",value:function(){var r=this;if(!this.options.endpoint){this._emitError(new Error("tus: unable to create upload because no endpoint is provided"));return}var n=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?n.setHeader("Upload-Defer-Length","1"):n.setHeader("Upload-Length","".concat(this._size));var i=Pn(this.options.metadata);i!==""&&n.setHeader("Upload-Metadata",i);var o;this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,o=this._addChunkToRequest(n)):((this.options.protocol===sr||this.options.protocol===Ct)&&n.setHeader("Upload-Complete","?0"),o=this._sendRequest(n,null)),o.then(function(s){if(!st(s.getStatus(),200)){r._emitHttpError(n,s,"tus: unexpected response while creating upload");return}var u=s.getHeader("Location");if(u==null){r._emitHttpError(n,s,"tus: invalid or missing Location header");return}if(r.url=Dn(r.options.endpoint,u),"Created upload at ".concat(r.url),typeof r.options.onUploadUrlAvailable=="function"&&r.options.onUploadUrlAvailable(),r._size===0){r._emitSuccess(s),r._source.close();return}r._saveUploadInUrlStorage().then(function(){r.options.uploadDataDuringCreation?r._handleUploadResponse(n,s):(r._offset=0,r._performUpload())})}).catch(function(s){r._emitHttpError(n,null,"tus: failed to create upload",s)})}},{key:"_resumeUpload",value:function(){var r=this,n=this._openRequest("HEAD",this.url),i=this._sendRequest(n,null);i.then(function(o){var s=o.getStatus();if(!st(s,200)){if(s===423){r._emitHttpError(n,o,"tus: upload is currently locked; retry later");return}if(st(s,400)&&r._removeFromUrlStorage(),!r.options.endpoint){r._emitHttpError(n,o,"tus: unable to resume upload (new upload cannot be created without an endpoint)");return}r.url=null,r._createUpload();return}var u=Number.parseInt(o.getHeader("Upload-Offset"),10);if(Number.isNaN(u)){r._emitHttpError(n,o,"tus: invalid or missing offset value");return}var h=Number.parseInt(o.getHeader("Upload-Length"),10);if(Number.isNaN(h)&&!r.options.uploadLengthDeferred&&r.options.protocol===ar){r._emitHttpError(n,o,"tus: invalid or missing length value");return}typeof r.options.onUploadUrlAvailable=="function"&&r.options.onUploadUrlAvailable(),r._saveUploadInUrlStorage().then(function(){if(u===h){r._emitProgress(h,h),r._emitSuccess(o);return}r._offset=u,r._performUpload()})}).catch(function(o){r._emitHttpError(n,null,"tus: failed to resume upload",o)})}},{key:"_performUpload",value:function(){var r=this;if(!this._aborted){var n;this.options.overridePatchMethod?(n=this._openRequest("POST",this.url),n.setHeader("X-HTTP-Method-Override","PATCH")):n=this._openRequest("PATCH",this.url),n.setHeader("Upload-Offset","".concat(this._offset));var i=this._addChunkToRequest(n);i.then(function(o){if(!st(o.getStatus(),200)){r._emitHttpError(n,o,"tus: unexpected response while uploading chunk");return}r._handleUploadResponse(n,o)}).catch(function(o){r._aborted||r._emitHttpError(n,null,"tus: failed to upload chunk at offset ".concat(r._offset),o)})}}},{key:"_addChunkToRequest",value:function(r){var n=this,i=this._offset,o=this._offset+this.options.chunkSize;return r.setProgressHandler(function(s){n._emitProgress(i+s,n._size)}),this.options.protocol===ar?r.setHeader("Content-Type","application/offset+octet-stream"):this.options.protocol===Ct&&r.setHeader("Content-Type","application/partial-upload"),(o===Number.POSITIVE_INFINITY||o>this._size)&&!this.options.uploadLengthDeferred&&(o=this._size),this._source.slice(i,o).then(function(s){var u=s.value,h=s.done,v=u!=null&&u.size?u.size:0;n.options.uploadLengthDeferred&&h&&(n._size=n._offset+v,r.setHeader("Upload-Length","".concat(n._size)));var S=n._offset+v;return!n.options.uploadLengthDeferred&&h&&S!==n._size?Promise.reject(new Error("upload was configured with a size of ".concat(n._size," bytes, but the source is done after ").concat(S," bytes"))):u===null?n._sendRequest(r):((n.options.protocol===sr||n.options.protocol===Ct)&&r.setHeader("Upload-Complete",h?"?1":"?0"),n._emitProgress(n._offset,n._size),n._sendRequest(r,u))})}},{key:"_handleUploadResponse",value:function(r,n){var i=Number.parseInt(n.getHeader("Upload-Offset"),10);if(Number.isNaN(i)){this._emitHttpError(r,n,"tus: invalid or missing offset value");return}if(this._emitProgress(i,this._size),this._emitChunkComplete(i-this._offset,i,this._size),this._offset=i,i===this._size){this._emitSuccess(n),this._source.close();return}this._performUpload()}},{key:"_openRequest",value:function(r,n){var i=Rn(r,n,this.options);return this._req=i,i}},{key:"_removeFromUrlStorage",value:function(){var r=this;this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch(function(n){r._emitError(n)}),this._urlStorageKey=null)}},{key:"_saveUploadInUrlStorage",value:function(){var r=this;if(!this.options.storeFingerprintForResuming||!this._fingerprint||this._urlStorageKey!==null)return Promise.resolve();var n={size:this._size,metadata:this.options.metadata,creationTime:new Date().toString()};return this._parallelUploads?n.parallelUploadUrls=this._parallelUploadUrls:n.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,n).then(function(i){r._urlStorageKey=i})}},{key:"_sendRequest",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return An(r,n,this.options)}}],[{key:"terminate",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=Rn("DELETE",r,n);return An(i,null,n).then(function(o){if(o.getStatus()!==204)throw new Yt("tus: unexpected response while terminating upload",null,i,o)}).catch(function(o){if(o instanceof Yt||(o=new Yt("tus: failed to terminate upload",o,i,null)),!In(o,0,n))throw o;var s=n.retryDelays[0],u=n.retryDelays.slice(1),h=ot(ot({},n),{},{retryDelays:u});return new Promise(function(v){return setTimeout(v,s)}).then(function(){return e.terminate(r,h)})})}}])}();function Pn(e){return Object.entries(e).map(function(t){var r=Si(t,2),n=r[0],i=r[1];return"".concat(n," ").concat(Ma.encode(String(i)))}).join(",")}function st(e,t){return e>=t&&e<t+100}function Rn(e,t,r){var n=r.httpStack.createRequest(e,t);r.protocol===sr?n.setHeader("Upload-Draft-Interop-Version","5"):r.protocol===Ct?n.setHeader("Upload-Draft-Interop-Version","6"):n.setHeader("Tus-Resumable","1.0.0");for(var i=r.headers||{},o=0,s=Object.entries(i);o<s.length;o++){var u=Si(s[o],2),h=u[0],v=u[1];n.setHeader(h,v)}if(r.addRequestId){var S=rs();n.setHeader("X-Request-ID",S)}return n}function An(e,t,r){return Mr.apply(this,arguments)}function Mr(){return Mr=ns(Br().mark(function e(t,r,n){var i;return Br().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(typeof n.onBeforeRequest!="function"){s.next=3;break}return s.next=3,n.onBeforeRequest(t);case 3:return s.next=5,t.send(r);case 5:if(i=s.sent,typeof n.onAfterResponse!="function"){s.next=9;break}return s.next=9,n.onAfterResponse(t,i);case 9:return s.abrupt("return",i);case 10:case"end":return s.stop()}},e)})),Mr.apply(this,arguments)}function ds(){var e=!0;return typeof navigator<"u"&&navigator.onLine===!1&&(e=!1),e}function In(e,t,r){return r.retryDelays==null||t>=r.retryDelays.length||e.originalRequest==null?!1:r&&typeof r.onShouldRetry=="function"?r.onShouldRetry(e,t,r):xi(e)}function xi(e){var t=e.originalResponse?e.originalResponse.getStatus():0;return(!st(t,400)||t===409||t===423)&&ds()}function Dn(e,t){return new ts(t,e).toString()}function ps(e,t){for(var r=Math.floor(e/t),n=[],i=0;i<t;i++)n.push({start:r*i,end:r*(i+1)});return n[t-1].end=e,n}mr.defaultOptions=hs;var Ei=function(){return typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative"};function ms(e){return new Promise(function(t,r){var n=new XMLHttpRequest;n.responseType="blob",n.onload=function(){var i=n.response;t(i)},n.onerror=function(i){r(i)},n.open("GET",e),n.send()})}var vs=function(){return typeof window<"u"&&(typeof window.PhoneGap<"u"||typeof window.Cordova<"u"||typeof window.cordova<"u")};function ys(e){return new Promise(function(t,r){var n=new FileReader;n.onload=function(){var i=new Uint8Array(n.result);t({value:i})},n.onerror=function(i){r(i)},n.readAsArrayBuffer(e)})}function It(e){"@babel/helpers - typeof";return It=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},It(e)}function gs(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bs(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_s(n.key),n)}}function ws(e,t,r){return t&&bs(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _s(e){var t=Ss(e,"string");return It(t)=="symbol"?t:t+""}function Ss(e,t){if(It(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(It(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Fn=function(){function e(t){gs(this,e),this._file=t,this.size=t.size}return ws(e,[{key:"slice",value:function(r,n){if(vs())return ys(this._file.slice(r,n));var i=this._file.slice(r,n),o=n>=this.size;return Promise.resolve({value:i,done:o})}},{key:"close",value:function(){}}])}();function Dt(e){"@babel/helpers - typeof";return Dt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dt(e)}function Cs(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ts(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Es(n.key),n)}}function xs(e,t,r){return t&&Ts(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Es(e){var t=Us(e,"string");return Dt(t)=="symbol"?t:t+""}function Us(e,t){if(Dt(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Dt(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function jn(e){return e===void 0?0:e.size!==void 0?e.size:e.length}function ks(e,t){if(e.concat)return e.concat(t);if(e instanceof Blob)return new Blob([e,t],{type:e.type});if(e.set){var r=new e.constructor(e.length+t.length);return r.set(e),r.set(t,e.length),r}throw new Error("Unknown data type")}var Os=function(){function e(t){Cs(this,e),this._buffer=void 0,this._bufferOffset=0,this._reader=t,this._done=!1}return xs(e,[{key:"slice",value:function(r,n){return r<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(r,n)}},{key:"_readUntilEnoughDataOrDone",value:function(r,n){var i=this,o=n<=this._bufferOffset+jn(this._buffer);if(this._done||o){var s=this._getDataFromBuffer(r,n),u=s==null?this._done:!1;return Promise.resolve({value:s,done:u})}return this._reader.read().then(function(h){var v=h.value,S=h.done;return S?i._done=!0:i._buffer===void 0?i._buffer=v:i._buffer=ks(i._buffer,v),i._readUntilEnoughDataOrDone(r,n)})}},{key:"_getDataFromBuffer",value:function(r,n){r>this._bufferOffset&&(this._buffer=this._buffer.slice(r-this._bufferOffset),this._bufferOffset=r);var i=jn(this._buffer)===0;return this._done&&i?null:this._buffer.slice(0,n-r)}},{key:"close",value:function(){this._reader.cancel&&this._reader.cancel()}}])}();function Qe(e){"@babel/helpers - typeof";return Qe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qe(e)}function Nr(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Nr=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(c,l,f){c[l]=f.value},o=typeof Symbol=="function"?Symbol:{},s=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",h=o.toStringTag||"@@toStringTag";function v(c,l,f){return Object.defineProperty(c,l,{value:f,enumerable:!0,configurable:!0,writable:!0}),c[l]}try{v({},"")}catch{v=function(f,d,m){return f[d]=m}}function S(c,l,f,d){var m=l&&l.prototype instanceof be?l:be,p=Object.create(m.prototype),x=new Ae(d||[]);return i(p,"_invoke",{value:vt(c,f,x)}),p}function g(c,l,f){try{return{type:"normal",arg:c.call(l,f)}}catch(d){return{type:"throw",arg:d}}}t.wrap=S;var J="suspendedStart",me="suspendedYield",j="executing",B="completed",D={};function be(){}function fe(){}function q(){}var le={};v(le,s,function(){return this});var Se=Object.getPrototypeOf,ce=Se&&Se(Se(Te([])));ce&&ce!==r&&n.call(ce,s)&&(le=ce);var ue=q.prototype=be.prototype=Object.create(le);function Le(c){["next","throw","return"].forEach(function(l){v(c,l,function(f){return this._invoke(l,f)})})}function we(c,l){function f(m,p,x,O){var R=g(c[m],c,p);if(R.type!=="throw"){var te=R.arg,Z=te.value;return Z&&Qe(Z)=="object"&&n.call(Z,"__await")?l.resolve(Z.__await).then(function(ie){f("next",ie,x,O)},function(ie){f("throw",ie,x,O)}):l.resolve(Z).then(function(ie){te.value=ie,x(te)},function(ie){return f("throw",ie,x,O)})}O(R.arg)}var d;i(this,"_invoke",{value:function(p,x){function O(){return new l(function(R,te){f(p,x,R,te)})}return d=d?d.then(O,O):O()}})}function vt(c,l,f){var d=J;return function(m,p){if(d===j)throw Error("Generator is already running");if(d===B){if(m==="throw")throw p;return{value:e,done:!0}}for(f.method=m,f.arg=p;;){var x=f.delegate;if(x){var O=Me(x,f);if(O){if(O===D)continue;return O}}if(f.method==="next")f.sent=f._sent=f.arg;else if(f.method==="throw"){if(d===J)throw d=B,f.arg;f.dispatchException(f.arg)}else f.method==="return"&&f.abrupt("return",f.arg);d=j;var R=g(c,l,f);if(R.type==="normal"){if(d=f.done?B:me,R.arg===D)continue;return{value:R.arg,done:f.done}}R.type==="throw"&&(d=B,f.method="throw",f.arg=R.arg)}}}function Me(c,l){var f=l.method,d=c.iterator[f];if(d===e)return l.delegate=null,f==="throw"&&c.iterator.return&&(l.method="return",l.arg=e,Me(c,l),l.method==="throw")||f!=="return"&&(l.method="throw",l.arg=new TypeError("The iterator does not provide a '"+f+"' method")),D;var m=g(d,c.iterator,l.arg);if(m.type==="throw")return l.method="throw",l.arg=m.arg,l.delegate=null,D;var p=m.arg;return p?p.done?(l[c.resultName]=p.value,l.next=c.nextLoc,l.method!=="return"&&(l.method="next",l.arg=e),l.delegate=null,D):p:(l.method="throw",l.arg=new TypeError("iterator result is not an object"),l.delegate=null,D)}function Ne(c){var l={tryLoc:c[0]};1 in c&&(l.catchLoc=c[1]),2 in c&&(l.finallyLoc=c[2],l.afterLoc=c[3]),this.tryEntries.push(l)}function Ce(c){var l=c.completion||{};l.type="normal",delete l.arg,c.completion=l}function Ae(c){this.tryEntries=[{tryLoc:"root"}],c.forEach(Ne,this),this.reset(!0)}function Te(c){if(c||c===""){var l=c[s];if(l)return l.call(c);if(typeof c.next=="function")return c;if(!isNaN(c.length)){var f=-1,d=function m(){for(;++f<c.length;)if(n.call(c,f))return m.value=c[f],m.done=!1,m;return m.value=e,m.done=!0,m};return d.next=d}}throw new TypeError(Qe(c)+" is not iterable")}return fe.prototype=q,i(ue,"constructor",{value:q,configurable:!0}),i(q,"constructor",{value:fe,configurable:!0}),fe.displayName=v(q,h,"GeneratorFunction"),t.isGeneratorFunction=function(c){var l=typeof c=="function"&&c.constructor;return!!l&&(l===fe||(l.displayName||l.name)==="GeneratorFunction")},t.mark=function(c){return Object.setPrototypeOf?Object.setPrototypeOf(c,q):(c.__proto__=q,v(c,h,"GeneratorFunction")),c.prototype=Object.create(ue),c},t.awrap=function(c){return{__await:c}},Le(we.prototype),v(we.prototype,u,function(){return this}),t.AsyncIterator=we,t.async=function(c,l,f,d,m){m===void 0&&(m=Promise);var p=new we(S(c,l,f,d),m);return t.isGeneratorFunction(l)?p:p.next().then(function(x){return x.done?x.value:p.next()})},Le(ue),v(ue,h,"Generator"),v(ue,s,function(){return this}),v(ue,"toString",function(){return"[object Generator]"}),t.keys=function(c){var l=Object(c),f=[];for(var d in l)f.push(d);return f.reverse(),function m(){for(;f.length;){var p=f.pop();if(p in l)return m.value=p,m.done=!1,m}return m.done=!0,m}},t.values=Te,Ae.prototype={constructor:Ae,reset:function(l){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(Ce),!l)for(var f in this)f.charAt(0)==="t"&&n.call(this,f)&&!isNaN(+f.slice(1))&&(this[f]=e)},stop:function(){this.done=!0;var l=this.tryEntries[0].completion;if(l.type==="throw")throw l.arg;return this.rval},dispatchException:function(l){if(this.done)throw l;var f=this;function d(te,Z){return x.type="throw",x.arg=l,f.next=te,Z&&(f.method="next",f.arg=e),!!Z}for(var m=this.tryEntries.length-1;m>=0;--m){var p=this.tryEntries[m],x=p.completion;if(p.tryLoc==="root")return d("end");if(p.tryLoc<=this.prev){var O=n.call(p,"catchLoc"),R=n.call(p,"finallyLoc");if(O&&R){if(this.prev<p.catchLoc)return d(p.catchLoc,!0);if(this.prev<p.finallyLoc)return d(p.finallyLoc)}else if(O){if(this.prev<p.catchLoc)return d(p.catchLoc,!0)}else{if(!R)throw Error("try statement without catch or finally");if(this.prev<p.finallyLoc)return d(p.finallyLoc)}}}},abrupt:function(l,f){for(var d=this.tryEntries.length-1;d>=0;--d){var m=this.tryEntries[d];if(m.tryLoc<=this.prev&&n.call(m,"finallyLoc")&&this.prev<m.finallyLoc){var p=m;break}}p&&(l==="break"||l==="continue")&&p.tryLoc<=f&&f<=p.finallyLoc&&(p=null);var x=p?p.completion:{};return x.type=l,x.arg=f,p?(this.method="next",this.next=p.finallyLoc,D):this.complete(x)},complete:function(l,f){if(l.type==="throw")throw l.arg;return l.type==="break"||l.type==="continue"?this.next=l.arg:l.type==="return"?(this.rval=this.arg=l.arg,this.method="return",this.next="end"):l.type==="normal"&&f&&(this.next=f),D},finish:function(l){for(var f=this.tryEntries.length-1;f>=0;--f){var d=this.tryEntries[f];if(d.finallyLoc===l)return this.complete(d.completion,d.afterLoc),Ce(d),D}},catch:function(l){for(var f=this.tryEntries.length-1;f>=0;--f){var d=this.tryEntries[f];if(d.tryLoc===l){var m=d.completion;if(m.type==="throw"){var p=m.arg;Ce(d)}return p}}throw Error("illegal catch attempt")},delegateYield:function(l,f,d){return this.delegate={iterator:Te(l),resultName:f,nextLoc:d},this.method==="next"&&(this.arg=e),D}},t}function Ln(e,t,r,n,i,o,s){try{var u=e[o](s),h=u.value}catch(v){r(v);return}u.done?t(h):Promise.resolve(h).then(n,i)}function Ps(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function s(h){Ln(o,n,i,s,u,"next",h)}function u(h){Ln(o,n,i,s,u,"throw",h)}s(void 0)})}}function Rs(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function As(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ds(n.key),n)}}function Is(e,t,r){return t&&As(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ds(e){var t=Fs(e,"string");return Qe(t)=="symbol"?t:t+""}function Fs(e,t){if(Qe(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Qe(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var js=function(){function e(){Rs(this,e)}return Is(e,[{key:"openFile",value:function(){var t=Ps(Nr().mark(function n(i,o){var s;return Nr().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!(Ei()&&i&&typeof i.uri<"u")){h.next=11;break}return h.prev=1,h.next=4,ms(i.uri);case 4:return s=h.sent,h.abrupt("return",new Fn(s));case 8:throw h.prev=8,h.t0=h.catch(1),new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. ".concat(h.t0));case 11:if(!(typeof i.slice=="function"&&typeof i.size<"u")){h.next=13;break}return h.abrupt("return",Promise.resolve(new Fn(i)));case 13:if(typeof i.read!="function"){h.next=18;break}if(o=Number(o),Number.isFinite(o)){h.next=17;break}return h.abrupt("return",Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option")));case 17:return h.abrupt("return",Promise.resolve(new Os(i,o)));case 18:return h.abrupt("return",Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment")));case 19:case"end":return h.stop()}},n,null,[[1,8]])}));function r(n,i){return t.apply(this,arguments)}return r}()}])}();function Ls(e,t){return Ei()?Promise.resolve(zs(e,t)):Promise.resolve(["tus-br",e.name,e.type,e.size,e.lastModified,t.endpoint].join("-"))}function zs(e,t){var r=e.exif?Bs(JSON.stringify(e.exif)):"noexif";return["tus-rn",e.name||"noname",e.size||"nosize",r,t.endpoint].join("/")}function Bs(e){var t=0;if(e.length===0)return t;for(var r=0;r<e.length;r++){var n=e.charCodeAt(r);t=(t<<5)-t+n,t&=t}return t}function Ft(e){"@babel/helpers - typeof";return Ft=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ft(e)}function ln(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ms(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ns(n.key),n)}}function un(e,t,r){return t&&Ms(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ns(e){var t=Hs(e,"string");return Ft(t)=="symbol"?t:t+""}function Hs(e,t){if(Ft(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Ft(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var $s=function(){function e(){ln(this,e)}return un(e,[{key:"createRequest",value:function(r,n){return new qs(r,n)}},{key:"getName",value:function(){return"XHRHttpStack"}}])}(),qs=function(){function e(t,r){ln(this,e),this._xhr=new XMLHttpRequest,this._xhr.open(t,r,!0),this._method=t,this._url=r,this._headers={}}return un(e,[{key:"getMethod",value:function(){return this._method}},{key:"getURL",value:function(){return this._url}},{key:"setHeader",value:function(r,n){this._xhr.setRequestHeader(r,n),this._headers[r]=n}},{key:"getHeader",value:function(r){return this._headers[r]}},{key:"setProgressHandler",value:function(r){"upload"in this._xhr&&(this._xhr.upload.onprogress=function(n){n.lengthComputable&&r(n.loaded)})}},{key:"send",value:function(){var r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return new Promise(function(i,o){r._xhr.onload=function(){i(new Ws(r._xhr))},r._xhr.onerror=function(s){o(s)},r._xhr.send(n)})}},{key:"abort",value:function(){return this._xhr.abort(),Promise.resolve()}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}(),Ws=function(){function e(t){ln(this,e),this._xhr=t}return un(e,[{key:"getStatus",value:function(){return this._xhr.status}},{key:"getHeader",value:function(r){return this._xhr.getResponseHeader(r)}},{key:"getBody",value:function(){return this._xhr.responseText}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}();function jt(e){"@babel/helpers - typeof";return jt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jt(e)}function Vs(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Gs(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Xs(n.key),n)}}function Ks(e,t,r){return t&&Gs(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Xs(e){var t=Js(e,"string");return jt(t)=="symbol"?t:t+""}function Js(e,t){if(jt(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(jt(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Hr=!1;try{Hr="localStorage"in window;var Tr="tusSupport",zn=localStorage.getItem(Tr);localStorage.setItem(Tr,zn),zn===null&&localStorage.removeItem(Tr)}catch(e){if(e.code===e.SECURITY_ERR||e.code===e.QUOTA_EXCEEDED_ERR)Hr=!1;else throw e}var Zs=Hr,Ys=function(){function e(){Vs(this,e)}return Ks(e,[{key:"findAllUploads",value:function(){var r=this._findEntries("tus::");return Promise.resolve(r)}},{key:"findUploadsByFingerprint",value:function(r){var n=this._findEntries("tus::".concat(r,"::"));return Promise.resolve(n)}},{key:"removeUpload",value:function(r){return localStorage.removeItem(r),Promise.resolve()}},{key:"addUpload",value:function(r,n){var i=Math.round(Math.random()*1e12),o="tus::".concat(r,"::").concat(i);return localStorage.setItem(o,JSON.stringify(n)),Promise.resolve(o)}},{key:"_findEntries",value:function(r){for(var n=[],i=0;i<localStorage.length;i++){var o=localStorage.key(i);if(o.indexOf(r)===0)try{var s=JSON.parse(localStorage.getItem(o));s.urlStorageKey=o,n.push(s)}catch{}}return n}}])}();function pt(e){"@babel/helpers - typeof";return pt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pt(e)}function Qs(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function el(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ki(n.key),n)}}function tl(e,t,r){return r&&el(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function rl(e,t,r){return t=vr(t),nl(e,Ui()?Reflect.construct(t,r||[],vr(e).constructor):t.apply(e,r))}function nl(e,t){if(t&&(pt(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return il(e)}function il(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ui(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ui=function(){return!!e})()}function vr(e){return vr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},vr(e)}function ol(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$r(e,t)}function $r(e,t){return $r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},$r(e,t)}function Bn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function ut(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Bn(Object(r),!0).forEach(function(n){al(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bn(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function al(e,t,r){return t=ki(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ki(e){var t=sl(e,"string");return pt(t)=="symbol"?t:t+""}function sl(e,t){if(pt(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(pt(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Mn=ut(ut({},mr.defaultOptions),{},{httpStack:new $s,fileReader:new js,urlStorage:Zs?new Ys:new Oa,fingerprint:Ls}),ll=function(e){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Qs(this,t),n=ut(ut({},Mn),n),rl(this,t,[r,n])}return ol(t,e),tl(t,null,[{key:"terminate",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return i=ut(ut({},Mn),i),mr.terminate(n,i)}}])}(mr);const ul={endpoint:"",chunkSize:5*1024*1024,retryDelays:[0,1e3,3e3,5e3],maxRetries:3};class fl{constructor(t={}){A(this,"config");A(this,"currentUpload",null);this.config={...ul,...t}}async uploadVideo(t,r,n){return new Promise((i,o)=>{const s=new Blob([t.buffer],{type:"video/mp4"});this.currentUpload=new ll(s,{endpoint:r,chunkSize:this.config.chunkSize,retryDelays:this.config.retryDelays,metadata:{filetype:"video/mp4",name:`jump_${Date.now()}.mp4`},onProgress:(u,h)=>{n&&n({phase:"video",bytesUploaded:u,bytesTotal:h,percentage:Math.round(u/h*100)})},onSuccess:()=>{var h;const u=(h=this.currentUpload)==null?void 0:h.url;if(u){const v=cl(u);i(v)}else o(new $("UPLOAD_FAILED","No upload URL returned"))},onError:u=>{o(new $("UPLOAD_FAILED",u.message,!0))}}),this.currentUpload.start()})}abort(){this.currentUpload&&(this.currentUpload.abort(),this.currentUpload=null)}canResume(){return this.currentUpload!==null}resume(){this.currentUpload&&this.currentUpload.start()}}function cl(e){const t=e.split("/");return t[t.length-1]||e}var Nt,Ht,$t,qt,Wt,Vt,Gt;class hl{constructor(t){ye(this,Nt,se("idle"));ye(this,Ht,se(null));ye(this,$t,se(null));ye(this,qt,se(null));ye(this,Wt,se(null));ye(this,Vt,se(0));ye(this,Gt,se(null));A(this,"config");A(this,"convexUrl");A(this,"userId");A(this,"camera");A(this,"motion");A(this,"encoder",null);A(this,"fallbackRecorder",null);A(this,"tusUploader");A(this,"useWebCodecs",!1);A(this,"captureStartTime",0);A(this,"captureInterval",null);A(this,"frameReader",null);this.config=t,this.convexUrl=t.convexUrl.replace(".convex.cloud",".convex.site"),this.userId=t.userId||this.generateAnonId(),this.camera=new Qi({frameRate:60}),this.motion=new ro,this.tusUploader=new fl,this.loadCalibration()}get state(){return b(M(this,Nt))}set state(t){F(M(this,Nt),t,!0)}get session(){return b(M(this,Ht))}set session(t){F(M(this,Ht),t,!0)}get lastJump(){return b(M(this,$t))}set lastJump(t){F(M(this,$t),t,!0)}get error(){return b(M(this,qt))}set error(t){F(M(this,qt),t,!0)}get uploadProgress(){return b(M(this,Wt))}set uploadProgress(t){F(M(this,Wt),t,!0)}get recordingDuration(){return b(M(this,Vt))}set recordingDuration(t){F(M(this,Vt),t,!0)}get calibration(){return b(M(this,Gt))}set calibration(t){F(M(this,Gt),t,!0)}loadCalibration(){if(!(typeof sessionStorage>"u"))try{const t=sessionStorage.getItem("xlens_calibration");t&&(this.calibration=JSON.parse(t),console.log("[xLENS] Loaded calibration:",this.calibration))}catch(t){console.warn("[xLENS] Failed to load calibration:",t)}}setCalibration(t){this.calibration=t,typeof sessionStorage<"u"&&sessionStorage.setItem("xlens_calibration",JSON.stringify(t))}getCalibration(){return this.calibration}generateAnonId(){const t="xlens_anon_id";let r=typeof localStorage<"u"?localStorage.getItem(t):null;return r||(r=`anon_${crypto.randomUUID()}`,typeof localStorage<"u"&&localStorage.setItem(t,r)),r}async checkCompatibility(){this.setState("checking_compatibility");try{const t=await eo();return t.isCompatible?(this.useWebCodecs=t.hasWebCodecs,this.setState("idle"),!0):(this.setError(new $("UNSUPPORTED_BROWSER",t.errors.join(", "))),this.setState("unsupported"),!1)}catch(t){return this.handleError(t,"Compatibility check failed"),!1}}async requestPermissions(){this.setState("requesting_permissions");try{return await this.camera.start(),this.motion.isAvailable()&&await this.motion.requestPermission(),this.setState("idle"),!0}catch(t){return this.handleError(t,"Permission request failed"),!1}}async createSession(){this.setState("preparing_session");try{const t=await this.callXLensHttp("/xlens/session",{deviceId:this.userId}),r={id:t.sessionId,nonce:t.nonce,nonceDisplay:t.nonceDisplay,expiresAt:new Date(t.expiresAt),deviceKeyId:"web-demo"};return this.session=r,this.setState("session_ready"),r}catch(t){throw this.handleError(t,"Session creation failed"),t}}async startCapture(){if(this.state!=="session_ready"||!this.session)throw new $("CAPTURE_FAILED","No active session");if(new Date>this.session.expiresAt)throw new $("SESSION_EXPIRED","Session has expired");this.setState("capturing"),this.captureStartTime=Date.now(),this.recordingDuration=0;try{if(this.camera.isActive||await this.camera.start(),this.motion.isAvailable()&&this.motion.start(),this.useWebCodecs){const t=this.camera.getDimensions();this.encoder=new tn({width:t.width,height:t.height,framerate:this.camera.actualFrameRate}),await this.encoder.initialize(),this.startFrameCapture()}else this.fallbackRecorder=new pr,this.fallbackRecorder.initialize(this.camera.stream),this.fallbackRecorder.start();this.captureInterval=setInterval(()=>{this.recordingDuration=Date.now()-this.captureStartTime},100)}catch(t){throw this.handleError(t,"Capture start failed"),t}}async stopCapture(){if(this.state!=="capturing")throw new $("CAPTURE_FAILED","Not capturing");this.setState("processing"),this.captureInterval&&(clearInterval(this.captureInterval),this.captureInterval=null);try{this.stopFrameCapture();let t,r;if(this.useWebCodecs&&this.encoder)t=await this.encoder.finalize(),r=this.encoder.getStats().actualFps;else if(this.fallbackRecorder)t=await this.fallbackRecorder.stop(),r=30;else throw new $("CAPTURE_FAILED","No encoder available");const n=this.motion.stop(),i=await ni(t),o=no(n),s=await pa(o);return{videoData:t,sensorData:n,startedAtMs:this.captureStartTime,endedAtMs:Date.now(),fps:r,frameCount:t.length,videoHash:i,sensorHash:s}}catch(t){throw this.handleError(t,"Capture processing failed"),t}}async submitJump(t){var r;if(!this.session)throw new $("CAPTURE_FAILED","No active session");this.setState("uploading");try{const n=await this.callXLensHttp("/xlens/upload",{sessionId:this.session.id}),i=new Blob([t.videoData.buffer],{type:"video/mp4"}),o=await fetch(n.uploadUrl,{method:"POST",body:i});if(!o.ok)throw new $("UPLOAD_FAILED","Video upload failed");const{storageId:s}=await o.json();this.uploadProgress={phase:"video",bytesUploaded:t.videoData.length,bytesTotal:t.videoData.length,percentage:100};const u=await this.callXLensHttp("/xlens/submit",{sessionId:this.session.id,storageId:s,deviceId:this.userId,durationMs:t.endedAtMs-t.startedAtMs,fps:t.fps,userHeightInches:(r=this.calibration)==null?void 0:r.heightInches});return this.setState("submitted"),{jumpId:u.jumpId,status:u.status,verificationTier:"bronze",message:u.message||"Jump submitted for analysis"}}catch(n){throw this.handleError(n,"Submission failed"),n}}async getJumpResult(t){const r=await this.callXLensHttp("/xlens/result",{jumpId:t}),n={jumpId:r.jumpId,userId:this.userId,status:r.status,verificationTier:r.verificationTier,height:r.heightInches?{inches:r.heightInches,centimeters:r.heightCm||r.heightInches*2.54}:void 0,videoUrl:r.videoUrl,thumbnailUrl:void 0,processedAt:r.processedAt?new Date(r.processedAt):void 0,flags:r.flags};return this.lastJump=n,r.status==="complete"&&this.setState("complete"),n}cancel(){this.stopFrameCapture(),this.motion.stop(),this.tusUploader.abort(),this.encoder&&(this.encoder.abort(),this.encoder=null),this.fallbackRecorder&&(this.fallbackRecorder.abort(),this.fallbackRecorder=null),this.captureInterval&&(clearInterval(this.captureInterval),this.captureInterval=null),this.setState("idle")}reset(){this.cancel(),this.camera.stop(),this.session=null,this.lastJump=null,this.error=null,this.uploadProgress=null,this.recordingDuration=0,this.setState("idle")}getStream(){return this.camera.stream}getSessionTimeRemaining(){if(!this.session)return 0;const t=(this.session.expiresAt.getTime()-Date.now())/1e3;return Math.max(0,t)}setState(t){var r,n;this.state=t,(n=(r=this.config).onStateChange)==null||n.call(r,t)}setError(t){var r,n;this.error=t,this.setState("error"),(n=(r=this.config).onError)==null||n.call(r,t)}handleError(t,r){const n=t instanceof $?t:new $("UNKNOWN_ERROR",t instanceof Error?`${r}: ${t.message}`:r);this.setError(n)}startFrameCapture(){if(!this.camera.stream||!this.encoder)return;const t=this.camera.stream.getVideoTracks()[0];if("MediaStreamTrackProcessor"in window){const r=new MediaStreamTrackProcessor({track:t});this.frameReader=r.readable.getReader(),(async()=>{for(;this.state==="capturing"&&this.frameReader&&this.encoder;){const{value:i,done:o}=await this.frameReader.read();if(o)break;this.encoder.encodeFrame(i)}})().catch(console.error)}}stopFrameCapture(){this.frameReader&&(this.frameReader.cancel(),this.frameReader=null)}async callXLensHttp(t,r){const n=await fetch(`${this.convexUrl}${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok){const i=await n.text();throw new $("NETWORK_ERROR",`xLENS API call failed: ${i}`)}return n.json()}}Nt=new WeakMap,Ht=new WeakMap,$t=new WeakMap,qt=new WeakMap,Wt=new WeakMap,Vt=new WeakMap,Gt=new WeakMap;function dl(e){return new hl(e)}function pl(e){const t=Math.floor(e/1e3),r=Math.floor(e%1e3/100);return`${t}.${r}s`}function ml(e){const t=Math.floor(e/60),r=Math.floor(e%60);return`${t}:${r.toString().padStart(2,"0")}`}var vl=V("<div> </div>"),yl=V('<div class="flex items-center gap-2 px-3 py-1 rounded-full bg-red-500/80"><div class="recording-dot"></div> <span class="font-mono"> </span></div>'),gl=V(`<div class="text-center"><button class="w-32 h-32 rounded-full bg-yp-primary flex flex-col items-center justify-center
							   transition-transform active:scale-95 shadow-lg shadow-yp-primary/30 mb-4"><svg class="w-12 h-12 text-white mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> <span class="text-white font-semibold text-sm">Start</span></button> <p class="text-white/60 text-sm">Tap to enable camera</p></div>`),bl=V('<div class="nonce-overlay text-4xl font-bold text-white/90 bg-black/40 px-6 py-3 rounded-2xl"> </div> <p class="mt-2 text-sm text-white/60">Show this code in your video</p>',1),wl=V('<div class="text-white/80">Checking browser compatibility...</div>'),_l=V('<div class="text-white/80">Please allow camera access</div>'),Sl=V('<div class="text-white/80">Preparing session...</div>'),Cl=V('<div class="text-white/80">Processing video...</div>'),Tl=V('<div class="progress-bar w-48"><div class="progress-fill"></div></div> <div class="text-sm text-white/60 mt-1"> </div>',1),xl=V('<div class="text-center"><div class="text-white/80 mb-2">Uploading...</div> <!></div>'),El=V('<div class="text-center px-4"><div class="text-yp-error text-lg mb-2">Error</div> <div class="text-white/70 text-sm break-all mb-2"> </div> <div class="text-white/40 text-xs break-all font-mono bg-black/30 p-2 rounded max-w-xs mx-auto"> </div> <button class="btn-secondary mt-4">Try Again</button></div>'),Ul=V('<div class="text-center max-w-xs"><div class="text-yp-error text-lg mb-2">Browser Not Supported</div> <div class="text-white/70">Please use Safari on iOS or Chrome on Android.</div></div>'),kl=V('<button aria-label="Start recording"><div class="w-8 h-8 rounded-full bg-white"></div></button>'),Ol=V(`<button aria-label="Stop recording" class="w-20 h-20 rounded-full bg-red-500 flex items-center justify-center
							   transition-transform active:scale-95 shadow-lg shadow-red-500/30"><div class="w-8 h-8 rounded bg-white"></div></button>`),Pl=V('<div class="w-20 h-20 rounded-full bg-white/20 flex items-center justify-center"><div class="w-8 h-8 border-2 border-white/40 border-t-white rounded-full animate-spin"></div></div>'),Rl=V('<p class="text-center text-green-400 mt-4 text-sm font-medium">Tap to start recording. Show the code, then jump!</p>'),Al=V('<p class="text-center text-white/60 mt-4 text-sm">Tap to stop when done</p>'),Il=V('<span class="text-green-400">(Locked)</span>'),Dl=V('<div class="mt-4 flex items-center justify-center gap-2 text-sm"><div></div> <span class="text-white/60"> <!></span> <button class="text-yp-primary underline text-xs">Edit</button></div>'),Fl=V('<button class="mt-4 text-sm text-yp-primary underline">Add your height for better accuracy</button>'),jl=V('<div class="relative min-h-screen bg-black"><video autoplay playsinline="" class="absolute inset-0 w-full h-full object-cover video-preview"></video>  <div class="absolute inset-0 flex flex-col"><div class="flex items-center justify-between p-4 bg-gradient-to-b from-black/50 to-transparent"><button aria-label="Go back" class="p-2 text-white/80 hover:text-white"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button> <!> <!></div> <div class="flex-1 flex flex-col items-center justify-center"><!> <!> <!></div> <div class="p-6 bg-gradient-to-t from-black/50 to-transparent"><div class="flex items-center justify-center gap-6"><!></div> <!> <!> <div class="mt-4 text-xs text-white/40 font-mono text-center"> </div></div></div></div>',2);function Xl(e,t){qi(t,!0);let r=se(null),n=se(null),i=null,o=se(120),s=se(!0),u=!0,h=it(()=>{var y;return((y=b(r))==null?void 0:y.state)??"idle"}),v=it(()=>{var y;return((y=b(r))==null?void 0:y.session)??null}),S=it(()=>{var y;return((y=b(r))==null?void 0:y.error)??null}),g=it(()=>{var y;return((y=b(r))==null?void 0:y.recordingDuration)??0}),J=it(()=>{var y;return((y=b(r))==null?void 0:y.uploadProgress)??null}),me=it(()=>{var y;return((y=b(r))==null?void 0:y.calibration)??null}),j=se(""),B=se("");Hi(async()=>{try{if(F(B,"https://lovable-heron-569.convex.cloud",!0),F(j,"Tap to start camera"),F(r,dl({convexUrl:b(B)}),!0),!await b(r).checkCompatibility()){F(j,"Browser not compatible"),F(s,!1);return}F(j,'Tap "Start Camera" below')}catch(y){F(j,`Error: ${y instanceof Error?y.message:String(y)}`),console.error("xLENS init error:",y)}}),$i(()=>{var y;i&&clearInterval(i),(y=b(r))==null||y.reset()});async function D(){if(b(r))try{if(F(s,!1),F(j,"Requesting camera access..."),!await b(r).requestPermissions()){F(j,"Camera permission denied. Please allow access."),F(s,!0);return}F(j,"Connecting camera..."),b(n)&&b(r).getStream()&&(b(n).srcObject=b(r).getStream()),F(j,"Creating session..."),await b(r).createSession(),F(j,"Ready! Tap record when ready to jump"),i=setInterval(()=>{var T,L;F(o,Math.max(0,((T=b(r))==null?void 0:T.getSessionTimeRemaining())??0),!0),b(o)<=0&&b(v)&&((L=b(r))==null||L.createSession())},1e3)}catch(y){F(j,`Error: ${y instanceof Error?y.message:String(y)}`),F(s,!0),console.error("Camera start error:",y)}}async function be(){b(r)&&await b(r).startCapture()}async function fe(){if(!b(r))return;const y=await b(r).stopCapture(),T=await b(r).submitJump(y);Zt(`/result/${T.jumpId}`)}var q=jl(),le=G(q);le.muted=!0,Ki(le,y=>F(n,y),()=>b(n));var Se=Q(le,2),ce=G(Se),ue=G(ce);ue.__click=()=>Zt("/");var Le=Q(ue,2);{var we=y=>{var T=vl();let L;var Y=G(T);K(T),We(N=>{L=Sr(T,1,"px-3 py-1 rounded-full bg-black/40 text-sm font-mono",null,L,{"timer-warning":b(o)<30,"timer-critical":b(o)<10}),Be(Y,`Session: ${N??""}`)},[()=>ml(b(o))]),P(y,T)};W(Le,y=>{b(v)&&b(h)!=="capturing"&&y(we)})}var vt=Q(Le,2);{var Me=y=>{var T=yl(),L=Q(G(T),2),Y=G(L,!0);K(L),K(T),We(N=>Be(Y,N),[()=>pl(b(g))]),P(y,T)};W(vt,y=>{b(h)==="capturing"&&y(Me)})}K(ce);var Ne=Q(ce,2),Ce=G(Ne);{var Ae=y=>{var T=gl(),L=G(T);L.__click=D,pn(2),K(T),P(y,T)};W(Ce,y=>{b(s)&&b(h)==="idle"&&y(Ae)})}var Te=Q(Ce,2);{var c=y=>{var T=bl(),L=he(T),Y=G(L,!0);K(L),pn(2),We(()=>Be(Y,b(v).nonceDisplay)),P(y,T)};W(Te,y=>{b(v)&&b(h)!=="capturing"&&u&&y(c)})}var l=Q(Te,2);{var f=y=>{var T=wl();P(y,T)},d=y=>{var T=_e(),L=he(T);{var Y=H=>{var ve=_l();P(H,ve)},N=H=>{var ve=_e(),yt=he(ve);{var He=ze=>{var Xt=Sl();P(ze,Xt)},$e=ze=>{var Xt=_e(),Ai=he(Xt);{var Ii=et=>{var Jt=Cl();P(et,Jt)},Di=et=>{var Jt=_e(),Fi=he(Jt);{var ji=tt=>{var rt=xl(),br=Q(G(rt),2);{var wr=gt=>{var Ie=Tl(),xe=he(Ie),qe=G(xe);K(xe);var nt=Q(xe,2),De=G(nt);K(nt),We(()=>{Xi(qe,`width: ${b(J).percentage??""}%`),Be(De,`${b(J).percentage??""}%`)}),P(gt,Ie)};W(br,gt=>{b(J)&&gt(wr)})}K(rt),P(tt,rt)},Li=tt=>{var rt=_e(),br=he(rt);{var wr=Ie=>{var xe=El(),qe=Q(G(xe),2),nt=G(qe,!0);K(qe);var De=Q(qe,2),_r=G(De,!0);K(De);var zi=Q(De,2);zi.__click=()=>{var bt;F(s,!0),(bt=b(r))==null||bt.reset()},K(xe),We(()=>{var bt;Be(nt,((bt=b(S))==null?void 0:bt.message)||"Unknown error"),Be(_r,b(j))}),P(Ie,xe)},gt=Ie=>{var xe=_e(),qe=he(xe);{var nt=De=>{var _r=Ul();P(De,_r)};W(qe,De=>{b(h)==="unsupported"&&De(nt)},!0)}P(Ie,xe)};W(br,Ie=>{b(h)==="error"?Ie(wr):Ie(gt,!1)},!0)}P(tt,rt)};W(Fi,tt=>{b(h)==="uploading"?tt(ji):tt(Li,!1)},!0)}P(et,Jt)};W(Ai,et=>{b(h)==="processing"?et(Ii):et(Di,!1)},!0)}P(ze,Xt)};W(yt,ze=>{b(h)==="preparing_session"?ze(He):ze($e,!1)},!0)}P(H,ve)};W(L,H=>{b(h)==="requesting_permissions"?H(Y):H(N,!1)},!0)}P(y,T)};W(l,y=>{b(h)==="checking_compatibility"?y(f):y(d,!1)})}K(Ne);var m=Q(Ne,2),p=G(m),x=G(p);{var O=y=>{var T=kl();T.__click=be,T.disabled=!u,Sr(T,1,`w-20 h-20 rounded-full flex items-center justify-center
							   transition-all active:scale-95 shadow-lg
							   bg-yp-primary shadow-yp-primary/30 cursor-pointer`),P(y,T)},R=y=>{var T=_e(),L=he(T);{var Y=H=>{var ve=Ol();ve.__click=fe,P(H,ve)},N=H=>{var ve=_e(),yt=he(ve);{var He=$e=>{var ze=Pl();P($e,ze)};W(yt,$e=>{["checking_compatibility","requesting_permissions","preparing_session","processing","uploading"].includes(b(h))&&$e(He)},!0)}P(H,ve)};W(L,H=>{b(h)==="capturing"?H(Y):H(N,!1)},!0)}P(y,T)};W(x,y=>{b(h)==="session_ready"?y(O):y(R,!1)})}K(p);var te=Q(p,2);{var Z=y=>{var T=_e(),L=he(T);{var Y=N=>{var H=Rl();P(N,H)};W(L,N=>{N(Y,!1)})}P(y,T)},ie=y=>{var T=_e(),L=he(T);{var Y=N=>{var H=Al();P(N,H)};W(L,N=>{b(h)==="capturing"&&N(Y)},!0)}P(y,T)};W(te,y=>{b(h)==="session_ready"?y(Z):y(ie,!1)})}var fn=Q(te,2);{var Oi=y=>{var T=Dl(),L=G(T);Sr(L,1,"w-2 h-2 rounded-full bg-green-500");var Y=Q(L,2),N=G(Y),H=Q(N);{var ve=He=>{var $e=Il();P(He,$e)};W(H,He=>{He(ve)})}K(Y);var yt=Q(Y,2);yt.__click=()=>Zt("/setup"),K(T),We(()=>Be(N,`Height: ${b(me).heightFeet??""}'${b(me).heightInchesRemainder??""}" `)),P(y,T)},Pi=y=>{var T=_e(),L=he(T);{var Y=N=>{var H=Fl();H.__click=()=>Zt("/setup"),P(N,H)};W(L,N=>{b(h)==="session_ready"&&N(Y)},!0)}P(y,T)};W(fn,y=>{b(me)&&b(h)==="session_ready"?y(Oi):y(Pi,!1)})}var cn=Q(fn,2),Ri=G(cn,!0);K(cn),K(m),K(Se),K(q),We(()=>Be(Ri,b(j))),P(e,q),Wi()}Vi(["click"]);export{Xl as component,Kl as universal};
