var ki=Object.defineProperty;var rn=e=>{throw TypeError(e)};var Pi=(e,t,r)=>t in e?ki(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var O=(e,t,r)=>Pi(e,typeof t!="symbol"?t+"":t,r),Oi=(e,t,r)=>t.has(e)||rn("Cannot "+r);var L=(e,t,r)=>(Oi(e,t,"read from private field"),r?r.call(e):t.get(e)),de=(e,t,r)=>t.has(e)?rn("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r);import{f as X,a as D,c as Ue}from"../chunks/B-Tn0Iuz.js";import{o as Ri,a as Ai}from"../chunks/Bx1MBOAJ.js";import{j as nn,X as ie,g as b,h as oe,p as Ii,c as Q,a as Di,s as ue,Y as lt,r as ee,N as ut,M as pe,n as Fi}from"../chunks/D_JzRG0x.js";import{s as ft}from"../chunks/CdyOn7Ui.js";import{i as Z}from"../chunks/Dou0k9GB.js";import{d as ji}from"../chunks/Db4TDr3E.js";import{t as zi,s as Li}from"../chunks/C6h3zICr.js";import{b as Bi}from"../chunks/DlVJ0LMv.js";import{g as on}from"../chunks/CumJ52HM.js";function Mi(e,t,r,n){var i=e.__style;if(nn||i!==t){var o=zi(t);(!nn||o!==e.getAttribute("style"))&&(o==null?e.removeAttribute("style"):e.style.cssText=o),e.__style=t}return n}const Ni=!1,Hi=!1,Vl=Object.freeze(Object.defineProperty({__proto__:null,prerender:Hi,ssr:Ni},Symbol.toStringTag,{value:"Module"}));class F extends Error{constructor(t,r,n=!1){super(r),this.code=t,this.recoverable=n,this.name="XLensError"}}const $i={facingMode:"user",width:1280,height:720,frameRate:60};var kt,Pt,Ot,Rt;class Wi{constructor(t={}){de(this,kt,ie(null));de(this,Pt,ie(!1));de(this,Ot,ie(null));de(this,Rt,ie(0));O(this,"config");O(this,"videoTrack",null);this.config={...$i,...t}}get stream(){return b(L(this,kt))}set stream(t){oe(L(this,kt),t,!0)}get isActive(){return b(L(this,Pt))}set isActive(t){oe(L(this,Pt),t,!0)}get error(){return b(L(this,Ot))}set error(t){oe(L(this,Ot),t,!0)}get actualFrameRate(){return b(L(this,Rt))}set actualFrameRate(t){oe(L(this,Rt),t,!0)}async start(){try{this.error=null;const t={video:{facingMode:this.config.facingMode,width:{ideal:this.config.width},height:{ideal:this.config.height},frameRate:{ideal:this.config.frameRate}},audio:!1},r=await navigator.mediaDevices.getUserMedia(t);this.stream=r,this.isActive=!0,this.videoTrack=r.getVideoTracks()[0];const n=this.videoTrack.getSettings();return this.actualFrameRate=n.frameRate??this.config.frameRate,r}catch(t){const r=t instanceof Error?t.message:"Camera access failed";throw this.error=r,r.includes("Permission denied")||r.includes("NotAllowedError")?new F("CAMERA_PERMISSION_DENIED","Camera permission was denied",!0):new F("CAPTURE_FAILED",r,!1)}}stop(){this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.videoTrack=null,this.isActive=!1}async switchCamera(){return this.config.facingMode=this.config.facingMode==="user"?"environment":"user",this.stop(),this.start()}getSettings(){var t;return((t=this.videoTrack)==null?void 0:t.getSettings())??null}getDimensions(){const t=this.getSettings();return{width:(t==null?void 0:t.width)??this.config.width,height:(t==null?void 0:t.height)??this.config.height}}}kt=new WeakMap,Pt=new WeakMap,Ot=new WeakMap,Rt=new WeakMap;async function qi(){const e=[],t=[],r="VideoEncoder"in window&&"VideoFrame"in window;r||e.push("WebCodecs not available - using MediaRecorder fallback");const n="MediaRecorder"in window;!n&&!r&&t.push("Neither WebCodecs nor MediaRecorder available");const i="DeviceMotionEvent"in window;i||e.push("DeviceMotion not available - sensor data will be empty");let o=!1,a=!1;try{const d=await navigator.mediaDevices.enumerateDevices();o=d.some(v=>v.kind==="videoinput"),a=d.some(v=>v.kind==="audioinput"),o||t.push("No camera detected")}catch{t.push("Cannot enumerate media devices")}return{isCompatible:t.length===0&&(r||n),hasWebCodecs:r,hasMediaRecorder:n,hasDeviceMotion:i,hasCamera:o,hasMicrophone:a,warnings:e,errors:t}}function Vi(){var n,i,o,a;const e=navigator.userAgent;let t="Unknown",r="0";return e.includes("Firefox/")?(t="Firefox",r=((n=e.match(/Firefox\/(\d+)/))==null?void 0:n[1])??"0"):e.includes("Edg/")?(t="Edge",r=((i=e.match(/Edg\/(\d+)/))==null?void 0:i[1])??"0"):e.includes("Chrome/")?(t="Chrome",r=((o=e.match(/Chrome\/(\d+)/))==null?void 0:o[1])??"0"):e.includes("Safari/")&&!e.includes("Chrome")&&(t="Safari",r=((a=e.match(/Version\/(\d+)/))==null?void 0:a[1])??"0"),{userAgent:e,platform:navigator.platform,screenWidth:window.screen.width,screenHeight:window.screen.height,devicePixelRatio:window.devicePixelRatio,supportsWebCodecs:"VideoEncoder"in window,supportsDeviceMotion:"DeviceMotionEvent"in window,browserName:t,browserVersion:r}}async function Gi(){if(typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function")try{return await DeviceMotionEvent.requestPermission()==="granted"}catch{return!1}return!0}class Ki{constructor(){O(this,"samples",[]);O(this,"isCapturing",!1);O(this,"boundHandler");O(this,"permissionGranted",!1);this.boundHandler=this.handleMotion.bind(this)}async requestPermission(){return this.permissionGranted=await Gi(),this.permissionGranted}start(){this.isCapturing||(this.samples=[],this.isCapturing=!0,window.addEventListener("devicemotion",this.boundHandler,!0))}stop(){if(!this.isCapturing)return[];window.removeEventListener("devicemotion",this.boundHandler,!0),this.isCapturing=!1;const t=[...this.samples];return this.samples=[],t}getSampleCount(){return this.samples.length}isAvailable(){return"DeviceMotionEvent"in window}handleMotion(t){var n,i,o,a,u,d;if(!this.isCapturing)return;const r={timestamp:Date.now(),accelerationX:((n=t.accelerationIncludingGravity)==null?void 0:n.x)??0,accelerationY:((i=t.accelerationIncludingGravity)==null?void 0:i.y)??0,accelerationZ:((o=t.accelerationIncludingGravity)==null?void 0:o.z)??0,rotationAlpha:((a=t.rotationRate)==null?void 0:a.alpha)??null,rotationBeta:((u=t.rotationRate)==null?void 0:u.beta)??null,rotationGamma:((d=t.rotationRate)==null?void 0:d.gamma)??null};this.samples.push(r)}}function pr(e){return JSON.stringify(e)}var Fr=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},s=(e,t,r)=>(Fr(e,t,"read from private field"),r?r.call(e):t.get(e)),U=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},q=(e,t,r,n)=>(Fr(e,t,"write to private field"),t.set(e,r),r),Xi=(e,t,r,n)=>({set _(i){q(e,t,i)},get _(){return s(e,t,n)}}),x=(e,t,r)=>(Fr(e,t,"access private method"),r),k=new Uint8Array(8),be=new DataView(k.buffer),$=e=>[(e%256+256)%256],A=e=>(be.setUint16(0,e,!1),[k[0],k[1]]),Ji=e=>(be.setInt16(0,e,!1),[k[0],k[1]]),An=e=>(be.setUint32(0,e,!1),[k[1],k[2],k[3]]),g=e=>(be.setUint32(0,e,!1),[k[0],k[1],k[2],k[3]]),Yi=e=>(be.setInt32(0,e,!1),[k[0],k[1],k[2],k[3]]),Me=e=>(be.setUint32(0,Math.floor(e/2**32),!1),be.setUint32(4,e,!1),[k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7]]),jr=e=>(be.setInt16(0,2**8*e,!1),[k[0],k[1]]),ye=e=>(be.setInt32(0,2**16*e,!1),[k[0],k[1],k[2],k[3]]),cr=e=>(be.setInt32(0,2**30*e,!1),[k[0],k[1],k[2],k[3]]),fe=(e,t=!1)=>{let r=Array(e.length).fill(null).map((n,i)=>e.charCodeAt(i));return t&&r.push(0),r},Yt=e=>e&&e[e.length-1],zr=e=>{let t;for(let r of e)(!t||r.presentationTimestamp>t.presentationTimestamp)&&(t=r);return t},ge=(e,t,r=!0)=>{let n=e*t;return r?Math.round(n):n},In=e=>{let t=e*(Math.PI/180),r=Math.cos(t),n=Math.sin(t);return[r,n,0,-n,r,0,0,0,1]},Dn=In(0),Fn=e=>[ye(e[0]),ye(e[1]),cr(e[2]),ye(e[3]),ye(e[4]),cr(e[5]),ye(e[6]),ye(e[7]),cr(e[8])],mt=e=>!e||typeof e!="object"?e:Array.isArray(e)?e.map(mt):Object.fromEntries(Object.entries(e).map(([t,r])=>[t,mt(r)])),tt=e=>e>=0&&e<2**32,B=(e,t,r)=>({type:e,contents:t&&new Uint8Array(t.flat(10)),children:r}),j=(e,t,r,n,i)=>B(e,[$(t),An(r),n??[]],i),Zi=e=>{let t=512;return e.fragmented?B("ftyp",[fe("iso5"),g(t),fe("iso5"),fe("iso6"),fe("mp41")]):B("ftyp",[fe("isom"),g(t),fe("isom"),e.holdsAvc?fe("avc1"):[],fe("mp41")])},mr=e=>({type:"mdat",largeSize:e}),Qi=e=>({type:"free",size:e}),$t=(e,t,r=!1)=>B("moov",null,[eo(t,e),...e.map(n=>to(n,t)),r?Io(e):null]),eo=(e,t)=>{let r=ge(Math.max(0,...t.filter(a=>a.samples.length>0).map(a=>{const u=zr(a.samples);return u.presentationTimestamp+u.duration})),gr),n=Math.max(...t.map(a=>a.id))+1,i=!tt(e)||!tt(r),o=i?Me:g;return j("mvhd",+i,0,[o(e),o(e),g(gr),o(r),ye(1),jr(1),Array(10).fill(0),Fn(Dn),Array(24).fill(0),g(n)])},to=(e,t)=>B("trak",null,[ro(e,t),no(e,t)]),ro=(e,t)=>{let r=zr(e.samples),n=ge(r?r.presentationTimestamp+r.duration:0,gr),i=!tt(t)||!tt(n),o=i?Me:g,a;return e.info.type==="video"?a=typeof e.info.rotation=="number"?In(e.info.rotation):e.info.rotation:a=Dn,j("tkhd",+i,3,[o(t),o(t),g(e.id),g(0),o(n),Array(8).fill(0),A(0),A(0),jr(e.info.type==="audio"?1:0),A(0),Fn(a),ye(e.info.type==="video"?e.info.width:0),ye(e.info.type==="video"?e.info.height:0)])},no=(e,t)=>B("mdia",null,[io(e,t),oo(e.info.type==="video"?"vide":"soun"),ao(e)]),io=(e,t)=>{let r=zr(e.samples),n=ge(r?r.presentationTimestamp+r.duration:0,e.timescale),i=!tt(t)||!tt(n),o=i?Me:g;return j("mdhd",+i,0,[o(t),o(t),g(e.timescale),o(n),A(21956),A(0)])},oo=e=>j("hdlr",0,0,[fe("mhlr"),fe(e),g(0),g(0),g(0),fe("mp4-muxer-hdlr",!0)]),ao=e=>B("minf",null,[e.info.type==="video"?so():lo(),uo(),ho(e)]),so=()=>j("vmhd",0,1,[A(0),A(0),A(0),A(0)]),lo=()=>j("smhd",0,0,[A(0),A(0)]),uo=()=>B("dinf",null,[fo()]),fo=()=>j("dref",0,0,[g(1)],[co()]),co=()=>j("url ",0,1),ho=e=>{const t=e.compositionTimeOffsetTable.length>1||e.compositionTimeOffsetTable.some(r=>r.sampleCompositionTimeOffset!==0);return B("stbl",null,[po(e),xo(e),ko(e),Po(e),Oo(e),Ro(e),t?Ao(e):null])},po=e=>j("stsd",0,0,[g(1)],[e.info.type==="video"?mo($o[e.info.codec],e):To(qo[e.info.codec],e)]),mo=(e,t)=>B(e,[Array(6).fill(0),A(1),A(0),A(0),Array(12).fill(0),A(t.info.width),A(t.info.height),g(4718592),g(4718592),g(0),A(1),Array(32).fill(0),A(24),Ji(65535)],[Wo[t.info.codec](t),t.info.decoderConfig.colorSpace?wo(t):null]),vo={bt709:1,bt470bg:5,smpte170m:6},yo={bt709:1,smpte170m:6,"iec61966-2-1":13},go={rgb:0,bt709:1,bt470bg:5,smpte170m:6},wo=e=>B("colr",[fe("nclx"),A(vo[e.info.decoderConfig.colorSpace.primaries]),A(yo[e.info.decoderConfig.colorSpace.transfer]),A(go[e.info.decoderConfig.colorSpace.matrix]),$((e.info.decoderConfig.colorSpace.fullRange?1:0)<<7)]),bo=e=>e.info.decoderConfig&&B("avcC",[...new Uint8Array(e.info.decoderConfig.description)]),_o=e=>e.info.decoderConfig&&B("hvcC",[...new Uint8Array(e.info.decoderConfig.description)]),So=e=>{if(!e.info.decoderConfig)return null;let t=e.info.decoderConfig;if(!t.colorSpace)throw new Error("'colorSpace' is required in the decoder config for VP9.");let r=t.codec.split("."),n=Number(r[1]),i=Number(r[2]),u=(Number(r[3])<<4)+(0<<1)+Number(t.colorSpace.fullRange);return j("vpcC",1,0,[$(n),$(i),$(u),$(2),$(2),$(2),A(0)])},Co=()=>{let r=(1<<7)+1;return B("av1C",[r,0,0,0])},To=(e,t)=>B(e,[Array(6).fill(0),A(1),A(0),A(0),g(0),A(t.info.numberOfChannels),A(16),A(0),A(0),ye(t.info.sampleRate)],[Vo[t.info.codec](t)]),Eo=e=>{let t=new Uint8Array(e.info.decoderConfig.description);return j("esds",0,0,[g(58753152),$(32+t.byteLength),A(1),$(0),g(75530368),$(18+t.byteLength),$(64),$(21),An(0),g(130071),g(130071),g(92307584),$(t.byteLength),...t,g(109084800),$(1),$(2)])},Uo=e=>{var i;let t=3840,r=0;const n=(i=e.info.decoderConfig)==null?void 0:i.description;if(n){if(n.byteLength<18)throw new TypeError("Invalid decoder description provided for Opus; must be at least 18 bytes long.");const o=ArrayBuffer.isView(n)?new DataView(n.buffer,n.byteOffset,n.byteLength):new DataView(n);t=o.getUint16(10,!0),r=o.getInt16(14,!0)}return B("dOps",[$(0),$(e.info.numberOfChannels),A(t),g(e.info.sampleRate),jr(r),$(0)])},xo=e=>j("stts",0,0,[g(e.timeToSampleTable.length),e.timeToSampleTable.map(t=>[g(t.sampleCount),g(t.sampleDelta)])]),ko=e=>{if(e.samples.every(r=>r.type==="key"))return null;let t=[...e.samples.entries()].filter(([,r])=>r.type==="key");return j("stss",0,0,[g(t.length),t.map(([r])=>g(r+1))])},Po=e=>j("stsc",0,0,[g(e.compactlyCodedChunkTable.length),e.compactlyCodedChunkTable.map(t=>[g(t.firstChunk),g(t.samplesPerChunk),g(1)])]),Oo=e=>j("stsz",0,0,[g(0),g(e.samples.length),e.samples.map(t=>g(t.size))]),Ro=e=>e.finalizedChunks.length>0&&Yt(e.finalizedChunks).offset>=2**32?j("co64",0,0,[g(e.finalizedChunks.length),e.finalizedChunks.map(t=>Me(t.offset))]):j("stco",0,0,[g(e.finalizedChunks.length),e.finalizedChunks.map(t=>g(t.offset))]),Ao=e=>j("ctts",0,0,[g(e.compositionTimeOffsetTable.length),e.compositionTimeOffsetTable.map(t=>[g(t.sampleCount),g(t.sampleCompositionTimeOffset)])]),Io=e=>B("mvex",null,e.map(Do)),Do=e=>j("trex",0,0,[g(e.id),g(1),g(0),g(0),g(0)]),an=(e,t)=>B("moof",null,[Fo(e),...t.map(jo)]),Fo=e=>j("mfhd",0,0,[g(e)]),jn=e=>{let t=0,r=0,n=0,i=0,o=e.type==="delta";return r|=+o,o?t|=1:t|=2,t<<24|r<<16|n<<8|i},jo=e=>B("traf",null,[zo(e),Lo(e),Bo(e)]),zo=e=>{let t=0;t|=8,t|=16,t|=32,t|=131072;let r=e.currentChunk.samples[1]??e.currentChunk.samples[0],n={duration:r.timescaleUnitsToNextSample,size:r.size,flags:jn(r)};return j("tfhd",0,t,[g(e.id),g(n.duration),g(n.size),g(n.flags)])},Lo=e=>j("tfdt",1,0,[Me(ge(e.currentChunk.startTimestamp,e.timescale))]),Bo=e=>{let t=e.currentChunk.samples.map(z=>z.timescaleUnitsToNextSample),r=e.currentChunk.samples.map(z=>z.size),n=e.currentChunk.samples.map(jn),i=e.currentChunk.samples.map(z=>ge(z.presentationTimestamp-z.decodeTimestamp,e.timescale)),o=new Set(t),a=new Set(r),u=new Set(n),d=new Set(i),v=u.size===2&&n[0]!==n[1],S=o.size>1,y=a.size>1,V=!v&&u.size>1,se=d.size>1||[...d].some(z=>z!==0),M=0;return M|=1,M|=4*+v,M|=256*+S,M|=512*+y,M|=1024*+V,M|=2048*+se,j("trun",1,M,[g(e.currentChunk.samples.length),g(e.currentChunk.offset-e.currentChunk.moofOffset||0),v?g(n[0]):[],e.currentChunk.samples.map((z,P)=>[S?g(t[P]):[],y?g(r[P]):[],V?g(n[P]):[],se?Yi(i[P]):[]])])},Mo=e=>B("mfra",null,[...e.map(No),Ho()]),No=(e,t)=>j("tfra",1,0,[g(e.id),g(63),g(e.finalizedChunks.length),e.finalizedChunks.map(n=>[Me(ge(n.startTimestamp,e.timescale)),Me(n.moofOffset),g(t+1),g(1),g(1)])]),Ho=()=>j("mfro",0,0,[g(0)]),$o={avc:"avc1",hevc:"hvc1",vp9:"vp09",av1:"av01"},Wo={avc:bo,hevc:_o,vp9:So,av1:Co},qo={aac:"mp4a",opus:"Opus"},Vo={aac:Eo,opus:Uo},ar=class{},zn=class extends ar{constructor(){super(...arguments),this.buffer=null}},Ln=class extends ar{constructor(e){if(super(),this.options=e,typeof e!="object")throw new TypeError("StreamTarget requires an options object to be passed to its constructor.");if(e.onData){if(typeof e.onData!="function")throw new TypeError("options.onData, when provided, must be a function.");if(e.onData.length<2)throw new TypeError("options.onData, when provided, must be a function that takes in at least two arguments (data and position). Ignoring the position argument, which specifies the byte offset at which the data is to be written, can lead to broken outputs.")}if(e.chunked!==void 0&&typeof e.chunked!="boolean")throw new TypeError("options.chunked, when provided, must be a boolean.");if(e.chunkSize!==void 0&&(!Number.isInteger(e.chunkSize)||e.chunkSize<1024))throw new TypeError("options.chunkSize, when provided, must be an integer and not smaller than 1024.")}},Go=class extends ar{constructor(e,t){if(super(),this.stream=e,this.options=t,!(e instanceof FileSystemWritableFileStream))throw new TypeError("FileSystemWritableFileStreamTarget requires a FileSystemWritableFileStream instance.");if(t!==void 0&&typeof t!="object")throw new TypeError("FileSystemWritableFileStreamTarget's options, when provided, must be an object.");if(t&&t.chunkSize!==void 0&&(!Number.isInteger(t.chunkSize)||t.chunkSize<=0))throw new TypeError("options.chunkSize, when provided, must be a positive integer")}},Fe,Xe,Bn=class{constructor(){this.pos=0,U(this,Fe,new Uint8Array(8)),U(this,Xe,new DataView(s(this,Fe).buffer)),this.offsets=new WeakMap}seek(e){this.pos=e}writeU32(e){s(this,Xe).setUint32(0,e,!1),this.write(s(this,Fe).subarray(0,4))}writeU64(e){s(this,Xe).setUint32(0,Math.floor(e/2**32),!1),s(this,Xe).setUint32(4,e,!1),this.write(s(this,Fe).subarray(0,8))}writeAscii(e){for(let t=0;t<e.length;t++)s(this,Xe).setUint8(t%8,e.charCodeAt(t)),t%8===7&&this.write(s(this,Fe));e.length%8!==0&&this.write(s(this,Fe).subarray(0,e.length%8))}writeBox(e){if(this.offsets.set(e,this.pos),e.contents&&!e.children)this.writeBoxHeader(e,e.size??e.contents.byteLength+8),this.write(e.contents);else{let t=this.pos;if(this.writeBoxHeader(e,0),e.contents&&this.write(e.contents),e.children)for(let i of e.children)i&&this.writeBox(i);let r=this.pos,n=e.size??r-t;this.seek(t),this.writeBoxHeader(e,n),this.seek(r)}}writeBoxHeader(e,t){this.writeU32(e.largeSize?1:t),this.writeAscii(e.type),e.largeSize&&this.writeU64(t)}measureBoxHeader(e){return 8+(e.largeSize?8:0)}patchBox(e){let t=this.pos;this.seek(this.offsets.get(e)),this.writeBox(e),this.seek(t)}measureBox(e){if(e.contents&&!e.children)return this.measureBoxHeader(e)+e.contents.byteLength;{let t=this.measureBoxHeader(e);if(e.contents&&(t+=e.contents.byteLength),e.children)for(let r of e.children)r&&(t+=this.measureBox(r));return t}}};Fe=new WeakMap;Xe=new WeakMap;var Wt,Be,bt,ct,qt,vr,Ko=class extends Bn{constructor(e){super(),U(this,qt),U(this,Wt,void 0),U(this,Be,new ArrayBuffer(2**16)),U(this,bt,new Uint8Array(s(this,Be))),U(this,ct,0),q(this,Wt,e)}write(e){x(this,qt,vr).call(this,this.pos+e.byteLength),s(this,bt).set(e,this.pos),this.pos+=e.byteLength,q(this,ct,Math.max(s(this,ct),this.pos))}finalize(){x(this,qt,vr).call(this,this.pos),s(this,Wt).buffer=s(this,Be).slice(0,Math.max(s(this,ct),this.pos))}};Wt=new WeakMap;Be=new WeakMap;bt=new WeakMap;ct=new WeakMap;qt=new WeakSet;vr=function(e){let t=s(this,Be).byteLength;for(;t<e;)t*=2;if(t===s(this,Be).byteLength)return;let r=new ArrayBuffer(t),n=new Uint8Array(r);n.set(s(this,bt),0),q(this,Be,r),q(this,bt,n)};var Xo=2**24,Jo=2,vt,je,ht,ke,ae,Zt,yr,Lr,Mn,Br,Nn,yt,Qt,Mr=class extends Bn{constructor(e){var t,r;super(),U(this,Zt),U(this,Lr),U(this,Br),U(this,yt),U(this,vt,void 0),U(this,je,[]),U(this,ht,void 0),U(this,ke,void 0),U(this,ae,[]),q(this,vt,e),q(this,ht,((t=e.options)==null?void 0:t.chunked)??!1),q(this,ke,((r=e.options)==null?void 0:r.chunkSize)??Xo)}write(e){s(this,je).push({data:e.slice(),start:this.pos}),this.pos+=e.byteLength}flush(){var r,n;if(s(this,je).length===0)return;let e=[],t=[...s(this,je)].sort((i,o)=>i.start-o.start);e.push({start:t[0].start,size:t[0].data.byteLength});for(let i=1;i<t.length;i++){let o=e[e.length-1],a=t[i];a.start<=o.start+o.size?o.size=Math.max(o.size,a.start+a.data.byteLength-o.start):e.push({start:a.start,size:a.data.byteLength})}for(let i of e){i.data=new Uint8Array(i.size);for(let o of s(this,je))i.start<=o.start&&o.start<i.start+i.size&&i.data.set(o.data,o.start-i.start);s(this,ht)?(x(this,Zt,yr).call(this,i.data,i.start),x(this,yt,Qt).call(this)):(n=(r=s(this,vt).options).onData)==null||n.call(r,i.data,i.start)}s(this,je).length=0}finalize(){s(this,ht)&&x(this,yt,Qt).call(this,!0)}};vt=new WeakMap;je=new WeakMap;ht=new WeakMap;ke=new WeakMap;ae=new WeakMap;Zt=new WeakSet;yr=function(e,t){let r=s(this,ae).findIndex(u=>u.start<=t&&t<u.start+s(this,ke));r===-1&&(r=x(this,Br,Nn).call(this,t));let n=s(this,ae)[r],i=t-n.start,o=e.subarray(0,Math.min(s(this,ke)-i,e.byteLength));n.data.set(o,i);let a={start:i,end:i+o.byteLength};if(x(this,Lr,Mn).call(this,n,a),n.written[0].start===0&&n.written[0].end===s(this,ke)&&(n.shouldFlush=!0),s(this,ae).length>Jo){for(let u=0;u<s(this,ae).length-1;u++)s(this,ae)[u].shouldFlush=!0;x(this,yt,Qt).call(this)}o.byteLength<e.byteLength&&x(this,Zt,yr).call(this,e.subarray(o.byteLength),t+o.byteLength)};Lr=new WeakSet;Mn=function(e,t){let r=0,n=e.written.length-1,i=-1;for(;r<=n;){let o=Math.floor(r+(n-r+1)/2);e.written[o].start<=t.start?(r=o+1,i=o):n=o-1}for(e.written.splice(i+1,0,t),(i===-1||e.written[i].end<t.start)&&i++;i<e.written.length-1&&e.written[i].end>=e.written[i+1].start;)e.written[i].end=Math.max(e.written[i].end,e.written[i+1].end),e.written.splice(i+1,1)};Br=new WeakSet;Nn=function(e){let r={start:Math.floor(e/s(this,ke))*s(this,ke),data:new Uint8Array(s(this,ke)),written:[],shouldFlush:!1};return s(this,ae).push(r),s(this,ae).sort((n,i)=>n.start-i.start),s(this,ae).indexOf(r)};yt=new WeakSet;Qt=function(e=!1){var t,r;for(let n=0;n<s(this,ae).length;n++){let i=s(this,ae)[n];if(!(!i.shouldFlush&&!e)){for(let o of i.written)(r=(t=s(this,vt).options).onData)==null||r.call(t,i.data.subarray(o.start,o.end),i.start+o.start);s(this,ae).splice(n--,1)}}};var Yo=class extends Mr{constructor(e){var t;super(new Ln({onData:(r,n)=>e.stream.write({type:"write",data:r,position:n}),chunked:!0,chunkSize:(t=e.options)==null?void 0:t.chunkSize}))}},gr=1e3,Zo=["avc","hevc","vp9","av1"],Qo=["aac","opus"],ea=2082844800,ta=["strict","offset","cross-track-offset"],_,C,er,ne,G,W,Ye,Qe,Nr,ze,Le,gt,wr,Hn,br,$n,Hr,Wn,_r,qn,$r,Vn,Vt,Sr,ve,xe,Wr,Gn,wt,tr,rr,qr,rt,Lt,Gt,Cr,ra=class{constructor(e){if(U(this,wr),U(this,br),U(this,Hr),U(this,_r),U(this,$r),U(this,Vt),U(this,ve),U(this,Wr),U(this,wt),U(this,rr),U(this,rt),U(this,Gt),U(this,_,void 0),U(this,C,void 0),U(this,er,void 0),U(this,ne,void 0),U(this,G,null),U(this,W,null),U(this,Ye,Math.floor(Date.now()/1e3)+ea),U(this,Qe,[]),U(this,Nr,1),U(this,ze,[]),U(this,Le,[]),U(this,gt,!1),x(this,wr,Hn).call(this,e),e.video=mt(e.video),e.audio=mt(e.audio),e.fastStart=mt(e.fastStart),this.target=e.target,q(this,_,{firstTimestampBehavior:"strict",...e}),e.target instanceof zn)q(this,C,new Ko(e.target));else if(e.target instanceof Ln)q(this,C,new Mr(e.target));else if(e.target instanceof Go)q(this,C,new Yo(e.target));else throw new Error(`Invalid target: ${e.target}`);x(this,_r,qn).call(this),x(this,br,$n).call(this)}addVideoChunk(e,t,r,n){if(!(e instanceof EncodedVideoChunk))throw new TypeError("addVideoChunk's first argument (sample) must be of type EncodedVideoChunk.");if(t&&typeof t!="object")throw new TypeError("addVideoChunk's second argument (meta), when provided, must be an object.");if(r!==void 0&&(!Number.isFinite(r)||r<0))throw new TypeError("addVideoChunk's third argument (timestamp), when provided, must be a non-negative real number.");if(n!==void 0&&!Number.isFinite(n))throw new TypeError("addVideoChunk's fourth argument (compositionTimeOffset), when provided, must be a real number.");let i=new Uint8Array(e.byteLength);e.copyTo(i),this.addVideoChunkRaw(i,e.type,r??e.timestamp,e.duration,t,n)}addVideoChunkRaw(e,t,r,n,i,o){if(!(e instanceof Uint8Array))throw new TypeError("addVideoChunkRaw's first argument (data) must be an instance of Uint8Array.");if(t!=="key"&&t!=="delta")throw new TypeError("addVideoChunkRaw's second argument (type) must be either 'key' or 'delta'.");if(!Number.isFinite(r)||r<0)throw new TypeError("addVideoChunkRaw's third argument (timestamp) must be a non-negative real number.");if(!Number.isFinite(n)||n<0)throw new TypeError("addVideoChunkRaw's fourth argument (duration) must be a non-negative real number.");if(i&&typeof i!="object")throw new TypeError("addVideoChunkRaw's fifth argument (meta), when provided, must be an object.");if(o!==void 0&&!Number.isFinite(o))throw new TypeError("addVideoChunkRaw's sixth argument (compositionTimeOffset), when provided, must be a real number.");if(x(this,Gt,Cr).call(this),!s(this,_).video)throw new Error("No video track declared.");if(typeof s(this,_).fastStart=="object"&&s(this,G).samples.length===s(this,_).fastStart.expectedVideoChunks)throw new Error(`Cannot add more video chunks than specified in 'fastStart' (${s(this,_).fastStart.expectedVideoChunks}).`);let a=x(this,Vt,Sr).call(this,s(this,G),e,t,r,n,i,o);if(s(this,_).fastStart==="fragmented"&&s(this,W)){for(;s(this,Le).length>0&&s(this,Le)[0].decodeTimestamp<=a.decodeTimestamp;){let u=s(this,Le).shift();x(this,ve,xe).call(this,s(this,W),u)}a.decodeTimestamp<=s(this,W).lastDecodeTimestamp?x(this,ve,xe).call(this,s(this,G),a):s(this,ze).push(a)}else x(this,ve,xe).call(this,s(this,G),a)}addAudioChunk(e,t,r){if(!(e instanceof EncodedAudioChunk))throw new TypeError("addAudioChunk's first argument (sample) must be of type EncodedAudioChunk.");if(t&&typeof t!="object")throw new TypeError("addAudioChunk's second argument (meta), when provided, must be an object.");if(r!==void 0&&(!Number.isFinite(r)||r<0))throw new TypeError("addAudioChunk's third argument (timestamp), when provided, must be a non-negative real number.");let n=new Uint8Array(e.byteLength);e.copyTo(n),this.addAudioChunkRaw(n,e.type,r??e.timestamp,e.duration,t)}addAudioChunkRaw(e,t,r,n,i){if(!(e instanceof Uint8Array))throw new TypeError("addAudioChunkRaw's first argument (data) must be an instance of Uint8Array.");if(t!=="key"&&t!=="delta")throw new TypeError("addAudioChunkRaw's second argument (type) must be either 'key' or 'delta'.");if(!Number.isFinite(r)||r<0)throw new TypeError("addAudioChunkRaw's third argument (timestamp) must be a non-negative real number.");if(!Number.isFinite(n)||n<0)throw new TypeError("addAudioChunkRaw's fourth argument (duration) must be a non-negative real number.");if(i&&typeof i!="object")throw new TypeError("addAudioChunkRaw's fifth argument (meta), when provided, must be an object.");if(x(this,Gt,Cr).call(this),!s(this,_).audio)throw new Error("No audio track declared.");if(typeof s(this,_).fastStart=="object"&&s(this,W).samples.length===s(this,_).fastStart.expectedAudioChunks)throw new Error(`Cannot add more audio chunks than specified in 'fastStart' (${s(this,_).fastStart.expectedAudioChunks}).`);let o=x(this,Vt,Sr).call(this,s(this,W),e,t,r,n,i);if(s(this,_).fastStart==="fragmented"&&s(this,G)){for(;s(this,ze).length>0&&s(this,ze)[0].decodeTimestamp<=o.decodeTimestamp;){let a=s(this,ze).shift();x(this,ve,xe).call(this,s(this,G),a)}o.decodeTimestamp<=s(this,G).lastDecodeTimestamp?x(this,ve,xe).call(this,s(this,W),o):s(this,Le).push(o)}else x(this,ve,xe).call(this,s(this,W),o)}finalize(){if(s(this,gt))throw new Error("Cannot finalize a muxer more than once.");if(s(this,_).fastStart==="fragmented"){for(let t of s(this,ze))x(this,ve,xe).call(this,s(this,G),t);for(let t of s(this,Le))x(this,ve,xe).call(this,s(this,W),t);x(this,rr,qr).call(this,!1)}else s(this,G)&&x(this,wt,tr).call(this,s(this,G)),s(this,W)&&x(this,wt,tr).call(this,s(this,W));let e=[s(this,G),s(this,W)].filter(Boolean);if(s(this,_).fastStart==="in-memory"){let t;for(let n=0;n<2;n++){let i=$t(e,s(this,Ye)),o=s(this,C).measureBox(i);t=s(this,C).measureBox(s(this,ne));let a=s(this,C).pos+o+t;for(let u of s(this,Qe)){u.offset=a;for(let{data:d}of u.samples)a+=d.byteLength,t+=d.byteLength}if(a<2**32)break;t>=2**32&&(s(this,ne).largeSize=!0)}let r=$t(e,s(this,Ye));s(this,C).writeBox(r),s(this,ne).size=t,s(this,C).writeBox(s(this,ne));for(let n of s(this,Qe))for(let i of n.samples)s(this,C).write(i.data),i.data=null}else if(s(this,_).fastStart==="fragmented"){let t=s(this,C).pos,r=Mo(e);s(this,C).writeBox(r);let n=s(this,C).pos-t;s(this,C).seek(s(this,C).pos-4),s(this,C).writeU32(n)}else{let t=s(this,C).offsets.get(s(this,ne)),r=s(this,C).pos-t;s(this,ne).size=r,s(this,ne).largeSize=r>=2**32,s(this,C).patchBox(s(this,ne));let n=$t(e,s(this,Ye));if(typeof s(this,_).fastStart=="object"){s(this,C).seek(s(this,er)),s(this,C).writeBox(n);let i=t-s(this,C).pos;s(this,C).writeBox(Qi(i))}else s(this,C).writeBox(n)}x(this,rt,Lt).call(this),s(this,C).finalize(),q(this,gt,!0)}};_=new WeakMap;C=new WeakMap;er=new WeakMap;ne=new WeakMap;G=new WeakMap;W=new WeakMap;Ye=new WeakMap;Qe=new WeakMap;Nr=new WeakMap;ze=new WeakMap;Le=new WeakMap;gt=new WeakMap;wr=new WeakSet;Hn=function(e){if(typeof e!="object")throw new TypeError("The muxer requires an options object to be passed to its constructor.");if(!(e.target instanceof ar))throw new TypeError("The target must be provided and an instance of Target.");if(e.video){if(!Zo.includes(e.video.codec))throw new TypeError(`Unsupported video codec: ${e.video.codec}`);if(!Number.isInteger(e.video.width)||e.video.width<=0)throw new TypeError(`Invalid video width: ${e.video.width}. Must be a positive integer.`);if(!Number.isInteger(e.video.height)||e.video.height<=0)throw new TypeError(`Invalid video height: ${e.video.height}. Must be a positive integer.`);const t=e.video.rotation;if(typeof t=="number"&&![0,90,180,270].includes(t))throw new TypeError(`Invalid video rotation: ${t}. Has to be 0, 90, 180 or 270.`);if(Array.isArray(t)&&(t.length!==9||t.some(r=>typeof r!="number")))throw new TypeError(`Invalid video transformation matrix: ${t.join()}`);if(e.video.frameRate!==void 0&&(!Number.isInteger(e.video.frameRate)||e.video.frameRate<=0))throw new TypeError(`Invalid video frame rate: ${e.video.frameRate}. Must be a positive integer.`)}if(e.audio){if(!Qo.includes(e.audio.codec))throw new TypeError(`Unsupported audio codec: ${e.audio.codec}`);if(!Number.isInteger(e.audio.numberOfChannels)||e.audio.numberOfChannels<=0)throw new TypeError(`Invalid number of audio channels: ${e.audio.numberOfChannels}. Must be a positive integer.`);if(!Number.isInteger(e.audio.sampleRate)||e.audio.sampleRate<=0)throw new TypeError(`Invalid audio sample rate: ${e.audio.sampleRate}. Must be a positive integer.`)}if(e.firstTimestampBehavior&&!ta.includes(e.firstTimestampBehavior))throw new TypeError(`Invalid first timestamp behavior: ${e.firstTimestampBehavior}`);if(typeof e.fastStart=="object"){if(e.video){if(e.fastStart.expectedVideoChunks===void 0)throw new TypeError("'fastStart' is an object but is missing property 'expectedVideoChunks'.");if(!Number.isInteger(e.fastStart.expectedVideoChunks)||e.fastStart.expectedVideoChunks<0)throw new TypeError("'expectedVideoChunks' must be a non-negative integer.")}if(e.audio){if(e.fastStart.expectedAudioChunks===void 0)throw new TypeError("'fastStart' is an object but is missing property 'expectedAudioChunks'.");if(!Number.isInteger(e.fastStart.expectedAudioChunks)||e.fastStart.expectedAudioChunks<0)throw new TypeError("'expectedAudioChunks' must be a non-negative integer.")}}else if(![!1,"in-memory","fragmented"].includes(e.fastStart))throw new TypeError("'fastStart' option must be false, 'in-memory', 'fragmented' or an object.");if(e.minFragmentDuration!==void 0&&(!Number.isFinite(e.minFragmentDuration)||e.minFragmentDuration<0))throw new TypeError("'minFragmentDuration' must be a non-negative number.")};br=new WeakSet;$n=function(){var e;if(s(this,C).writeBox(Zi({holdsAvc:((e=s(this,_).video)==null?void 0:e.codec)==="avc",fragmented:s(this,_).fastStart==="fragmented"})),q(this,er,s(this,C).pos),s(this,_).fastStart==="in-memory")q(this,ne,mr(!1));else if(s(this,_).fastStart!=="fragmented"){if(typeof s(this,_).fastStart=="object"){let t=x(this,Hr,Wn).call(this);s(this,C).seek(s(this,C).pos+t)}q(this,ne,mr(!0)),s(this,C).writeBox(s(this,ne))}x(this,rt,Lt).call(this)};Hr=new WeakSet;Wn=function(){if(typeof s(this,_).fastStart!="object")return;let e=0,t=[s(this,_).fastStart.expectedVideoChunks,s(this,_).fastStart.expectedAudioChunks];for(let r of t)r&&(e+=8*Math.ceil(2/3*r),e+=4*r,e+=12*Math.ceil(2/3*r),e+=4*r,e+=8*r);return e+=4096,e};_r=new WeakSet;qn=function(){if(s(this,_).video&&q(this,G,{id:1,info:{type:"video",codec:s(this,_).video.codec,width:s(this,_).video.width,height:s(this,_).video.height,rotation:s(this,_).video.rotation??0,decoderConfig:null},timescale:s(this,_).video.frameRate??57600,samples:[],finalizedChunks:[],currentChunk:null,firstDecodeTimestamp:void 0,lastDecodeTimestamp:-1,timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,compactlyCodedChunkTable:[]}),s(this,_).audio&&(q(this,W,{id:s(this,_).video?2:1,info:{type:"audio",codec:s(this,_).audio.codec,numberOfChannels:s(this,_).audio.numberOfChannels,sampleRate:s(this,_).audio.sampleRate,decoderConfig:null},timescale:s(this,_).audio.sampleRate,samples:[],finalizedChunks:[],currentChunk:null,firstDecodeTimestamp:void 0,lastDecodeTimestamp:-1,timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,compactlyCodedChunkTable:[]}),s(this,_).audio.codec==="aac")){let e=x(this,$r,Vn).call(this,2,s(this,_).audio.sampleRate,s(this,_).audio.numberOfChannels);s(this,W).info.decoderConfig={codec:s(this,_).audio.codec,description:e,numberOfChannels:s(this,_).audio.numberOfChannels,sampleRate:s(this,_).audio.sampleRate}}};$r=new WeakSet;Vn=function(e,t,r){let i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350].indexOf(t),o=r,a="";a+=e.toString(2).padStart(5,"0"),a+=i.toString(2).padStart(4,"0"),i===15&&(a+=t.toString(2).padStart(24,"0")),a+=o.toString(2).padStart(4,"0");let u=Math.ceil(a.length/8)*8;a=a.padEnd(u,"0");let d=new Uint8Array(a.length/8);for(let v=0;v<a.length;v+=8)d[v/8]=parseInt(a.slice(v,v+8),2);return d};Vt=new WeakSet;Sr=function(e,t,r,n,i,o,a){let u=n/1e6,d=(n-(a??0))/1e6,v=i/1e6,S=x(this,Wr,Gn).call(this,u,d,e);return u=S.presentationTimestamp,d=S.decodeTimestamp,o!=null&&o.decoderConfig&&(e.info.decoderConfig===null?e.info.decoderConfig=o.decoderConfig:Object.assign(e.info.decoderConfig,o.decoderConfig)),{presentationTimestamp:u,decodeTimestamp:d,duration:v,data:t,size:t.byteLength,type:r,timescaleUnitsToNextSample:ge(v,e.timescale)}};ve=new WeakSet;xe=function(e,t){s(this,_).fastStart!=="fragmented"&&e.samples.push(t);const r=ge(t.presentationTimestamp-t.decodeTimestamp,e.timescale);if(e.lastTimescaleUnits!==null){let i=ge(t.decodeTimestamp,e.timescale,!1),o=Math.round(i-e.lastTimescaleUnits);if(e.lastTimescaleUnits+=o,e.lastSample.timescaleUnitsToNextSample=o,s(this,_).fastStart!=="fragmented"){let a=Yt(e.timeToSampleTable);a.sampleCount===1?(a.sampleDelta=o,a.sampleCount++):a.sampleDelta===o?a.sampleCount++:(a.sampleCount--,e.timeToSampleTable.push({sampleCount:2,sampleDelta:o}));const u=Yt(e.compositionTimeOffsetTable);u.sampleCompositionTimeOffset===r?u.sampleCount++:e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:r})}}else e.lastTimescaleUnits=0,s(this,_).fastStart!=="fragmented"&&(e.timeToSampleTable.push({sampleCount:1,sampleDelta:ge(t.duration,e.timescale)}),e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:r}));e.lastSample=t;let n=!1;if(!e.currentChunk)n=!0;else{let i=t.presentationTimestamp-e.currentChunk.startTimestamp;if(s(this,_).fastStart==="fragmented"){let o=s(this,G)??s(this,W);const a=s(this,_).minFragmentDuration??1;e===o&&t.type==="key"&&i>=a&&(n=!0,x(this,rr,qr).call(this))}else n=i>=.5}n&&(e.currentChunk&&x(this,wt,tr).call(this,e),e.currentChunk={startTimestamp:t.presentationTimestamp,samples:[]}),e.currentChunk.samples.push(t)};Wr=new WeakSet;Gn=function(e,t,r){var a,u;const n=s(this,_).firstTimestampBehavior==="strict",i=r.lastDecodeTimestamp===-1;if(n&&i&&t!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received DTS=${t}).Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of thedocument, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
`);if(s(this,_).firstTimestampBehavior==="offset"||s(this,_).firstTimestampBehavior==="cross-track-offset"){r.firstDecodeTimestamp===void 0&&(r.firstDecodeTimestamp=t);let d;s(this,_).firstTimestampBehavior==="offset"?d=r.firstDecodeTimestamp:d=Math.min(((a=s(this,G))==null?void 0:a.firstDecodeTimestamp)??1/0,((u=s(this,W))==null?void 0:u.firstDecodeTimestamp)??1/0),t-=d,e-=d}if(t<r.lastDecodeTimestamp)throw new Error(`Timestamps must be monotonically increasing (DTS went from ${r.lastDecodeTimestamp*1e6} to ${t*1e6}).`);return r.lastDecodeTimestamp=t,{presentationTimestamp:e,decodeTimestamp:t}};wt=new WeakSet;tr=function(e){if(s(this,_).fastStart==="fragmented")throw new Error("Can't finalize individual chunks if 'fastStart' is set to 'fragmented'.");if(e.currentChunk){if(e.finalizedChunks.push(e.currentChunk),s(this,Qe).push(e.currentChunk),(e.compactlyCodedChunkTable.length===0||Yt(e.compactlyCodedChunkTable).samplesPerChunk!==e.currentChunk.samples.length)&&e.compactlyCodedChunkTable.push({firstChunk:e.finalizedChunks.length,samplesPerChunk:e.currentChunk.samples.length}),s(this,_).fastStart==="in-memory"){e.currentChunk.offset=0;return}e.currentChunk.offset=s(this,C).pos;for(let t of e.currentChunk.samples)s(this,C).write(t.data),t.data=null;x(this,rt,Lt).call(this)}};rr=new WeakSet;qr=function(e=!0){if(s(this,_).fastStart!=="fragmented")throw new Error("Can't finalize a fragment unless 'fastStart' is set to 'fragmented'.");let t=[s(this,G),s(this,W)].filter(u=>u&&u.currentChunk);if(t.length===0)return;let r=Xi(this,Nr)._++;if(r===1){let u=$t(t,s(this,Ye),!0);s(this,C).writeBox(u)}let n=s(this,C).pos,i=an(r,t);s(this,C).writeBox(i);{let u=mr(!1),d=0;for(let S of t)for(let y of S.currentChunk.samples)d+=y.size;let v=s(this,C).measureBox(u)+d;v>=2**32&&(u.largeSize=!0,v=s(this,C).measureBox(u)+d),u.size=v,s(this,C).writeBox(u)}for(let u of t){u.currentChunk.offset=s(this,C).pos,u.currentChunk.moofOffset=n;for(let d of u.currentChunk.samples)s(this,C).write(d.data),d.data=null}let o=s(this,C).pos;s(this,C).seek(s(this,C).offsets.get(i));let a=an(r,t);s(this,C).writeBox(a),s(this,C).seek(o);for(let u of t)u.finalizedChunks.push(u.currentChunk),s(this,Qe).push(u.currentChunk),u.currentChunk=null;e&&x(this,rt,Lt).call(this)};rt=new WeakSet;Lt=function(){s(this,C)instanceof Mr&&s(this,C).flush()};Gt=new WeakSet;Cr=function(){if(s(this,gt))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};const na={width:1280,height:720,bitrate:4e6,framerate:60,keyFrameInterval:60};class Vr{constructor(t={}){O(this,"config");O(this,"encoder",null);O(this,"muxer",null);O(this,"frameCount",0);O(this,"startTime",0);O(this,"isEncoding",!1);this.config={...na,...t}}static isSupported(){return"VideoEncoder"in window&&"VideoFrame"in window}async initialize(){if(!Vr.isSupported())throw new F("UNSUPPORTED_BROWSER","WebCodecs not supported");this.muxer=new ra({target:new zn,video:{codec:"avc",width:this.config.width,height:this.config.height},fastStart:"in-memory"}),this.encoder=new VideoEncoder({output:(t,r)=>{this.muxer&&r&&this.muxer.addVideoChunk(t,r)},error:t=>{throw console.error("Encoder error:",t),new F("ENCODING_FAILED",t.message)}}),this.encoder.configure({codec:"avc1.42E01F",width:this.config.width,height:this.config.height,bitrate:this.config.bitrate,framerate:this.config.framerate,hardwareAcceleration:"prefer-hardware",avc:{format:"avc"}}),this.frameCount=0,this.isEncoding=!0}encodeFrame(t){if(!this.encoder||!this.isEncoding)return;this.frameCount===0&&(this.startTime=performance.now());const r=this.frameCount%this.config.keyFrameInterval===0;this.encoder.encode(t,{keyFrame:r}),this.frameCount++,t.close()}async finalize(){if(!this.encoder||!this.muxer)throw new F("ENCODING_FAILED","Encoder not initialized");this.isEncoding=!1,await this.encoder.flush(),this.muxer.finalize();const r=this.muxer.target.buffer;return this.encoder.close(),this.encoder=null,this.muxer=null,new Uint8Array(r)}getStats(){const t=performance.now()-this.startTime,r=this.frameCount/(t/1e3);return{frameCount:this.frameCount,elapsedMs:t,actualFps:r}}abort(){this.encoder&&(this.encoder.close(),this.encoder=null),this.muxer=null,this.isEncoding=!1}}const ia={mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:4e6};class nr{constructor(t={}){O(this,"recorder",null);O(this,"chunks",[]);O(this,"config");O(this,"startTime",0);this.config={...ia,...t}}static isSupported(){return"MediaRecorder"in window}static getBestMimeType(){const t=["video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm","video/mp4"];for(const r of t)if(MediaRecorder.isTypeSupported(r))return r;return"video/webm"}initialize(t){if(!nr.isSupported())throw new F("UNSUPPORTED_BROWSER","MediaRecorder not supported");const r=nr.getBestMimeType();this.recorder=new MediaRecorder(t,{mimeType:r,videoBitsPerSecond:this.config.videoBitsPerSecond}),this.chunks=[],this.recorder.ondataavailable=n=>{n.data.size>0&&this.chunks.push(n.data)},this.recorder.onerror=n=>{throw console.error("MediaRecorder error:",n),new F("CAPTURE_FAILED","Recording failed")}}start(){if(!this.recorder)throw new F("CAPTURE_FAILED","Recorder not initialized");this.startTime=performance.now(),this.chunks=[],this.recorder.start(100)}async stop(){return new Promise((t,r)=>{if(!this.recorder){r(new F("CAPTURE_FAILED","Recorder not initialized"));return}this.recorder.onstop=async()=>{var n;try{const o=await new Blob(this.chunks,{type:(n=this.recorder)==null?void 0:n.mimeType}).arrayBuffer();t(new Uint8Array(o))}catch{r(new F("ENCODING_FAILED","Failed to process recording"))}},this.recorder.stop()})}getElapsedMs(){return performance.now()-this.startTime}abort(){this.recorder&&this.recorder.state!=="inactive"&&this.recorder.stop(),this.recorder=null,this.chunks=[]}}function Gr(e){return new Promise((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)})}function oa(e,t){let r;const n=()=>{if(r)return r;const i=indexedDB.open(e);return i.onupgradeneeded=()=>i.result.createObjectStore(t),r=Gr(i),r.then(o=>{o.onclose=()=>r=void 0},()=>{}),r};return(i,o)=>n().then(a=>o(a.transaction(t,i).objectStore(t)))}let hr;function Kn(){return hr||(hr=oa("keyval-store","keyval")),hr}function aa(e,t=Kn()){return t("readonly",r=>Gr(r.get(e)))}function sa(e,t,r=Kn()){return r("readwrite",n=>(n.put(t,e),Gr(n.transaction)))}const Xn="xlens_device_key_";async function la(){try{const e=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!1,["sign","verify"]),t=await crypto.subtle.exportKey("spki",e.publicKey),r=ha(t);return{keyId:await ca(t),publicKey:r,privateKey:e.privateKey,createdAt:Date.now()}}catch(e){const t=e instanceof Error?e.message:"Key generation failed";throw new F("KEY_GENERATION_FAILED",t)}}async function ua(e,t){const r=Xn+e,n={keyId:t.keyId,publicKey:t.publicKey,createdAt:t.createdAt};await sa(r+"_meta",n),Jn.set(e,t)}async function fa(e){const t=Jn.get(e);if(t)return t;const r=Xn+e;return await aa(r+"_meta"),null}async function sn(e){let t=await fa(e);return t||(t=await la(),await ua(e,t)),t}const Jn=new Map;async function ca(e){const t=await crypto.subtle.digest("SHA-256",e),r=new Uint8Array(t);return Array.from(r.slice(0,8)).map(n=>n.toString(16).padStart(2,"0")).join("")}function ha(e){const t=new Uint8Array(e);let r="";for(let n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return btoa(r)}async function da(e,t){try{const r=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},e.privateKey,t.buffer);return ma(r)}catch(r){const n=r instanceof Error?r.message:"Signing failed";throw new F("SIGNING_FAILED",n)}}async function pa(e,t){const n=new TextEncoder().encode(t);return da(e,n)}async function Kr(e){const t=await crypto.subtle.digest("SHA-256",e.buffer);return va(t)}async function Tr(e){const r=new TextEncoder().encode(e);return Kr(r)}function ma(e){const t=new Uint8Array(e);let r="";for(let n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return btoa(r)}function va(e){const t=new Uint8Array(e);return Array.from(t).map(r=>r.toString(16).padStart(2,"0")).join("")}async function ya(e,t,r){const n=Vi(),i=await Kr(t.videoData),o=pr(t.sensorData),a=await Tr(o),u={sessionId:e.id,nonce:e.nonce,startedAtMs:t.startedAtMs,endedAtMs:t.endedAtMs,fps:t.fps,device:n},d=await Tr(JSON.stringify(u)),v=`${e.nonce}:${i}:${a}:${d}`,S=await pa(r,v);return{sessionId:e.id,nonce:e.nonce,capture:{testType:"VERT_JUMP",startedAtMs:t.startedAtMs,endedAtMs:t.endedAtMs,fps:t.fps,device:n},hashes:{videoSha256:i,sensorSha256:a,metadataSha256:d},signature:{alg:"ES256",keyId:r.keyId,sig:S},sensorsAvailable:t.sensorData.length>0}}function Er(e){"@babel/helpers - typeof";return Er=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Er(e)}function ga(e,t,r){return Object.defineProperty(e,"prototype",{writable:!1}),e}function wa(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ba(e,t,r){return t=St(t),_a(e,Xr()?Reflect.construct(t,r||[],St(e).constructor):t.apply(e,r))}function _a(e,t){if(t&&(Er(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Sa(e)}function Sa(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ca(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_t(e,t)}function Ur(e){var t=typeof Map=="function"?new Map:void 0;return Ur=function(n){if(n===null||!Ea(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(n))return t.get(n);t.set(n,i)}function i(){return Ta(n,arguments,St(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),_t(i,n)},Ur(e)}function Ta(e,t,r){if(Xr())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var i=new(e.bind.apply(e,n));return r&&_t(i,r.prototype),i}function Xr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Xr=function(){return!!e})()}function Ea(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch{return typeof e=="function"}}function _t(e,t){return _t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},_t(e,t)}function St(e){return St=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},St(e)}var Nt=function(e){function t(r){var n,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(wa(this,t),n=ba(this,t,[r]),n.originalRequest=o,n.originalResponse=a,n.causingError=i,i!=null&&(r+=", caused by ".concat(i.toString())),o!=null){var u=o.getHeader("X-Request-ID")||"n/a",d=o.getMethod(),v=o.getURL(),S=a?a.getStatus():"n/a",y=a?a.getBody()||"":"n/a";r+=", originated from request (method: ".concat(d,", url: ").concat(v,", response code: ").concat(S,", response text: ").concat(y,", request id: ").concat(u,")")}return n.message=r,n}return Ca(t,e),ga(t)}(Ur(Error));function Ct(e){"@babel/helpers - typeof";return Ct=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ct(e)}function Ua(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xa(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Pa(n.key),n)}}function ka(e,t,r){return t&&xa(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Pa(e){var t=Oa(e,"string");return Ct(t)=="symbol"?t:t+""}function Oa(e,t){if(Ct(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Ct(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Ra=function(){function e(){Ua(this,e)}return ka(e,[{key:"listAllUploads",value:function(){return Promise.resolve([])}},{key:"findUploadsByFingerprint",value:function(r){return Promise.resolve([])}},{key:"removeUpload",value:function(r){return Promise.resolve()}},{key:"addUpload",value:function(r,n){return Promise.resolve(null)}}])}();const Yn="3.7.8",Aa=Yn,it=typeof Buffer=="function",ln=typeof TextDecoder=="function"?new TextDecoder:void 0,un=typeof TextEncoder=="function"?new TextEncoder:void 0,Ia="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",dt=Array.prototype.slice.call(Ia),Ht=(e=>{let t={};return e.forEach((r,n)=>t[r]=n),t})(dt),Da=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,K=String.fromCharCode.bind(String),fn=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),Zn=e=>e.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_"),Qn=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),ei=e=>{let t,r,n,i,o="";const a=e.length%3;for(let u=0;u<e.length;){if((r=e.charCodeAt(u++))>255||(n=e.charCodeAt(u++))>255||(i=e.charCodeAt(u++))>255)throw new TypeError("invalid character found");t=r<<16|n<<8|i,o+=dt[t>>18&63]+dt[t>>12&63]+dt[t>>6&63]+dt[t&63]}return a?o.slice(0,a-3)+"===".substring(a):o},Jr=typeof btoa=="function"?e=>btoa(e):it?e=>Buffer.from(e,"binary").toString("base64"):ei,xr=it?e=>Buffer.from(e).toString("base64"):e=>{let r=[];for(let n=0,i=e.length;n<i;n+=4096)r.push(K.apply(null,e.subarray(n,n+4096)));return Jr(r.join(""))},Kt=(e,t=!1)=>t?Zn(xr(e)):xr(e),Fa=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?K(192|t>>>6)+K(128|t&63):K(224|t>>>12&15)+K(128|t>>>6&63)+K(128|t&63)}else{var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return K(240|t>>>18&7)+K(128|t>>>12&63)+K(128|t>>>6&63)+K(128|t&63)}},ja=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,ti=e=>e.replace(ja,Fa),cn=it?e=>Buffer.from(e,"utf8").toString("base64"):un?e=>xr(un.encode(e)):e=>Jr(ti(e)),et=(e,t=!1)=>t?Zn(cn(e)):cn(e),hn=e=>et(e,!0),za=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,La=e=>{switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),r=t-65536;return K((r>>>10)+55296)+K((r&1023)+56320);case 3:return K((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return K((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},ri=e=>e.replace(za,La),ni=e=>{if(e=e.replace(/\s+/g,""),!Da.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let t,r,n,i=[];for(let o=0;o<e.length;)t=Ht[e.charAt(o++)]<<18|Ht[e.charAt(o++)]<<12|(r=Ht[e.charAt(o++)])<<6|(n=Ht[e.charAt(o++)]),r===64?i.push(K(t>>16&255)):n===64?i.push(K(t>>16&255,t>>8&255)):i.push(K(t>>16&255,t>>8&255,t&255));return i.join("")},Yr=typeof atob=="function"?e=>atob(Qn(e)):it?e=>Buffer.from(e,"base64").toString("binary"):ni,ii=it?e=>fn(Buffer.from(e,"base64")):e=>fn(Yr(e).split("").map(t=>t.charCodeAt(0))),oi=e=>ii(ai(e)),Ba=it?e=>Buffer.from(e,"base64").toString("utf8"):ln?e=>ln.decode(ii(e)):e=>ri(Yr(e)),ai=e=>Qn(e.replace(/[-_]/g,t=>t=="-"?"+":"/")),kr=e=>Ba(ai(e)),Ma=e=>{if(typeof e!="string")return!1;const t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},si=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),li=function(){const e=(t,r)=>Object.defineProperty(String.prototype,t,si(r));e("fromBase64",function(){return kr(this)}),e("toBase64",function(t){return et(this,t)}),e("toBase64URI",function(){return et(this,!0)}),e("toBase64URL",function(){return et(this,!0)}),e("toUint8Array",function(){return oi(this)})},ui=function(){const e=(t,r)=>Object.defineProperty(Uint8Array.prototype,t,si(r));e("toBase64",function(t){return Kt(this,t)}),e("toBase64URI",function(){return Kt(this,!0)}),e("toBase64URL",function(){return Kt(this,!0)})},Na=()=>{li(),ui()},Ha={version:Yn,VERSION:Aa,atob:Yr,atobPolyfill:ni,btoa:Jr,btoaPolyfill:ei,fromBase64:kr,toBase64:et,encode:et,encodeURI:hn,encodeURL:hn,utob:ti,btou:ri,decode:kr,isValid:Ma,fromUint8Array:Kt,toUint8Array:oi,extendString:li,extendUint8Array:ui,extendBuiltins:Na};var dn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $a(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Wa=function(t,r){if(r=r.split(":")[0],t=+t,!t)return!1;switch(r){case"http":case"ws":return t!==80;case"https":case"wss":return t!==443;case"ftp":return t!==21;case"gopher":return t!==70;case"file":return!1}return t!==0},Zr={},qa=Object.prototype.hasOwnProperty,Va;function pn(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch{return null}}function mn(e){try{return encodeURIComponent(e)}catch{return null}}function Ga(e){for(var t=/([^=?#&]+)=?([^&]*)/g,r={},n;n=t.exec(e);){var i=pn(n[1]),o=pn(n[2]);i===null||o===null||i in r||(r[i]=o)}return r}function Ka(e,t){t=t||"";var r=[],n,i;typeof t!="string"&&(t="?");for(i in e)if(qa.call(e,i)){if(n=e[i],!n&&(n===null||n===Va||isNaN(n))&&(n=""),i=mn(i),n=mn(n),i===null||n===null)continue;r.push(i+"="+n)}return r.length?t+r.join("&"):""}Zr.stringify=Ka;Zr.parse=Ga;var fi=Wa,sr=Zr,Xa=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,ci=/[\n\r\t]/g,Ja=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,hi=/:\d+$/,Ya=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,Za=/^[a-zA-Z]:/;function Qr(e){return(e||"").toString().replace(Xa,"")}var Pr=[["#","hash"],["?","query"],function(t,r){return we(r.protocol)?t.replace(/\\/g,"/"):t},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],vn={hash:1,query:1};function di(e){var t;typeof window<"u"?t=window:typeof dn<"u"?t=dn:typeof self<"u"?t=self:t={};var r=t.location||{};e=e||r;var n={},i=typeof e,o;if(e.protocol==="blob:")n=new _e(unescape(e.pathname),{});else if(i==="string"){n=new _e(e,{});for(o in vn)delete n[o]}else if(i==="object"){for(o in e)o in vn||(n[o]=e[o]);n.slashes===void 0&&(n.slashes=Ja.test(e.href))}return n}function we(e){return e==="file:"||e==="ftp:"||e==="http:"||e==="https:"||e==="ws:"||e==="wss:"}function pi(e,t){e=Qr(e),e=e.replace(ci,""),t=t||{};var r=Ya.exec(e),n=r[1]?r[1].toLowerCase():"",i=!!r[2],o=!!r[3],a=0,u;return i?o?(u=r[2]+r[3]+r[4],a=r[2].length+r[3].length):(u=r[2]+r[4],a=r[2].length):o?(u=r[3]+r[4],a=r[3].length):u=r[4],n==="file:"?a>=2&&(u=u.slice(2)):we(n)?u=r[4]:n?i&&(u=u.slice(2)):a>=2&&we(t.protocol)&&(u=r[4]),{protocol:n,slashes:i||we(n),slashesCount:a,rest:u}}function Qa(e,t){if(e==="")return t;for(var r=(t||"/").split("/").slice(0,-1).concat(e.split("/")),n=r.length,i=r[n-1],o=!1,a=0;n--;)r[n]==="."?r.splice(n,1):r[n]===".."?(r.splice(n,1),a++):a&&(n===0&&(o=!0),r.splice(n,1),a--);return o&&r.unshift(""),(i==="."||i==="..")&&r.push(""),r.join("/")}function _e(e,t,r){if(e=Qr(e),e=e.replace(ci,""),!(this instanceof _e))return new _e(e,t,r);var n,i,o,a,u,d,v=Pr.slice(),S=typeof t,y=this,V=0;for(S!=="object"&&S!=="string"&&(r=t,t=null),r&&typeof r!="function"&&(r=sr.parse),t=di(t),i=pi(e||"",t),n=!i.protocol&&!i.slashes,y.slashes=i.slashes||n&&t.slashes,y.protocol=i.protocol||t.protocol||"",e=i.rest,(i.protocol==="file:"&&(i.slashesCount!==2||Za.test(e))||!i.slashes&&(i.protocol||i.slashesCount<2||!we(y.protocol)))&&(v[3]=[/(.*)/,"pathname"]);V<v.length;V++){if(a=v[V],typeof a=="function"){e=a(e,y);continue}o=a[0],d=a[1],o!==o?y[d]=e:typeof o=="string"?(u=o==="@"?e.lastIndexOf(o):e.indexOf(o),~u&&(typeof a[2]=="number"?(y[d]=e.slice(0,u),e=e.slice(u+a[2])):(y[d]=e.slice(u),e=e.slice(0,u)))):(u=o.exec(e))&&(y[d]=u[1],e=e.slice(0,u.index)),y[d]=y[d]||n&&a[3]&&t[d]||"",a[4]&&(y[d]=y[d].toLowerCase())}r&&(y.query=r(y.query)),n&&t.slashes&&y.pathname.charAt(0)!=="/"&&(y.pathname!==""||t.pathname!=="")&&(y.pathname=Qa(y.pathname,t.pathname)),y.pathname.charAt(0)!=="/"&&we(y.protocol)&&(y.pathname="/"+y.pathname),fi(y.port,y.protocol)||(y.host=y.hostname,y.port=""),y.username=y.password="",y.auth&&(u=y.auth.indexOf(":"),~u?(y.username=y.auth.slice(0,u),y.username=encodeURIComponent(decodeURIComponent(y.username)),y.password=y.auth.slice(u+1),y.password=encodeURIComponent(decodeURIComponent(y.password))):y.username=encodeURIComponent(decodeURIComponent(y.auth)),y.auth=y.password?y.username+":"+y.password:y.username),y.origin=y.protocol!=="file:"&&we(y.protocol)&&y.host?y.protocol+"//"+y.host:"null",y.href=y.toString()}function es(e,t,r){var n=this;switch(e){case"query":typeof t=="string"&&t.length&&(t=(r||sr.parse)(t)),n[e]=t;break;case"port":n[e]=t,fi(t,n.protocol)?t&&(n.host=n.hostname+":"+t):(n.host=n.hostname,n[e]="");break;case"hostname":n[e]=t,n.port&&(t+=":"+n.port),n.host=t;break;case"host":n[e]=t,hi.test(t)?(t=t.split(":"),n.port=t.pop(),n.hostname=t.join(":")):(n.hostname=t,n.port="");break;case"protocol":n.protocol=t.toLowerCase(),n.slashes=!r;break;case"pathname":case"hash":if(t){var i=e==="pathname"?"/":"#";n[e]=t.charAt(0)!==i?i+t:t}else n[e]=t;break;case"username":case"password":n[e]=encodeURIComponent(t);break;case"auth":var o=t.indexOf(":");~o?(n.username=t.slice(0,o),n.username=encodeURIComponent(decodeURIComponent(n.username)),n.password=t.slice(o+1),n.password=encodeURIComponent(decodeURIComponent(n.password))):n.username=encodeURIComponent(decodeURIComponent(t))}for(var a=0;a<Pr.length;a++){var u=Pr[a];u[4]&&(n[u[1]]=n[u[1]].toLowerCase())}return n.auth=n.password?n.username+":"+n.password:n.username,n.origin=n.protocol!=="file:"&&we(n.protocol)&&n.host?n.protocol+"//"+n.host:"null",n.href=n.toString(),n}function ts(e){(!e||typeof e!="function")&&(e=sr.stringify);var t,r=this,n=r.host,i=r.protocol;i&&i.charAt(i.length-1)!==":"&&(i+=":");var o=i+(r.protocol&&r.slashes||we(r.protocol)?"//":"");return r.username?(o+=r.username,r.password&&(o+=":"+r.password),o+="@"):r.password?(o+=":"+r.password,o+="@"):r.protocol!=="file:"&&we(r.protocol)&&!n&&r.pathname!=="/"&&(o+="@"),(n[n.length-1]===":"||hi.test(r.hostname)&&!r.port)&&(n+=":"),o+=n+r.pathname,t=typeof r.query=="object"?e(r.query):r.query,t&&(o+=t.charAt(0)!=="?"?"?"+t:t),r.hash&&(o+=r.hash),o}_e.prototype={set:es,toString:ts};_e.extractProtocol=pi;_e.location=di;_e.trimLeft=Qr;_e.qs=sr;var rs=_e;const ns=$a(rs);function is(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,r=e==="x"?t:t&3|8;return r.toString(16)})}function Or(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Or=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(c,l,f){c[l]=f.value},o=typeof Symbol=="function"?Symbol:{},a=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",d=o.toStringTag||"@@toStringTag";function v(c,l,f){return Object.defineProperty(c,l,{value:f,enumerable:!0,configurable:!0,writable:!0}),c[l]}try{v({},"")}catch{v=function(f,m,h){return f[m]=h}}function S(c,l,f,m){var h=l&&l.prototype instanceof le?l:le,p=Object.create(h.prototype),w=new Ce(m||[]);return i(p,"_invoke",{value:ot(c,f,w)}),p}function y(c,l,f){try{return{type:"normal",arg:c.call(l,f)}}catch(m){return{type:"throw",arg:m}}}t.wrap=S;var V="suspendedStart",se="suspendedYield",M="executing",z="completed",P={};function le(){}function J(){}function N(){}var te={};v(te,a,function(){return this});var Se=Object.getPrototypeOf,re=Se&&Se(Se(Te([])));re&&re!==r&&n.call(re,a)&&(te=re);var Y=N.prototype=le.prototype=Object.create(te);function Oe(c){["next","throw","return"].forEach(function(l){v(c,l,function(f){return this._invoke(l,f)})})}function ce(c,l){function f(h,p,w,T){var E=y(c[h],c,p);if(E.type!=="throw"){var R=E.arg,I=R.value;return I&&Ne(I)=="object"&&n.call(I,"__await")?l.resolve(I.__await).then(function(H){f("next",H,w,T)},function(H){f("throw",H,w,T)}):l.resolve(I).then(function(H){R.value=H,w(R)},function(H){return f("throw",H,w,T)})}T(E.arg)}var m;i(this,"_invoke",{value:function(p,w){function T(){return new l(function(E,R){f(p,w,E,R)})}return m=m?m.then(T,T):T()}})}function ot(c,l,f){var m=V;return function(h,p){if(m===M)throw Error("Generator is already running");if(m===z){if(h==="throw")throw p;return{value:e,done:!0}}for(f.method=h,f.arg=p;;){var w=f.delegate;if(w){var T=Re(w,f);if(T){if(T===P)continue;return T}}if(f.method==="next")f.sent=f._sent=f.arg;else if(f.method==="throw"){if(m===V)throw m=z,f.arg;f.dispatchException(f.arg)}else f.method==="return"&&f.abrupt("return",f.arg);m=M;var E=y(c,l,f);if(E.type==="normal"){if(m=f.done?z:se,E.arg===P)continue;return{value:E.arg,done:f.done}}E.type==="throw"&&(m=z,f.method="throw",f.arg=E.arg)}}}function Re(c,l){var f=l.method,m=c.iterator[f];if(m===e)return l.delegate=null,f==="throw"&&c.iterator.return&&(l.method="return",l.arg=e,Re(c,l),l.method==="throw")||f!=="return"&&(l.method="throw",l.arg=new TypeError("The iterator does not provide a '"+f+"' method")),P;var h=y(m,c.iterator,l.arg);if(h.type==="throw")return l.method="throw",l.arg=h.arg,l.delegate=null,P;var p=h.arg;return p?p.done?(l[c.resultName]=p.value,l.next=c.nextLoc,l.method!=="return"&&(l.method="next",l.arg=e),l.delegate=null,P):p:(l.method="throw",l.arg=new TypeError("iterator result is not an object"),l.delegate=null,P)}function $e(c){var l={tryLoc:c[0]};1 in c&&(l.catchLoc=c[1]),2 in c&&(l.finallyLoc=c[2],l.afterLoc=c[3]),this.tryEntries.push(l)}function he(c){var l=c.completion||{};l.type="normal",delete l.arg,c.completion=l}function Ce(c){this.tryEntries=[{tryLoc:"root"}],c.forEach($e,this),this.reset(!0)}function Te(c){if(c||c===""){var l=c[a];if(l)return l.call(c);if(typeof c.next=="function")return c;if(!isNaN(c.length)){var f=-1,m=function h(){for(;++f<c.length;)if(n.call(c,f))return h.value=c[f],h.done=!1,h;return h.value=e,h.done=!0,h};return m.next=m}}throw new TypeError(Ne(c)+" is not iterable")}return J.prototype=N,i(Y,"constructor",{value:N,configurable:!0}),i(N,"constructor",{value:J,configurable:!0}),J.displayName=v(N,d,"GeneratorFunction"),t.isGeneratorFunction=function(c){var l=typeof c=="function"&&c.constructor;return!!l&&(l===J||(l.displayName||l.name)==="GeneratorFunction")},t.mark=function(c){return Object.setPrototypeOf?Object.setPrototypeOf(c,N):(c.__proto__=N,v(c,d,"GeneratorFunction")),c.prototype=Object.create(Y),c},t.awrap=function(c){return{__await:c}},Oe(ce.prototype),v(ce.prototype,u,function(){return this}),t.AsyncIterator=ce,t.async=function(c,l,f,m,h){h===void 0&&(h=Promise);var p=new ce(S(c,l,f,m),h);return t.isGeneratorFunction(l)?p:p.next().then(function(w){return w.done?w.value:p.next()})},Oe(Y),v(Y,d,"Generator"),v(Y,a,function(){return this}),v(Y,"toString",function(){return"[object Generator]"}),t.keys=function(c){var l=Object(c),f=[];for(var m in l)f.push(m);return f.reverse(),function h(){for(;f.length;){var p=f.pop();if(p in l)return h.value=p,h.done=!1,h}return h.done=!0,h}},t.values=Te,Ce.prototype={constructor:Ce,reset:function(l){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(he),!l)for(var f in this)f.charAt(0)==="t"&&n.call(this,f)&&!isNaN(+f.slice(1))&&(this[f]=e)},stop:function(){this.done=!0;var l=this.tryEntries[0].completion;if(l.type==="throw")throw l.arg;return this.rval},dispatchException:function(l){if(this.done)throw l;var f=this;function m(R,I){return w.type="throw",w.arg=l,f.next=R,I&&(f.method="next",f.arg=e),!!I}for(var h=this.tryEntries.length-1;h>=0;--h){var p=this.tryEntries[h],w=p.completion;if(p.tryLoc==="root")return m("end");if(p.tryLoc<=this.prev){var T=n.call(p,"catchLoc"),E=n.call(p,"finallyLoc");if(T&&E){if(this.prev<p.catchLoc)return m(p.catchLoc,!0);if(this.prev<p.finallyLoc)return m(p.finallyLoc)}else if(T){if(this.prev<p.catchLoc)return m(p.catchLoc,!0)}else{if(!E)throw Error("try statement without catch or finally");if(this.prev<p.finallyLoc)return m(p.finallyLoc)}}}},abrupt:function(l,f){for(var m=this.tryEntries.length-1;m>=0;--m){var h=this.tryEntries[m];if(h.tryLoc<=this.prev&&n.call(h,"finallyLoc")&&this.prev<h.finallyLoc){var p=h;break}}p&&(l==="break"||l==="continue")&&p.tryLoc<=f&&f<=p.finallyLoc&&(p=null);var w=p?p.completion:{};return w.type=l,w.arg=f,p?(this.method="next",this.next=p.finallyLoc,P):this.complete(w)},complete:function(l,f){if(l.type==="throw")throw l.arg;return l.type==="break"||l.type==="continue"?this.next=l.arg:l.type==="return"?(this.rval=this.arg=l.arg,this.method="return",this.next="end"):l.type==="normal"&&f&&(this.next=f),P},finish:function(l){for(var f=this.tryEntries.length-1;f>=0;--f){var m=this.tryEntries[f];if(m.finallyLoc===l)return this.complete(m.completion,m.afterLoc),he(m),P}},catch:function(l){for(var f=this.tryEntries.length-1;f>=0;--f){var m=this.tryEntries[f];if(m.tryLoc===l){var h=m.completion;if(h.type==="throw"){var p=h.arg;he(m)}return p}}throw Error("illegal catch attempt")},delegateYield:function(l,f,m){return this.delegate={iterator:Te(l),resultName:f,nextLoc:m},this.method==="next"&&(this.arg=e),P}},t}function yn(e,t,r,n,i,o,a){try{var u=e[o](a),d=u.value}catch(v){r(v);return}u.done?t(d):Promise.resolve(d).then(n,i)}function os(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(d){yn(o,n,i,a,u,"next",d)}function u(d){yn(o,n,i,a,u,"throw",d)}a(void 0)})}}function mi(e,t){return ls(e)||ss(e,t)||vi(e,t)||as()}function as(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ss(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,o,a,u=[],d=!0,v=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(d=(n=o.call(r)).done)&&(u.push(n.value),u.length!==t);d=!0);}catch(S){v=!0,i=S}finally{try{if(!d&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(v)throw i}}return u}}function ls(e){if(Array.isArray(e))return e}function Ne(e){"@babel/helpers - typeof";return Ne=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ne(e)}function us(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=vi(e))||t){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,u;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){a=!0,u=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(a)throw u}}}}function vi(e,t){if(e){if(typeof e=="string")return gn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gn(e,t)}}function gn(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function wn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Ke(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?wn(Object(r),!0).forEach(function(n){fs(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wn(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function fs(e,t,r){return t=yi(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cs(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,yi(n.key),n)}}function hs(e,t,r){return t&&bn(e.prototype,t),r&&bn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function yi(e){var t=ds(e,"string");return Ne(t)=="symbol"?t:t+""}function ds(e,t){if(Ne(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Ne(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Xt="tus-v1",Jt="ietf-draft-03",pt="ietf-draft-05",ps={endpoint:null,uploadUrl:null,metadata:{},metadataForPartialUploads:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:gi,chunkSize:Number.POSITIVE_INFINITY,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null,protocol:Xt},ir=function(){function e(t,r){cs(this,e),"resume"in r&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=r,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=t,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}return hs(e,[{key:"findPreviousUploads",value:function(){var r=this;return this.options.fingerprint(this.file,this.options).then(function(n){return r._urlStorage.findUploadsByFingerprint(n)})}},{key:"resumeFromPreviousUpload",value:function(r){this.url=r.uploadUrl||null,this._parallelUploadUrls=r.parallelUploadUrls||null,this._urlStorageKey=r.urlStorageKey}},{key:"start",value:function(){var r=this,n=this.file;if(!n){this._emitError(new Error("tus: no file or stream to upload provided"));return}if(![Xt,Jt,pt].includes(this.options.protocol)){this._emitError(new Error("tus: unsupported protocol ".concat(this.options.protocol)));return}if(!this.options.endpoint&&!this.options.uploadUrl&&!this.url){this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));return}var i=this.options.retryDelays;if(i!=null&&Object.prototype.toString.call(i)!=="[object Array]"){this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"));return}if(this.options.parallelUploads>1)for(var o=0,a=["uploadUrl","uploadSize","uploadLengthDeferred"];o<a.length;o++){var u=a[o];if(this.options[u]){this._emitError(new Error("tus: cannot use the ".concat(u," option when parallelUploads is enabled")));return}}if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1){this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));return}if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length){this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"));return}}this.options.fingerprint(n,this.options).then(function(d){return r._fingerprint=d,r._source?r._source:r.options.fileReader.openFile(n,r.options.chunkSize)}).then(function(d){if(r._source=d,r.options.uploadLengthDeferred)r._size=null;else if(r.options.uploadSize!=null){if(r._size=Number(r.options.uploadSize),Number.isNaN(r._size)){r._emitError(new Error("tus: cannot convert `uploadSize` option into a number"));return}}else if(r._size=r._source.size,r._size==null){r._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));return}r.options.parallelUploads>1||r._parallelUploadUrls!=null?r._startParallelUpload():r._startSingleUpload()}).catch(function(d){r._emitError(d)})}},{key:"_startParallelUpload",value:function(){var r,n=this,i=this._size,o=0;this._parallelUploads=[];var a=this._parallelUploadUrls!=null?this._parallelUploadUrls.length:this.options.parallelUploads,u=(r=this.options.parallelUploadBoundaries)!==null&&r!==void 0?r:vs(this._source.size,a);this._parallelUploadUrls&&u.forEach(function(S,y){S.uploadUrl=n._parallelUploadUrls[y]||null}),this._parallelUploadUrls=new Array(u.length);var d=u.map(function(S,y){var V=0;return n._source.slice(S.start,S.end).then(function(se){var M=se.value;return new Promise(function(z,P){var le=Ke(Ke({},n.options),{},{uploadUrl:S.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:n.options.metadataForPartialUploads,headers:Ke(Ke({},n.options.headers),{},{"Upload-Concat":"partial"}),onSuccess:z,onError:P,onProgress:function(te){o=o-V+te,V=te,n._emitProgress(o,i)},onUploadUrlAvailable:function(){n._parallelUploadUrls[y]=J.url,n._parallelUploadUrls.filter(function(te){return!!te}).length===u.length&&n._saveUploadInUrlStorage()}}),J=new e(M,le);J.start(),n._parallelUploads.push(J)})})}),v;Promise.all(d).then(function(){v=n._openRequest("POST",n.options.endpoint),v.setHeader("Upload-Concat","final;".concat(n._parallelUploadUrls.join(" ")));var S=_n(n.options.metadata);return S!==""&&v.setHeader("Upload-Metadata",S),n._sendRequest(v,null)}).then(function(S){if(!Je(S.getStatus(),200)){n._emitHttpError(v,S,"tus: unexpected response while creating upload");return}var y=S.getHeader("Location");if(y==null){n._emitHttpError(v,S,"tus: invalid or missing Location header");return}n.url=En(n.options.endpoint,y),"Created upload at ".concat(n.url),n._emitSuccess(S)}).catch(function(S){n._emitError(S)})}},{key:"_startSingleUpload",value:function(){if(this._aborted=!1,this.url!=null){"Resuming upload from previous URL: ".concat(this.url),this._resumeUpload();return}if(this.options.uploadUrl!=null){"Resuming upload from provided URL: ".concat(this.options.uploadUrl),this.url=this.options.uploadUrl,this._resumeUpload();return}this._createUpload()}},{key:"abort",value:function(r){var n=this;if(this._parallelUploads!=null){var i=us(this._parallelUploads),o;try{for(i.s();!(o=i.n()).done;){var a=o.value;a.abort(r)}}catch(u){i.e(u)}finally{i.f()}}return this._req!==null&&this._req.abort(),this._aborted=!0,this._retryTimeout!=null&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),!r||this.url==null?Promise.resolve():e.terminate(this.url,this.options).then(function(){return n._removeFromUrlStorage()})}},{key:"_emitHttpError",value:function(r,n,i,o){this._emitError(new Nt(i,o,r,n))}},{key:"_emitError",value:function(r){var n=this;if(!this._aborted){if(this.options.retryDelays!=null){var i=this._offset!=null&&this._offset>this._offsetBeforeRetry;if(i&&(this._retryAttempt=0),Tn(r,this._retryAttempt,this.options)){var o=this.options.retryDelays[this._retryAttempt++];this._offsetBeforeRetry=this._offset,this._retryTimeout=setTimeout(function(){n.start()},o);return}}if(typeof this.options.onError=="function")this.options.onError(r);else throw r}}},{key:"_emitSuccess",value:function(r){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),typeof this.options.onSuccess=="function"&&this.options.onSuccess({lastResponse:r})}},{key:"_emitProgress",value:function(r,n){typeof this.options.onProgress=="function"&&this.options.onProgress(r,n)}},{key:"_emitChunkComplete",value:function(r,n,i){typeof this.options.onChunkComplete=="function"&&this.options.onChunkComplete(r,n,i)}},{key:"_createUpload",value:function(){var r=this;if(!this.options.endpoint){this._emitError(new Error("tus: unable to create upload because no endpoint is provided"));return}var n=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?n.setHeader("Upload-Defer-Length","1"):n.setHeader("Upload-Length","".concat(this._size));var i=_n(this.options.metadata);i!==""&&n.setHeader("Upload-Metadata",i);var o;this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,o=this._addChunkToRequest(n)):((this.options.protocol===Jt||this.options.protocol===pt)&&n.setHeader("Upload-Complete","?0"),o=this._sendRequest(n,null)),o.then(function(a){if(!Je(a.getStatus(),200)){r._emitHttpError(n,a,"tus: unexpected response while creating upload");return}var u=a.getHeader("Location");if(u==null){r._emitHttpError(n,a,"tus: invalid or missing Location header");return}if(r.url=En(r.options.endpoint,u),"Created upload at ".concat(r.url),typeof r.options.onUploadUrlAvailable=="function"&&r.options.onUploadUrlAvailable(),r._size===0){r._emitSuccess(a),r._source.close();return}r._saveUploadInUrlStorage().then(function(){r.options.uploadDataDuringCreation?r._handleUploadResponse(n,a):(r._offset=0,r._performUpload())})}).catch(function(a){r._emitHttpError(n,null,"tus: failed to create upload",a)})}},{key:"_resumeUpload",value:function(){var r=this,n=this._openRequest("HEAD",this.url),i=this._sendRequest(n,null);i.then(function(o){var a=o.getStatus();if(!Je(a,200)){if(a===423){r._emitHttpError(n,o,"tus: upload is currently locked; retry later");return}if(Je(a,400)&&r._removeFromUrlStorage(),!r.options.endpoint){r._emitHttpError(n,o,"tus: unable to resume upload (new upload cannot be created without an endpoint)");return}r.url=null,r._createUpload();return}var u=Number.parseInt(o.getHeader("Upload-Offset"),10);if(Number.isNaN(u)){r._emitHttpError(n,o,"tus: invalid or missing offset value");return}var d=Number.parseInt(o.getHeader("Upload-Length"),10);if(Number.isNaN(d)&&!r.options.uploadLengthDeferred&&r.options.protocol===Xt){r._emitHttpError(n,o,"tus: invalid or missing length value");return}typeof r.options.onUploadUrlAvailable=="function"&&r.options.onUploadUrlAvailable(),r._saveUploadInUrlStorage().then(function(){if(u===d){r._emitProgress(d,d),r._emitSuccess(o);return}r._offset=u,r._performUpload()})}).catch(function(o){r._emitHttpError(n,null,"tus: failed to resume upload",o)})}},{key:"_performUpload",value:function(){var r=this;if(!this._aborted){var n;this.options.overridePatchMethod?(n=this._openRequest("POST",this.url),n.setHeader("X-HTTP-Method-Override","PATCH")):n=this._openRequest("PATCH",this.url),n.setHeader("Upload-Offset","".concat(this._offset));var i=this._addChunkToRequest(n);i.then(function(o){if(!Je(o.getStatus(),200)){r._emitHttpError(n,o,"tus: unexpected response while uploading chunk");return}r._handleUploadResponse(n,o)}).catch(function(o){r._aborted||r._emitHttpError(n,null,"tus: failed to upload chunk at offset ".concat(r._offset),o)})}}},{key:"_addChunkToRequest",value:function(r){var n=this,i=this._offset,o=this._offset+this.options.chunkSize;return r.setProgressHandler(function(a){n._emitProgress(i+a,n._size)}),this.options.protocol===Xt?r.setHeader("Content-Type","application/offset+octet-stream"):this.options.protocol===pt&&r.setHeader("Content-Type","application/partial-upload"),(o===Number.POSITIVE_INFINITY||o>this._size)&&!this.options.uploadLengthDeferred&&(o=this._size),this._source.slice(i,o).then(function(a){var u=a.value,d=a.done,v=u!=null&&u.size?u.size:0;n.options.uploadLengthDeferred&&d&&(n._size=n._offset+v,r.setHeader("Upload-Length","".concat(n._size)));var S=n._offset+v;return!n.options.uploadLengthDeferred&&d&&S!==n._size?Promise.reject(new Error("upload was configured with a size of ".concat(n._size," bytes, but the source is done after ").concat(S," bytes"))):u===null?n._sendRequest(r):((n.options.protocol===Jt||n.options.protocol===pt)&&r.setHeader("Upload-Complete",d?"?1":"?0"),n._emitProgress(n._offset,n._size),n._sendRequest(r,u))})}},{key:"_handleUploadResponse",value:function(r,n){var i=Number.parseInt(n.getHeader("Upload-Offset"),10);if(Number.isNaN(i)){this._emitHttpError(r,n,"tus: invalid or missing offset value");return}if(this._emitProgress(i,this._size),this._emitChunkComplete(i-this._offset,i,this._size),this._offset=i,i===this._size){this._emitSuccess(n),this._source.close();return}this._performUpload()}},{key:"_openRequest",value:function(r,n){var i=Sn(r,n,this.options);return this._req=i,i}},{key:"_removeFromUrlStorage",value:function(){var r=this;this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch(function(n){r._emitError(n)}),this._urlStorageKey=null)}},{key:"_saveUploadInUrlStorage",value:function(){var r=this;if(!this.options.storeFingerprintForResuming||!this._fingerprint||this._urlStorageKey!==null)return Promise.resolve();var n={size:this._size,metadata:this.options.metadata,creationTime:new Date().toString()};return this._parallelUploads?n.parallelUploadUrls=this._parallelUploadUrls:n.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,n).then(function(i){r._urlStorageKey=i})}},{key:"_sendRequest",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return Cn(r,n,this.options)}}],[{key:"terminate",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=Sn("DELETE",r,n);return Cn(i,null,n).then(function(o){if(o.getStatus()!==204)throw new Nt("tus: unexpected response while terminating upload",null,i,o)}).catch(function(o){if(o instanceof Nt||(o=new Nt("tus: failed to terminate upload",o,i,null)),!Tn(o,0,n))throw o;var a=n.retryDelays[0],u=n.retryDelays.slice(1),d=Ke(Ke({},n),{},{retryDelays:u});return new Promise(function(v){return setTimeout(v,a)}).then(function(){return e.terminate(r,d)})})}}])}();function _n(e){return Object.entries(e).map(function(t){var r=mi(t,2),n=r[0],i=r[1];return"".concat(n," ").concat(Ha.encode(String(i)))}).join(",")}function Je(e,t){return e>=t&&e<t+100}function Sn(e,t,r){var n=r.httpStack.createRequest(e,t);r.protocol===Jt?n.setHeader("Upload-Draft-Interop-Version","5"):r.protocol===pt?n.setHeader("Upload-Draft-Interop-Version","6"):n.setHeader("Tus-Resumable","1.0.0");for(var i=r.headers||{},o=0,a=Object.entries(i);o<a.length;o++){var u=mi(a[o],2),d=u[0],v=u[1];n.setHeader(d,v)}if(r.addRequestId){var S=is();n.setHeader("X-Request-ID",S)}return n}function Cn(e,t,r){return Rr.apply(this,arguments)}function Rr(){return Rr=os(Or().mark(function e(t,r,n){var i;return Or().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(typeof n.onBeforeRequest!="function"){a.next=3;break}return a.next=3,n.onBeforeRequest(t);case 3:return a.next=5,t.send(r);case 5:if(i=a.sent,typeof n.onAfterResponse!="function"){a.next=9;break}return a.next=9,n.onAfterResponse(t,i);case 9:return a.abrupt("return",i);case 10:case"end":return a.stop()}},e)})),Rr.apply(this,arguments)}function ms(){var e=!0;return typeof navigator<"u"&&navigator.onLine===!1&&(e=!1),e}function Tn(e,t,r){return r.retryDelays==null||t>=r.retryDelays.length||e.originalRequest==null?!1:r&&typeof r.onShouldRetry=="function"?r.onShouldRetry(e,t,r):gi(e)}function gi(e){var t=e.originalResponse?e.originalResponse.getStatus():0;return(!Je(t,400)||t===409||t===423)&&ms()}function En(e,t){return new ns(t,e).toString()}function vs(e,t){for(var r=Math.floor(e/t),n=[],i=0;i<t;i++)n.push({start:r*i,end:r*(i+1)});return n[t-1].end=e,n}ir.defaultOptions=ps;var wi=function(){return typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative"};function ys(e){return new Promise(function(t,r){var n=new XMLHttpRequest;n.responseType="blob",n.onload=function(){var i=n.response;t(i)},n.onerror=function(i){r(i)},n.open("GET",e),n.send()})}var gs=function(){return typeof window<"u"&&(typeof window.PhoneGap<"u"||typeof window.Cordova<"u"||typeof window.cordova<"u")};function ws(e){return new Promise(function(t,r){var n=new FileReader;n.onload=function(){var i=new Uint8Array(n.result);t({value:i})},n.onerror=function(i){r(i)},n.readAsArrayBuffer(e)})}function Tt(e){"@babel/helpers - typeof";return Tt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tt(e)}function bs(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Cs(n.key),n)}}function Ss(e,t,r){return t&&_s(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Cs(e){var t=Ts(e,"string");return Tt(t)=="symbol"?t:t+""}function Ts(e,t){if(Tt(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Tt(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Un=function(){function e(t){bs(this,e),this._file=t,this.size=t.size}return Ss(e,[{key:"slice",value:function(r,n){if(gs())return ws(this._file.slice(r,n));var i=this._file.slice(r,n),o=n>=this.size;return Promise.resolve({value:i,done:o})}},{key:"close",value:function(){}}])}();function Et(e){"@babel/helpers - typeof";return Et=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Et(e)}function Es(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Us(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ks(n.key),n)}}function xs(e,t,r){return t&&Us(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function ks(e){var t=Ps(e,"string");return Et(t)=="symbol"?t:t+""}function Ps(e,t){if(Et(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Et(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function xn(e){return e===void 0?0:e.size!==void 0?e.size:e.length}function Os(e,t){if(e.concat)return e.concat(t);if(e instanceof Blob)return new Blob([e,t],{type:e.type});if(e.set){var r=new e.constructor(e.length+t.length);return r.set(e),r.set(t,e.length),r}throw new Error("Unknown data type")}var Rs=function(){function e(t){Es(this,e),this._buffer=void 0,this._bufferOffset=0,this._reader=t,this._done=!1}return xs(e,[{key:"slice",value:function(r,n){return r<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(r,n)}},{key:"_readUntilEnoughDataOrDone",value:function(r,n){var i=this,o=n<=this._bufferOffset+xn(this._buffer);if(this._done||o){var a=this._getDataFromBuffer(r,n),u=a==null?this._done:!1;return Promise.resolve({value:a,done:u})}return this._reader.read().then(function(d){var v=d.value,S=d.done;return S?i._done=!0:i._buffer===void 0?i._buffer=v:i._buffer=Os(i._buffer,v),i._readUntilEnoughDataOrDone(r,n)})}},{key:"_getDataFromBuffer",value:function(r,n){r>this._bufferOffset&&(this._buffer=this._buffer.slice(r-this._bufferOffset),this._bufferOffset=r);var i=xn(this._buffer)===0;return this._done&&i?null:this._buffer.slice(0,n-r)}},{key:"close",value:function(){this._reader.cancel&&this._reader.cancel()}}])}();function He(e){"@babel/helpers - typeof";return He=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},He(e)}function Ar(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Ar=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(c,l,f){c[l]=f.value},o=typeof Symbol=="function"?Symbol:{},a=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",d=o.toStringTag||"@@toStringTag";function v(c,l,f){return Object.defineProperty(c,l,{value:f,enumerable:!0,configurable:!0,writable:!0}),c[l]}try{v({},"")}catch{v=function(f,m,h){return f[m]=h}}function S(c,l,f,m){var h=l&&l.prototype instanceof le?l:le,p=Object.create(h.prototype),w=new Ce(m||[]);return i(p,"_invoke",{value:ot(c,f,w)}),p}function y(c,l,f){try{return{type:"normal",arg:c.call(l,f)}}catch(m){return{type:"throw",arg:m}}}t.wrap=S;var V="suspendedStart",se="suspendedYield",M="executing",z="completed",P={};function le(){}function J(){}function N(){}var te={};v(te,a,function(){return this});var Se=Object.getPrototypeOf,re=Se&&Se(Se(Te([])));re&&re!==r&&n.call(re,a)&&(te=re);var Y=N.prototype=le.prototype=Object.create(te);function Oe(c){["next","throw","return"].forEach(function(l){v(c,l,function(f){return this._invoke(l,f)})})}function ce(c,l){function f(h,p,w,T){var E=y(c[h],c,p);if(E.type!=="throw"){var R=E.arg,I=R.value;return I&&He(I)=="object"&&n.call(I,"__await")?l.resolve(I.__await).then(function(H){f("next",H,w,T)},function(H){f("throw",H,w,T)}):l.resolve(I).then(function(H){R.value=H,w(R)},function(H){return f("throw",H,w,T)})}T(E.arg)}var m;i(this,"_invoke",{value:function(p,w){function T(){return new l(function(E,R){f(p,w,E,R)})}return m=m?m.then(T,T):T()}})}function ot(c,l,f){var m=V;return function(h,p){if(m===M)throw Error("Generator is already running");if(m===z){if(h==="throw")throw p;return{value:e,done:!0}}for(f.method=h,f.arg=p;;){var w=f.delegate;if(w){var T=Re(w,f);if(T){if(T===P)continue;return T}}if(f.method==="next")f.sent=f._sent=f.arg;else if(f.method==="throw"){if(m===V)throw m=z,f.arg;f.dispatchException(f.arg)}else f.method==="return"&&f.abrupt("return",f.arg);m=M;var E=y(c,l,f);if(E.type==="normal"){if(m=f.done?z:se,E.arg===P)continue;return{value:E.arg,done:f.done}}E.type==="throw"&&(m=z,f.method="throw",f.arg=E.arg)}}}function Re(c,l){var f=l.method,m=c.iterator[f];if(m===e)return l.delegate=null,f==="throw"&&c.iterator.return&&(l.method="return",l.arg=e,Re(c,l),l.method==="throw")||f!=="return"&&(l.method="throw",l.arg=new TypeError("The iterator does not provide a '"+f+"' method")),P;var h=y(m,c.iterator,l.arg);if(h.type==="throw")return l.method="throw",l.arg=h.arg,l.delegate=null,P;var p=h.arg;return p?p.done?(l[c.resultName]=p.value,l.next=c.nextLoc,l.method!=="return"&&(l.method="next",l.arg=e),l.delegate=null,P):p:(l.method="throw",l.arg=new TypeError("iterator result is not an object"),l.delegate=null,P)}function $e(c){var l={tryLoc:c[0]};1 in c&&(l.catchLoc=c[1]),2 in c&&(l.finallyLoc=c[2],l.afterLoc=c[3]),this.tryEntries.push(l)}function he(c){var l=c.completion||{};l.type="normal",delete l.arg,c.completion=l}function Ce(c){this.tryEntries=[{tryLoc:"root"}],c.forEach($e,this),this.reset(!0)}function Te(c){if(c||c===""){var l=c[a];if(l)return l.call(c);if(typeof c.next=="function")return c;if(!isNaN(c.length)){var f=-1,m=function h(){for(;++f<c.length;)if(n.call(c,f))return h.value=c[f],h.done=!1,h;return h.value=e,h.done=!0,h};return m.next=m}}throw new TypeError(He(c)+" is not iterable")}return J.prototype=N,i(Y,"constructor",{value:N,configurable:!0}),i(N,"constructor",{value:J,configurable:!0}),J.displayName=v(N,d,"GeneratorFunction"),t.isGeneratorFunction=function(c){var l=typeof c=="function"&&c.constructor;return!!l&&(l===J||(l.displayName||l.name)==="GeneratorFunction")},t.mark=function(c){return Object.setPrototypeOf?Object.setPrototypeOf(c,N):(c.__proto__=N,v(c,d,"GeneratorFunction")),c.prototype=Object.create(Y),c},t.awrap=function(c){return{__await:c}},Oe(ce.prototype),v(ce.prototype,u,function(){return this}),t.AsyncIterator=ce,t.async=function(c,l,f,m,h){h===void 0&&(h=Promise);var p=new ce(S(c,l,f,m),h);return t.isGeneratorFunction(l)?p:p.next().then(function(w){return w.done?w.value:p.next()})},Oe(Y),v(Y,d,"Generator"),v(Y,a,function(){return this}),v(Y,"toString",function(){return"[object Generator]"}),t.keys=function(c){var l=Object(c),f=[];for(var m in l)f.push(m);return f.reverse(),function h(){for(;f.length;){var p=f.pop();if(p in l)return h.value=p,h.done=!1,h}return h.done=!0,h}},t.values=Te,Ce.prototype={constructor:Ce,reset:function(l){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(he),!l)for(var f in this)f.charAt(0)==="t"&&n.call(this,f)&&!isNaN(+f.slice(1))&&(this[f]=e)},stop:function(){this.done=!0;var l=this.tryEntries[0].completion;if(l.type==="throw")throw l.arg;return this.rval},dispatchException:function(l){if(this.done)throw l;var f=this;function m(R,I){return w.type="throw",w.arg=l,f.next=R,I&&(f.method="next",f.arg=e),!!I}for(var h=this.tryEntries.length-1;h>=0;--h){var p=this.tryEntries[h],w=p.completion;if(p.tryLoc==="root")return m("end");if(p.tryLoc<=this.prev){var T=n.call(p,"catchLoc"),E=n.call(p,"finallyLoc");if(T&&E){if(this.prev<p.catchLoc)return m(p.catchLoc,!0);if(this.prev<p.finallyLoc)return m(p.finallyLoc)}else if(T){if(this.prev<p.catchLoc)return m(p.catchLoc,!0)}else{if(!E)throw Error("try statement without catch or finally");if(this.prev<p.finallyLoc)return m(p.finallyLoc)}}}},abrupt:function(l,f){for(var m=this.tryEntries.length-1;m>=0;--m){var h=this.tryEntries[m];if(h.tryLoc<=this.prev&&n.call(h,"finallyLoc")&&this.prev<h.finallyLoc){var p=h;break}}p&&(l==="break"||l==="continue")&&p.tryLoc<=f&&f<=p.finallyLoc&&(p=null);var w=p?p.completion:{};return w.type=l,w.arg=f,p?(this.method="next",this.next=p.finallyLoc,P):this.complete(w)},complete:function(l,f){if(l.type==="throw")throw l.arg;return l.type==="break"||l.type==="continue"?this.next=l.arg:l.type==="return"?(this.rval=this.arg=l.arg,this.method="return",this.next="end"):l.type==="normal"&&f&&(this.next=f),P},finish:function(l){for(var f=this.tryEntries.length-1;f>=0;--f){var m=this.tryEntries[f];if(m.finallyLoc===l)return this.complete(m.completion,m.afterLoc),he(m),P}},catch:function(l){for(var f=this.tryEntries.length-1;f>=0;--f){var m=this.tryEntries[f];if(m.tryLoc===l){var h=m.completion;if(h.type==="throw"){var p=h.arg;he(m)}return p}}throw Error("illegal catch attempt")},delegateYield:function(l,f,m){return this.delegate={iterator:Te(l),resultName:f,nextLoc:m},this.method==="next"&&(this.arg=e),P}},t}function kn(e,t,r,n,i,o,a){try{var u=e[o](a),d=u.value}catch(v){r(v);return}u.done?t(d):Promise.resolve(d).then(n,i)}function As(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(d){kn(o,n,i,a,u,"next",d)}function u(d){kn(o,n,i,a,u,"throw",d)}a(void 0)})}}function Is(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ds(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,js(n.key),n)}}function Fs(e,t,r){return t&&Ds(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function js(e){var t=zs(e,"string");return He(t)=="symbol"?t:t+""}function zs(e,t){if(He(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(He(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Ls=function(){function e(){Is(this,e)}return Fs(e,[{key:"openFile",value:function(){var t=As(Ar().mark(function n(i,o){var a;return Ar().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!(wi()&&i&&typeof i.uri<"u")){d.next=11;break}return d.prev=1,d.next=4,ys(i.uri);case 4:return a=d.sent,d.abrupt("return",new Un(a));case 8:throw d.prev=8,d.t0=d.catch(1),new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. ".concat(d.t0));case 11:if(!(typeof i.slice=="function"&&typeof i.size<"u")){d.next=13;break}return d.abrupt("return",Promise.resolve(new Un(i)));case 13:if(typeof i.read!="function"){d.next=18;break}if(o=Number(o),Number.isFinite(o)){d.next=17;break}return d.abrupt("return",Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option")));case 17:return d.abrupt("return",Promise.resolve(new Rs(i,o)));case 18:return d.abrupt("return",Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment")));case 19:case"end":return d.stop()}},n,null,[[1,8]])}));function r(n,i){return t.apply(this,arguments)}return r}()}])}();function Bs(e,t){return wi()?Promise.resolve(Ms(e,t)):Promise.resolve(["tus-br",e.name,e.type,e.size,e.lastModified,t.endpoint].join("-"))}function Ms(e,t){var r=e.exif?Ns(JSON.stringify(e.exif)):"noexif";return["tus-rn",e.name||"noname",e.size||"nosize",r,t.endpoint].join("/")}function Ns(e){var t=0;if(e.length===0)return t;for(var r=0;r<e.length;r++){var n=e.charCodeAt(r);t=(t<<5)-t+n,t&=t}return t}function Ut(e){"@babel/helpers - typeof";return Ut=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ut(e)}function en(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Hs(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,$s(n.key),n)}}function tn(e,t,r){return t&&Hs(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function $s(e){var t=Ws(e,"string");return Ut(t)=="symbol"?t:t+""}function Ws(e,t){if(Ut(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Ut(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var qs=function(){function e(){en(this,e)}return tn(e,[{key:"createRequest",value:function(r,n){return new Vs(r,n)}},{key:"getName",value:function(){return"XHRHttpStack"}}])}(),Vs=function(){function e(t,r){en(this,e),this._xhr=new XMLHttpRequest,this._xhr.open(t,r,!0),this._method=t,this._url=r,this._headers={}}return tn(e,[{key:"getMethod",value:function(){return this._method}},{key:"getURL",value:function(){return this._url}},{key:"setHeader",value:function(r,n){this._xhr.setRequestHeader(r,n),this._headers[r]=n}},{key:"getHeader",value:function(r){return this._headers[r]}},{key:"setProgressHandler",value:function(r){"upload"in this._xhr&&(this._xhr.upload.onprogress=function(n){n.lengthComputable&&r(n.loaded)})}},{key:"send",value:function(){var r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return new Promise(function(i,o){r._xhr.onload=function(){i(new Gs(r._xhr))},r._xhr.onerror=function(a){o(a)},r._xhr.send(n)})}},{key:"abort",value:function(){return this._xhr.abort(),Promise.resolve()}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}(),Gs=function(){function e(t){en(this,e),this._xhr=t}return tn(e,[{key:"getStatus",value:function(){return this._xhr.status}},{key:"getHeader",value:function(r){return this._xhr.getResponseHeader(r)}},{key:"getBody",value:function(){return this._xhr.responseText}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}();function xt(e){"@babel/helpers - typeof";return xt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xt(e)}function Ks(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xs(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ys(n.key),n)}}function Js(e,t,r){return t&&Xs(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ys(e){var t=Zs(e,"string");return xt(t)=="symbol"?t:t+""}function Zs(e,t){if(xt(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(xt(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Ir=!1;try{Ir="localStorage"in window;var dr="tusSupport",Pn=localStorage.getItem(dr);localStorage.setItem(dr,Pn),Pn===null&&localStorage.removeItem(dr)}catch(e){if(e.code===e.SECURITY_ERR||e.code===e.QUOTA_EXCEEDED_ERR)Ir=!1;else throw e}var Qs=Ir,el=function(){function e(){Ks(this,e)}return Js(e,[{key:"findAllUploads",value:function(){var r=this._findEntries("tus::");return Promise.resolve(r)}},{key:"findUploadsByFingerprint",value:function(r){var n=this._findEntries("tus::".concat(r,"::"));return Promise.resolve(n)}},{key:"removeUpload",value:function(r){return localStorage.removeItem(r),Promise.resolve()}},{key:"addUpload",value:function(r,n){var i=Math.round(Math.random()*1e12),o="tus::".concat(r,"::").concat(i);return localStorage.setItem(o,JSON.stringify(n)),Promise.resolve(o)}},{key:"_findEntries",value:function(r){for(var n=[],i=0;i<localStorage.length;i++){var o=localStorage.key(i);if(o.indexOf(r)===0)try{var a=JSON.parse(localStorage.getItem(o));a.urlStorageKey=o,n.push(a)}catch{}}return n}}])}();function nt(e){"@babel/helpers - typeof";return nt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nt(e)}function tl(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function rl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_i(n.key),n)}}function nl(e,t,r){return r&&rl(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function il(e,t,r){return t=or(t),ol(e,bi()?Reflect.construct(t,r||[],or(e).constructor):t.apply(e,r))}function ol(e,t){if(t&&(nt(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return al(e)}function al(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bi(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(bi=function(){return!!e})()}function or(e){return or=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},or(e)}function sl(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Dr(e,t)}function Dr(e,t){return Dr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},Dr(e,t)}function On(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Ze(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?On(Object(r),!0).forEach(function(n){ll(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):On(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ll(e,t,r){return t=_i(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _i(e){var t=ul(e,"string");return nt(t)=="symbol"?t:t+""}function ul(e,t){if(nt(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(nt(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Rn=Ze(Ze({},ir.defaultOptions),{},{httpStack:new qs,fileReader:new Ls,urlStorage:Qs?new el:new Ra,fingerprint:Bs}),fl=function(e){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return tl(this,t),n=Ze(Ze({},Rn),n),il(this,t,[r,n])}return sl(t,e),nl(t,null,[{key:"terminate",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return i=Ze(Ze({},Rn),i),ir.terminate(n,i)}}])}(ir);const cl={endpoint:"",chunkSize:5*1024*1024,retryDelays:[0,1e3,3e3,5e3],maxRetries:3};class hl{constructor(t={}){O(this,"config");O(this,"currentUpload",null);this.config={...cl,...t}}async uploadVideo(t,r,n){return new Promise((i,o)=>{const a=new Blob([t.buffer],{type:"video/mp4"});this.currentUpload=new fl(a,{endpoint:r,chunkSize:this.config.chunkSize,retryDelays:this.config.retryDelays,metadata:{filetype:"video/mp4",name:`jump_${Date.now()}.mp4`},onProgress:(u,d)=>{n&&n({phase:"video",bytesUploaded:u,bytesTotal:d,percentage:Math.round(u/d*100)})},onSuccess:()=>{var d;const u=(d=this.currentUpload)==null?void 0:d.url;if(u){const v=pl(u);i(v)}else o(new F("UPLOAD_FAILED","No upload URL returned"))},onError:u=>{o(new F("UPLOAD_FAILED",u.message,!0))}}),this.currentUpload.start()})}abort(){this.currentUpload&&(this.currentUpload.abort(),this.currentUpload=null)}canResume(){return this.currentUpload!==null}resume(){this.currentUpload&&this.currentUpload.start()}}class dl{async upload(t,r,n,i){try{const o=await fetch(r,{method:"POST",headers:{"Content-Type":n},body:t.buffer});if(!o.ok)throw new F("UPLOAD_FAILED",`HTTP ${o.status}: ${o.statusText}`);return o}catch(o){throw o instanceof F?o:new F("NETWORK_ERROR",o instanceof Error?o.message:"Upload failed",!0)}}}function pl(e){const t=e.split("/");return t[t.length-1]||e}var At,It,Dt,Ft,jt,zt;class ml{constructor(t){de(this,At,ie("idle"));de(this,It,ie(null));de(this,Dt,ie(null));de(this,Ft,ie(null));de(this,jt,ie(null));de(this,zt,ie(0));O(this,"config");O(this,"convexUrl");O(this,"userId");O(this,"camera");O(this,"motion");O(this,"encoder",null);O(this,"fallbackRecorder",null);O(this,"tusUploader");O(this,"fetchUploader");O(this,"useWebCodecs",!1);O(this,"captureStartTime",0);O(this,"captureInterval",null);O(this,"frameReader",null);this.config=t,this.convexUrl=t.convexUrl,this.userId=t.userId,this.camera=new Wi({frameRate:60}),this.motion=new Ki,this.tusUploader=new hl,this.fetchUploader=new dl}get state(){return b(L(this,At))}set state(t){oe(L(this,At),t,!0)}get session(){return b(L(this,It))}set session(t){oe(L(this,It),t,!0)}get lastJump(){return b(L(this,Dt))}set lastJump(t){oe(L(this,Dt),t,!0)}get error(){return b(L(this,Ft))}set error(t){oe(L(this,Ft),t,!0)}get uploadProgress(){return b(L(this,jt))}set uploadProgress(t){oe(L(this,jt),t,!0)}get recordingDuration(){return b(L(this,zt))}set recordingDuration(t){oe(L(this,zt),t,!0)}async checkCompatibility(){this.setState("checking_compatibility");try{const t=await qi();return t.isCompatible?(this.useWebCodecs=t.hasWebCodecs,this.setState("idle"),!0):(this.setError(new F("UNSUPPORTED_BROWSER",t.errors.join(", "))),this.setState("unsupported"),!1)}catch(t){return this.handleError(t,"Compatibility check failed"),!1}}async requestPermissions(){this.setState("requesting_permissions");try{return await this.camera.start(),this.motion.isAvailable()&&await this.motion.requestPermission(),this.setState("idle"),!0}catch(t){return this.handleError(t,"Permission request failed"),!1}}async createSession(){this.setState("preparing_session");try{const t=await sn(this.userId),r=await this.callConvex("sessions:create",{userId:this.userId,deviceKeyId:t.keyId,publicKey:t.publicKey,platform:"web"}),n={id:r.sessionId,nonce:r.nonce,nonceDisplay:r.nonceDisplay,expiresAt:new Date(r.expiresAt),deviceKeyId:t.keyId};return this.session=n,this.setState("session_ready"),n}catch(t){throw this.handleError(t,"Session creation failed"),t}}async startCapture(){if(this.state!=="session_ready"||!this.session)throw new F("CAPTURE_FAILED","No active session");if(new Date>this.session.expiresAt)throw new F("SESSION_EXPIRED","Session has expired");this.setState("capturing"),this.captureStartTime=Date.now(),this.recordingDuration=0;try{if(this.camera.isActive||await this.camera.start(),this.motion.isAvailable()&&this.motion.start(),this.useWebCodecs){const t=this.camera.getDimensions();this.encoder=new Vr({width:t.width,height:t.height,framerate:this.camera.actualFrameRate}),await this.encoder.initialize(),this.startFrameCapture()}else this.fallbackRecorder=new nr,this.fallbackRecorder.initialize(this.camera.stream),this.fallbackRecorder.start();this.captureInterval=setInterval(()=>{this.recordingDuration=Date.now()-this.captureStartTime},100)}catch(t){throw this.handleError(t,"Capture start failed"),t}}async stopCapture(){if(this.state!=="capturing")throw new F("CAPTURE_FAILED","Not capturing");this.setState("processing"),this.captureInterval&&(clearInterval(this.captureInterval),this.captureInterval=null);try{this.stopFrameCapture();let t,r;if(this.useWebCodecs&&this.encoder)t=await this.encoder.finalize(),r=this.encoder.getStats().actualFps;else if(this.fallbackRecorder)t=await this.fallbackRecorder.stop(),r=30;else throw new F("CAPTURE_FAILED","No encoder available");const n=this.motion.stop(),i=await Kr(t),o=pr(n),a=await Tr(o);return{videoData:t,sensorData:n,startedAtMs:this.captureStartTime,endedAtMs:Date.now(),fps:r,frameCount:t.length,videoHash:i,sensorHash:a}}catch(t){throw this.handleError(t,"Capture processing failed"),t}}async submitJump(t){if(!this.session)throw new F("CAPTURE_FAILED","No active session");this.setState("uploading");try{const r=await sn(this.userId),n=await ya(this.session,t,r),i=await this.callConvex("uploads:getDirectUploadUrl",{sessionId:this.session.id}),o=await this.tusUploader.uploadVideo(t.videoData,i.tusUrl,d=>{var v,S;this.uploadProgress=d,(S=(v=this.config).onProgress)==null||S.call(v,d)}),a=pr(t.sensorData);await this.fetchUploader.upload(new TextEncoder().encode(a),i.sensorUploadUrl,"application/json");const u=await this.callConvex("jumps:submit",{sessionId:this.session.id,userId:this.userId,videoStreamId:o,proof:n});return this.setState("submitted"),{jumpId:u.jumpId,status:u.status,verificationTier:u.verificationTier,message:u.message}}catch(r){throw this.handleError(r,"Submission failed"),r}}async getJumpResult(t){const r=await this.callConvex("jumps:get",{jumpId:t}),n={jumpId:r._id,userId:r.userId,status:r.status,verificationTier:r.verificationTier,height:r.heightInches?{inches:r.heightInches,centimeters:r.heightInches*2.54}:void 0,videoUrl:r.videoUrl,thumbnailUrl:r.thumbnailUrl,processedAt:r.processedAt?new Date(r.processedAt):void 0,flags:r.flags};return this.lastJump=n,r.status==="complete"&&this.setState("complete"),n}cancel(){this.stopFrameCapture(),this.motion.stop(),this.tusUploader.abort(),this.encoder&&(this.encoder.abort(),this.encoder=null),this.fallbackRecorder&&(this.fallbackRecorder.abort(),this.fallbackRecorder=null),this.captureInterval&&(clearInterval(this.captureInterval),this.captureInterval=null),this.setState("idle")}reset(){this.cancel(),this.camera.stop(),this.session=null,this.lastJump=null,this.error=null,this.uploadProgress=null,this.recordingDuration=0,this.setState("idle")}getStream(){return this.camera.stream}getSessionTimeRemaining(){if(!this.session)return 0;const t=(this.session.expiresAt.getTime()-Date.now())/1e3;return Math.max(0,t)}setState(t){var r,n;this.state=t,(n=(r=this.config).onStateChange)==null||n.call(r,t)}setError(t){var r,n;this.error=t,this.setState("error"),(n=(r=this.config).onError)==null||n.call(r,t)}handleError(t,r){const n=t instanceof F?t:new F("UNKNOWN_ERROR",t instanceof Error?`${r}: ${t.message}`:r);this.setError(n)}startFrameCapture(){if(!this.camera.stream||!this.encoder)return;const t=this.camera.stream.getVideoTracks()[0];if("MediaStreamTrackProcessor"in window){const r=new MediaStreamTrackProcessor({track:t});this.frameReader=r.readable.getReader(),(async()=>{for(;this.state==="capturing"&&this.frameReader&&this.encoder;){const{value:i,done:o}=await this.frameReader.read();if(o)break;this.encoder.encodeFrame(i)}})().catch(console.error)}}stopFrameCapture(){this.frameReader&&(this.frameReader.cancel(),this.frameReader=null)}async callConvex(t,r){const n=await fetch(`${this.convexUrl}/api/mutation/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({args:r})});if(!n.ok)throw new F("NETWORK_ERROR",`Convex call failed: ${n.statusText}`);return n.json()}}At=new WeakMap,It=new WeakMap,Dt=new WeakMap,Ft=new WeakMap,jt=new WeakMap,zt=new WeakMap;function vl(e){return new ml(e)}function yl(e){const t=Math.floor(e/1e3),r=Math.floor(e%1e3/100);return`${t}.${r}s`}function gl(e){const t=Math.floor(e/60),r=Math.floor(e%60);return`${t}:${r.toString().padStart(2,"0")}`}var wl=X("<div> </div>"),bl=X('<div class="flex items-center gap-2 px-3 py-1 rounded-full bg-red-500/80"><div class="recording-dot"></div> <span class="font-mono"> </span></div>'),_l=X('<div class="nonce-overlay text-4xl font-bold text-white/90 bg-black/40 px-6 py-3 rounded-2xl"> </div> <p class="mt-2 text-sm text-white/60">Show this code in your video</p>',1),Sl=X('<div class="text-white/80">Checking browser compatibility...</div>'),Cl=X('<div class="text-white/80">Please allow camera access</div>'),Tl=X('<div class="text-white/80">Preparing session...</div>'),El=X('<div class="text-white/80">Processing video...</div>'),Ul=X('<div class="progress-bar w-48"><div class="progress-fill"></div></div> <div class="text-sm text-white/60 mt-1"> </div>',1),xl=X('<div class="text-center"><div class="text-white/80 mb-2">Uploading...</div> <!></div>'),kl=X('<div class="text-center"><div class="text-yp-error text-lg mb-2">Error</div> <div class="text-white/70"> </div> <button class="btn-secondary mt-4">Try Again</button></div>'),Pl=X('<div class="text-center max-w-xs"><div class="text-yp-error text-lg mb-2">Browser Not Supported</div> <div class="text-white/70">Please use Safari on iOS or Chrome on Android.</div></div>'),Ol=X(`<button aria-label="Start recording" class="w-20 h-20 rounded-full bg-yp-primary flex items-center justify-center
							   transition-transform active:scale-95 shadow-lg shadow-yp-primary/30"><div class="w-8 h-8 rounded-full bg-white"></div></button>`),Rl=X(`<button aria-label="Stop recording" class="w-20 h-20 rounded-full bg-red-500 flex items-center justify-center
							   transition-transform active:scale-95 shadow-lg shadow-red-500/30"><div class="w-8 h-8 rounded bg-white"></div></button>`),Al=X('<div class="w-20 h-20 rounded-full bg-white/20 flex items-center justify-center"><div class="w-8 h-8 border-2 border-white/40 border-t-white rounded-full animate-spin"></div></div>'),Il=X('<p class="text-center text-white/60 mt-4 text-sm">Tap to start recording. Show the code, then jump!</p>'),Dl=X('<p class="text-center text-white/60 mt-4 text-sm">Tap to stop when done</p>'),Fl=X('<div class="relative min-h-screen bg-black"><video autoplay playsinline="" class="absolute inset-0 w-full h-full object-cover video-preview"></video> <div class="absolute inset-0 flex flex-col"><div class="flex items-center justify-between p-4 bg-gradient-to-b from-black/50 to-transparent"><button aria-label="Go back" class="p-2 text-white/80 hover:text-white"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button> <!> <!></div> <div class="flex-1 flex flex-col items-center justify-center"><!> <!></div> <div class="p-6 bg-gradient-to-t from-black/50 to-transparent"><div class="flex items-center justify-center gap-6"><!></div> <!></div></div></div>',2);function Gl(e,t){Ii(t,!0);let r=ie(null),n=ie(null),i=null,o=ie(120),a=lt(()=>{var h;return((h=b(r))==null?void 0:h.state)??"idle"}),u=lt(()=>{var h;return((h=b(r))==null?void 0:h.session)??null}),d=lt(()=>{var h;return((h=b(r))==null?void 0:h.error)??null}),v=lt(()=>{var h;return((h=b(r))==null?void 0:h.recordingDuration)??0}),S=lt(()=>{var h;return((h=b(r))==null?void 0:h.uploadProgress)??null});Ri(async()=>{oe(r,vl({convexUrl:"https://your-app.convex.cloud",userId:"demo_user"}),!0),!(!await b(r).checkCompatibility()||!await b(r).requestPermissions())&&(b(n)&&b(r).getStream()&&(b(n).srcObject=b(r).getStream()),await b(r).createSession(),i=setInterval(()=>{var w,T;oe(o,Math.max(0,((w=b(r))==null?void 0:w.getSessionTimeRemaining())??0),!0),b(o)<=0&&b(u)&&((T=b(r))==null||T.createSession())},1e3))}),Ai(()=>{var h;i&&clearInterval(i),(h=b(r))==null||h.reset()});async function y(){b(r)&&await b(r).startCapture()}async function V(){if(!b(r))return;const h=await b(r).stopCapture(),p=await b(r).submitJump(h);on(`/result/${p.jumpId}`)}var se=Fl(),M=Q(se);M.muted=!0,Bi(M,h=>oe(n,h),()=>b(n));var z=ue(M,2),P=Q(z),le=Q(P);le.__click=()=>on("/");var J=ue(le,2);{var N=h=>{var p=wl();let w;var T=Q(p);ee(p),ut(E=>{w=Li(p,1,"px-3 py-1 rounded-full bg-black/40 text-sm font-mono",null,w,{"timer-warning":b(o)<30,"timer-critical":b(o)<10}),ft(T,`Session: ${E??""}`)},[()=>gl(b(o))]),D(h,p)};Z(J,h=>{b(u)&&b(a)!=="capturing"&&h(N)})}var te=ue(J,2);{var Se=h=>{var p=bl(),w=ue(Q(p),2),T=Q(w,!0);ee(w),ee(p),ut(E=>ft(T,E),[()=>yl(b(v))]),D(h,p)};Z(te,h=>{b(a)==="capturing"&&h(Se)})}ee(P);var re=ue(P,2),Y=Q(re);{var Oe=h=>{var p=_l(),w=pe(p),T=Q(w,!0);ee(w),Fi(2),ut(()=>ft(T,b(u).nonceDisplay)),D(h,p)};Z(Y,h=>{b(u)&&b(a)!=="capturing"&&h(Oe)})}var ce=ue(Y,2);{var ot=h=>{var p=Sl();D(h,p)},Re=h=>{var p=Ue(),w=pe(p);{var T=R=>{var I=Cl();D(R,I)},E=R=>{var I=Ue(),H=pe(I);{var lr=Pe=>{var Bt=Tl();D(Pe,Bt)},at=Pe=>{var Bt=Ue(),Si=pe(Bt);{var Ci=We=>{var Mt=El();D(We,Mt)},Ti=We=>{var Mt=Ue(),Ei=pe(Mt);{var Ui=qe=>{var Ve=xl(),ur=ue(Q(Ve),2);{var fr=st=>{var Ee=Ul(),me=pe(Ee),Ae=Q(me);ee(me);var Ge=ue(me,2),Ie=Q(Ge);ee(Ge),ut(()=>{Mi(Ae,`width: ${b(S).percentage??""}%`),ft(Ie,`${b(S).percentage??""}%`)}),D(st,Ee)};Z(ur,st=>{b(S)&&st(fr)})}ee(Ve),D(qe,Ve)},xi=qe=>{var Ve=Ue(),ur=pe(Ve);{var fr=Ee=>{var me=kl(),Ae=ue(Q(me),2),Ge=Q(Ae,!0);ee(Ae);var Ie=ue(Ae,2);Ie.__click=()=>{var De;return(De=b(r))==null?void 0:De.reset()},ee(me),ut(()=>{var De;return ft(Ge,(De=b(d))==null?void 0:De.message)}),D(Ee,me)},st=Ee=>{var me=Ue(),Ae=pe(me);{var Ge=Ie=>{var De=Pl();D(Ie,De)};Z(Ae,Ie=>{b(a)==="unsupported"&&Ie(Ge)},!0)}D(Ee,me)};Z(ur,Ee=>{b(a)==="error"?Ee(fr):Ee(st,!1)},!0)}D(qe,Ve)};Z(Ei,qe=>{b(a)==="uploading"?qe(Ui):qe(xi,!1)},!0)}D(We,Mt)};Z(Si,We=>{b(a)==="processing"?We(Ci):We(Ti,!1)},!0)}D(Pe,Bt)};Z(H,Pe=>{b(a)==="preparing_session"?Pe(lr):Pe(at,!1)},!0)}D(R,I)};Z(w,R=>{b(a)==="requesting_permissions"?R(T):R(E,!1)},!0)}D(h,p)};Z(ce,h=>{b(a)==="checking_compatibility"?h(ot):h(Re,!1)})}ee(re);var $e=ue(re,2),he=Q($e),Ce=Q(he);{var Te=h=>{var p=Ol();p.__click=y,D(h,p)},c=h=>{var p=Ue(),w=pe(p);{var T=R=>{var I=Rl();I.__click=V,D(R,I)},E=R=>{var I=Ue(),H=pe(I);{var lr=at=>{var Pe=Al();D(at,Pe)};Z(H,at=>{["checking_compatibility","requesting_permissions","preparing_session","processing","uploading"].includes(b(a))&&at(lr)},!0)}D(R,I)};Z(w,R=>{b(a)==="capturing"?R(T):R(E,!1)},!0)}D(h,p)};Z(Ce,h=>{b(a)==="session_ready"?h(Te):h(c,!1)})}ee(he);var l=ue(he,2);{var f=h=>{var p=Il();D(h,p)},m=h=>{var p=Ue(),w=pe(p);{var T=E=>{var R=Dl();D(E,R)};Z(w,E=>{b(a)==="capturing"&&E(T)},!0)}D(h,p)};Z(l,h=>{b(a)==="session_ready"?h(f):h(m,!1)})}ee($e),ee(z),ee(se),D(e,se),Di()}ji(["click"]);export{Gl as component,Vl as universal};
