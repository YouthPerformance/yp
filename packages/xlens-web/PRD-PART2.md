# Product Requirements Document: xLENS Web SDK (Part 2)

> Continuation of PRD.md - Sections 6-10

---

## 6. User flows

### 6.1 Primary flow: Complete capture journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        COMPLETE CAPTURE USER FLOW                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  START  â”‚â”€â”€â”€â”€â–¶â”‚  Landing    â”‚â”€â”€â”€â”€â–¶â”‚  Permission â”‚â”€â”€â”€â”€â–¶â”‚  Session    â”‚
â”‚         â”‚     â”‚  Page       â”‚     â”‚  Gate       â”‚     â”‚  Ready      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                    â”‚                   â”‚
                      â”‚                    â”‚                   â”‚
                      â–¼                    â–¼                   â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ User taps   â”‚     â”‚ Camera      â”‚     â”‚ Nonce       â”‚
               â”‚ "Start      â”‚     â”‚ permission  â”‚     â”‚ displayed   â”‚
               â”‚ Capture"    â”‚     â”‚ granted     â”‚     â”‚ "A7B3X9"    â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚                   â”‚
                                          â–¼                   â”‚
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
                                   â”‚ Motion      â”‚            â”‚
                                   â”‚ permission  â”‚            â”‚
                                   â”‚ (iOS only)  â”‚            â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
                                                              â”‚
                                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  COMPLETE   â”‚â—€â”€â”€â”€â”€â”‚  Results    â”‚â—€â”€â”€â”€â”€â”‚  Processing â”‚â—€â”€â”€â”€â”€â”‚  Recording  â”‚
â”‚             â”‚     â”‚  Display    â”‚     â”‚  & Upload   â”‚     â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                   â”‚                   â”‚                   â”‚
      â”‚                   â”‚                   â”‚                   â”‚
      â–¼                   â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User sees   â”‚     â”‚ "32.5 in"   â”‚     â”‚ Encoding    â”‚     â”‚ User taps   â”‚
â”‚ options:    â”‚     â”‚ Silver Tier â”‚     â”‚ Hashing     â”‚     â”‚ Record,     â”‚
â”‚ - Share     â”‚     â”‚ 94% conf.   â”‚     â”‚ Uploading   â”‚     â”‚ jumps,      â”‚
â”‚ - Jump Againâ”‚     â”‚             â”‚     â”‚ Submitting  â”‚     â”‚ taps Stop   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Detailed flow: Permission gate

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PERMISSION GATE FLOW                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   Entry     â”‚
                              â”‚   Point     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ Check       â”‚
                              â”‚ Browser     â”‚
                              â”‚ Compat      â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚           â”‚           â”‚
                         â–¼           â–¼           â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ WebCodecsâ”‚ â”‚ MediaRec â”‚ â”‚ No       â”‚
                  â”‚ Availableâ”‚ â”‚ Fallback â”‚ â”‚ Support  â”‚
                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                       â”‚            â”‚            â”‚
                       â”‚            â”‚            â–¼
                       â”‚            â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚            â”‚      â”‚ Show     â”‚
                       â”‚            â”‚      â”‚ "Update  â”‚
                       â”‚            â”‚      â”‚ Browser" â”‚
                       â”‚            â”‚      â”‚ Message  â”‚
                       â”‚            â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚            â”‚
                       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ Request     â”‚
                      â”‚ Camera      â”‚
                      â”‚ Permission  â”‚
                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              â”‚              â”‚
              â–¼              â–¼              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Granted  â”‚   â”‚ Denied   â”‚   â”‚ Dismissedâ”‚
       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
            â”‚              â”‚              â”‚
            â”‚              â–¼              â–¼
            â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚        â”‚ Show "Camera Required"   â”‚
            â”‚        â”‚ with settings link       â”‚
            â”‚        â”‚ [Open Settings] [Retry]  â”‚
            â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Is iOS?     â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
            â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
     â”‚             â”‚
     â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ No      â”‚  â”‚ Yes         â”‚
â”‚ (Skip)  â”‚  â”‚ Request     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚ Motion      â”‚
     â”‚       â”‚ Permission  â”‚
     â”‚       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚
     â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
     â”‚       â”‚      â”‚      â”‚
     â”‚       â–¼      â–¼      â–¼
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”
     â”‚  â”‚Grantedâ”‚â”‚Denied â”‚â”‚Skip   â”‚
     â”‚  â”‚Full   â”‚â”‚Bronze â”‚â”‚Bronze â”‚
     â”‚  â”‚Access â”‚â”‚Only   â”‚â”‚Only   â”‚
     â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”˜â””â”€â”€â”€â”¬â”€â”€â”€â”˜â””â”€â”€â”€â”¬â”€â”€â”€â”˜
     â”‚      â”‚        â”‚        â”‚
     â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ Proceed to  â”‚
           â”‚ Session     â”‚
           â”‚ Ready       â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 Detailed flow: Recording capture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         RECORDING CAPTURE FLOW                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ Session     â”‚
                              â”‚ Ready       â”‚
                              â”‚ (Nonce      â”‚
                              â”‚ Displayed)  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚ User taps "Record"
                                     â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ Initialize  â”‚
                              â”‚ - VideoEncoder
                              â”‚ - Frame buffer
                              â”‚ - Sensor listener
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         RECORDING LOOP         â”‚
                    â”‚                                â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                    â”‚  â”‚ Capture  â”‚  â”‚ Capture  â”‚   â”‚
                    â”‚  â”‚ Video    â”‚  â”‚ Sensor   â”‚   â”‚
                    â”‚  â”‚ Frames   â”‚  â”‚ Data     â”‚   â”‚
                    â”‚  â”‚ (60fps)  â”‚  â”‚ (60Hz)   â”‚   â”‚
                    â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
                    â”‚       â”‚             â”‚         â”‚
                    â”‚       â–¼             â–¼         â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                    â”‚  â”‚ Encode   â”‚  â”‚ Buffer   â”‚   â”‚
                    â”‚  â”‚ Frame    â”‚  â”‚ Sample   â”‚   â”‚
                    â”‚  â”‚ (WebCodecs)â”‚ â”‚(Array)  â”‚   â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                    â”‚                                â”‚
                    â”‚  Duration: 0:00 â†’ 0:15 max    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚              â”‚              â”‚
                      â–¼              â–¼              â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ User     â”‚  â”‚ Auto-    â”‚   â”‚ Min 2s   â”‚
               â”‚ taps     â”‚  â”‚ stop at  â”‚   â”‚ check    â”‚
               â”‚ "Stop"   â”‚  â”‚ 15s      â”‚   â”‚          â”‚
               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                    â”‚             â”‚              â”‚
                    â”‚             â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚             â”‚      â”‚ If <2s
                    â”‚             â”‚      â–¼
                    â”‚             â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚             â”‚ â”‚ Show     â”‚
                    â”‚             â”‚ â”‚ "Record  â”‚
                    â”‚             â”‚ â”‚ longer"  â”‚
                    â”‚             â”‚ â”‚ message  â”‚
                    â”‚             â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚             â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Finalize    â”‚
                    â”‚ Recording   â”‚
                    â”‚ - Flush encoder
                    â”‚ - Stop sensors
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Proceed to  â”‚
                    â”‚ Processing  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.4 Detailed flow: Processing and upload

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       PROCESSING & UPLOAD FLOW                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ Recording   â”‚
               â”‚ Complete    â”‚
               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ STEP 1:     â”‚
               â”‚ MP4 Muxing  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ Progress:   â”‚                          â”‚
               â”‚ [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] â”‚                          â”‚
               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                          â”‚
                      â”‚                                 â”‚
                      â–¼                                 â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
               â”‚ STEP 2:     â”‚                          â”‚
               â”‚ Hashing     â”‚                          â”‚
               â”‚ - Video SHA256                         â”‚ PARALLEL
               â”‚ - Sensor SHA256                        â”‚
               â”‚ - Metadata SHA256                      â”‚
               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                          â”‚
                      â”‚                                 â”‚
                      â–¼                                 â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
               â”‚ STEP 3:     â”‚                          â”‚
               â”‚ Signing     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ - Create proof payload
               â”‚ - Sign with device key
               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ STEP 4:     â”‚
               â”‚ Get Upload  â”‚
               â”‚ URL         â”‚
               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ STEP 5: TUS Upload     â”‚
         â”‚                        â”‚
         â”‚ Video:  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 80%
         â”‚ Sensor: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%
         â”‚                        â”‚
         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
         â”‚ â”‚ Network Error?     â”‚ â”‚
         â”‚ â”‚ â†’ Retry (1/3)      â”‚ â”‚
         â”‚ â”‚ â†’ Show "Retrying"  â”‚ â”‚
         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ STEP 6:     â”‚
               â”‚ Submit to   â”‚
               â”‚ Convex      â”‚
               â”‚ - Video ID  â”‚
               â”‚ - Sensor ID â”‚
               â”‚ - Proof     â”‚
               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                     â”‚
           â–¼                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Success     â”‚       â”‚ Error       â”‚
    â”‚ Jump ID:    â”‚       â”‚ - Show msg  â”‚
    â”‚ jump_xxx    â”‚       â”‚ - Retry btn â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Poll for    â”‚
    â”‚ Results     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.5 Detailed flow: Error recovery

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ERROR RECOVERY FLOWS                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FLOW A: Camera Permission Denied
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ getUserMediaâ”‚
    â”‚ throws      â”‚
    â”‚ NotAllowed  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                         â”‚
    â”‚   ğŸš« Camera Access Required             â”‚
    â”‚                                         â”‚
    â”‚   xLENS needs camera access to          â”‚
    â”‚   record your jump.                     â”‚
    â”‚                                         â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚   â”‚  Open Settings  â”‚   â”‚  Retry    â”‚   â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                         â”‚
    â”‚   On iOS: Settings > Safari > Camera    â”‚
    â”‚   On Android: Site Settings > Camera    â”‚
    â”‚                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                    â”‚
           â–¼                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Open native â”‚      â”‚ Re-request  â”‚
    â”‚ settings    â”‚      â”‚ permission  â”‚
    â”‚ (if possible)â”‚     â”‚             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FLOW B: Network Error During Upload
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ TUS upload  â”‚
    â”‚ fails       â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Retry 1/3   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Success?    â”‚
    â”‚ Wait 2s     â”‚          â”‚             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ YES                 â”‚ NO
                         â–¼                     â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Continue    â”‚       â”‚ Retry 2/3   â”‚
                  â”‚ upload      â”‚       â”‚ Wait 4s     â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ Success?    â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ YES                 â”‚ NO
                                    â–¼                     â–¼
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚ Continue    â”‚       â”‚ Retry 3/3   â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ Wait 8s     â”‚
                                                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                          â”‚
                                                          â–¼
                                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                   â”‚ Success?    â”‚
                                                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                          â”‚
                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                               â”‚ YES                 â”‚ NO
                                               â–¼                     â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ Continue    â”‚  â”‚ Upload Failed     â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                   â”‚
                                                         â”‚ [Save Locally]    â”‚
                                                         â”‚ [Try Again]       â”‚
                                                         â”‚ [Cancel]          â”‚
                                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FLOW C: Session Expired During Capture
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Session     â”‚
    â”‚ timer hits  â”‚
    â”‚ 0:00        â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Recording   â”‚â”€YESâ”€â–¶â”‚ Stop        â”‚
    â”‚ in progress?â”‚      â”‚ recording   â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â”‚ Discard dataâ”‚
           â”‚ NO          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚                    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                         â”‚
    â”‚   â° Session Expired                    â”‚
    â”‚                                         â”‚
    â”‚   Your capture session has timed out.   â”‚
    â”‚   Please start a new session.           â”‚
    â”‚                                         â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚   â”‚      Start New Session          â”‚   â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.6 State transition diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STATE MACHINE DIAGRAM                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                                          â”‚
                         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
                         â”‚              â”‚  IDLE   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                         â”‚              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                 â”‚
                         â”‚                   â”‚                      â”‚
                         â”‚                   â”‚ checkBrowser()       â”‚
                         â”‚                   â–¼                      â”‚
                         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
                         â”‚         â”‚   CHECKING      â”‚              â”‚
                         â”‚         â”‚   COMPATIBILITY â”‚              â”‚
                         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                         â”‚                  â”‚                       â”‚
                         â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
                         â”‚       â”‚ compatible          â”‚ incompatible
                         â”‚       â–¼                     â–¼            â”‚
                         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
                         â”‚ â”‚ REQUESTING_   â”‚   â”‚ UNSUPPORTED â”‚â”€â”€â”€â”€â”€â”€â”¤
                         â”‚ â”‚ PERMISSIONS   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                         â”‚         â”‚                                â”‚
                         â”‚         â”‚ permissions granted            â”‚
                         â”‚         â–¼                                â”‚
                         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
       cancel() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â–¶â”‚ PREPARING_    â”‚                        â”‚
                         â”‚ â”‚ SESSION       â”‚                        â”‚
                         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                         â”‚         â”‚                                â”‚
                         â”‚         â”‚ session created                â”‚
                         â”‚         â–¼                                â”‚
                         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
       cancel() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â–¶â”‚ SESSION_      â”‚                        â”‚
       timeout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â–¶â”‚ READY         â”‚                        â”‚
                         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                         â”‚         â”‚                                â”‚
                         â”‚         â”‚ startCapture()                 â”‚
                         â”‚         â–¼                                â”‚
                         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
       cancel() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â–¶â”‚ CAPTURING     â”‚                        â”‚
       timeout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â–¶â”‚               â”‚                        â”‚
                         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                         â”‚         â”‚                                â”‚
                         â”‚         â”‚ stopCapture()                  â”‚
                         â”‚         â–¼                                â”‚
                         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
       cancel() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â–¶â”‚ PROCESSING    â”‚                        â”‚
                         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                         â”‚         â”‚                                â”‚
                         â”‚         â”‚ processing complete            â”‚
                         â”‚         â–¼                                â”‚
                         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
       cancel() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â–¶â”‚ UPLOADING     â”‚                        â”‚
       retry â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â–¶â”‚               â”‚                        â”‚
                         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                         â”‚         â”‚                                â”‚
                         â”‚         â”‚ upload complete                â”‚
                         â”‚         â–¼                                â”‚
                         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
                         â”‚ â”‚ SUBMITTED     â”‚                        â”‚
                         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                         â”‚         â”‚                                â”‚
                         â”‚         â”‚ results received               â”‚
                         â”‚         â–¼                                â”‚
                         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
       reset() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â–¶â”‚ COMPLETE      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       jumpAgain() â”€â”€â”€â”€â”€â”€â”¼â–¶â”‚               â”‚
                         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       error (any) â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ ERROR         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
                                           â”‚                        â”‚
                                           â”‚ reset()                â”‚
                                           â–¼                        â”‚
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
                                   â”‚ IDLE          â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Functional requirements

### 7.1 System inputs

| Input ID | Input Name | Source | Format | Validation |
|----------|-----------|--------|--------|------------|
| IN-001 | Camera stream | getUserMedia | MediaStream | Resolution â‰¥720p, FPS â‰¥30 |
| IN-002 | Motion events | DeviceMotion | Event stream | 60Hz sampling |
| IN-003 | User ID | URL param / generated | String | UUID format |
| IN-004 | Session nonce | Convex backend | String | 6 alphanumeric chars |
| IN-005 | User gesture | Touch/click | Event | Required for iOS permissions |
| IN-006 | GPS location | Geolocation API | Coords | Optional, coarse accuracy OK |

### 7.2 System outputs

| Output ID | Output Name | Destination | Format | SLA |
|-----------|-------------|-------------|--------|-----|
| OUT-001 | Encoded video | Cloudflare Stream | MP4 (H.264) | <5s encoding |
| OUT-002 | Sensor data | Cloudflare Stream | JSON (gzip) | <1s processing |
| OUT-003 | Proof payload | Convex backend | JSON | <1s generation |
| OUT-004 | Jump result | UI display | Structured data | <60s verification |
| OUT-005 | Share image | User device | PNG | <2s generation |

### 7.3 Processing requirements

| Process ID | Process Name | Input(s) | Output(s) | Performance |
|------------|--------------|----------|-----------|-------------|
| PROC-001 | Frame encoding | VideoFrame | EncodedVideoChunk | Real-time (60fps) |
| PROC-002 | MP4 muxing | Encoded chunks | MP4 file | <3s for 15s video |
| PROC-003 | SHA-256 hashing | Raw bytes | Hash string | <1s for 20MB |
| PROC-004 | ECDSA signing | Payload JSON | Signature | <100ms |
| PROC-005 | TUS chunking | File blob | 5MB chunks | Streaming |

### 7.4 Functional requirements matrix

| Req ID | Requirement | User Story | Priority | Acceptance Criteria |
|--------|-------------|-----------|----------|---------------------|
| FR-001 | Camera access | US-001 | P0 | AC-001.1 through AC-001.6 |
| FR-002 | Motion access | US-002 | P0 | AC-002.1 through AC-002.5 |
| FR-003 | Browser detection | US-003 | P0 | AC-003.1 through AC-003.5 |
| FR-004 | Session creation | US-005 | P0 | AC-005.1 through AC-005.6 |
| FR-005 | Nonce display | US-005 | P0 | Visible, readable, timed |
| FR-006 | Video recording | US-009, US-010 | P0 | 2-15s duration |
| FR-007 | WebCodecs encoding | US-011 | P0 | H.264, 4Mbps, 60fps |
| FR-008 | Sensor capture | US-014, US-015 | P0 | 60Hz, synced timestamps |
| FR-009 | Hash generation | US-017, US-018 | P0 | SHA-256, deterministic |
| FR-010 | Key management | US-019 | P0 | ECDSA P-256, persistent |
| FR-011 | Signature creation | US-020 | P0 | ES256, base64 encoded |
| FR-012 | TUS upload | US-022 | P0 | Resumable, 3 retries |
| FR-013 | Jump submission | US-024 | P0 | All data included |
| FR-014 | Result polling | US-026 | P0 | 2s interval, 60s timeout |
| FR-015 | Result display | US-027 | P0 | Height, tier, confidence |
| FR-016 | Error recovery | US-030, US-031, US-032 | P0 | User-friendly messages |
| FR-017 | i18n support | US-033, US-034 | P1 | EN, ZH-CN |
| FR-018 | Social sharing | US-035 | P1 | Image + Web Share API |

---

## 8. Non-functional requirements

### 8.1 Performance requirements

| NFR ID | Requirement | Target | Measurement |
|--------|-------------|--------|-------------|
| NFR-P01 | First Contentful Paint | <1.5s | Lighthouse |
| NFR-P02 | Time to Interactive | <3.0s | Lighthouse |
| NFR-P03 | Bundle size (JS, gzip) | <50KB | Build output |
| NFR-P04 | Camera preview latency | <100ms | Manual test |
| NFR-P05 | Encoding throughput | â‰¥60fps | Performance API |
| NFR-P06 | Hash computation | <1s for 20MB | Performance API |
| NFR-P07 | Memory usage (capture) | <150MB | DevTools |
| NFR-P08 | Upload speed | >2MB/s on 4G | Network test |
| NFR-P09 | Battery drain (full flow) | <5% | Device test |

### 8.2 Reliability requirements

| NFR ID | Requirement | Target | Measurement |
|--------|-------------|--------|-------------|
| NFR-R01 | Capture success rate | >85% | Analytics |
| NFR-R02 | Upload success rate | >95% | Server logs |
| NFR-R03 | Uptime | 99.9% | Monitoring |
| NFR-R04 | Error recovery rate | >90% | Analytics |
| NFR-R05 | Data integrity | 100% | Hash verification |

### 8.3 Scalability requirements

| NFR ID | Requirement | Target | Measurement |
|--------|-------------|--------|-------------|
| NFR-S01 | Concurrent users | 10,000+ | Load test |
| NFR-S02 | Daily uploads | 100,000+ | Cloudflare metrics |
| NFR-S03 | Global latency | <100ms to edge | Cloudflare analytics |

### 8.4 Security requirements

| NFR ID | Requirement | Implementation |
|--------|-------------|----------------|
| NFR-SEC01 | HTTPS only | Cloudflare Always HTTPS |
| NFR-SEC02 | No secrets in client | Environment variables server-side |
| NFR-SEC03 | CSP headers | Strict Content-Security-Policy |
| NFR-SEC04 | Key encryption | IndexedDB with device fingerprint |
| NFR-SEC05 | Session validation | Server-side nonce check |
| NFR-SEC06 | Replay prevention | One-time session use |

### 8.5 Accessibility requirements

| NFR ID | Requirement | WCAG Level |
|--------|-------------|------------|
| NFR-A01 | Color contrast | AA (4.5:1) |
| NFR-A02 | Touch targets | 44x44px minimum |
| NFR-A03 | Screen reader support | Announce states |
| NFR-A04 | Reduced motion | Respect prefers-reduced-motion |
| NFR-A05 | Focus indicators | Visible focus rings |

### 8.6 Browser support matrix

| Browser | Version | Support Level | Notes |
|---------|---------|---------------|-------|
| Chrome (Android) | 94+ | Full | Primary target |
| Safari (iOS) | 15.4+ | Full | Primary target |
| Chrome (Desktop) | 94+ | Full | Secondary |
| Edge | 94+ | Full | Secondary |
| Firefox | 100+ | Partial | MediaRecorder fallback |
| Samsung Internet | 16+ | Full | Secondary |
| WeChat Browser | Latest | Full | China market |
| UC Browser | Latest | Partial | China market |

---

## 9. Technical architecture

### 9.1 Technology stack

| Layer | Technology | Version | Rationale |
|-------|------------|---------|-----------|
| Framework | SvelteKit | 2.x | Smallest bundle, compiler-based |
| UI Library | Svelte | 5.x | Runes for reactivity |
| Styling | Tailwind CSS | 3.x | Utility-first, tree-shaking |
| Video Encoding | WebCodecs API | Native | Hardware acceleration |
| Video Fallback | MediaRecorder | Native | Browser compatibility |
| Muxing | mp4-muxer | Latest | MP4 container creation |
| Crypto | Web Crypto API | Native | No dependencies |
| Upload | tus-js-client | 4.x | Resumable uploads |
| State | Svelte 5 Runes | Native | Built-in reactivity |
| i18n | svelte-i18n | 4.x | Localization |
| Testing | Vitest + Playwright | Latest | Unit + E2E |

### 9.2 System architecture diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CLIENT (Browser)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        SvelteKit Application                         â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚   Routes     â”‚  â”‚  Components  â”‚  â”‚    Stores    â”‚              â”‚   â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚   ($state)   â”‚              â”‚   â”‚
â”‚  â”‚  â”‚ /            â”‚  â”‚ CameraPreviewâ”‚  â”‚              â”‚              â”‚   â”‚
â”‚  â”‚  â”‚ /capture     â”‚  â”‚ NonceOverlay â”‚  â”‚ captureStore â”‚              â”‚   â”‚
â”‚  â”‚  â”‚ /result/[id] â”‚  â”‚ CaptureButtonâ”‚  â”‚ sessionStore â”‚              â”‚   â”‚
â”‚  â”‚  â”‚              â”‚  â”‚ UploadProgressâ”‚ â”‚ resultStore  â”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚                         Core Library                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   capture/  â”‚  â”‚   crypto/   â”‚  â”‚   upload/   â”‚            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚CameraManagerâ”‚  â”‚ KeyStorage  â”‚  â”‚ TusUploader â”‚            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚WebCodecs    â”‚  â”‚ ProofGen    â”‚  â”‚ CloudflareS â”‚            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚MotionCaptureâ”‚  â”‚ WebCrypto   â”‚  â”‚             â”‚            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚Mp4Muxer     â”‚  â”‚             â”‚  â”‚             â”‚            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   client/   â”‚  â”‚   utils/    â”‚  â”‚   i18n/     â”‚            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚XLensClient  â”‚  â”‚ browser.ts  â”‚  â”‚ en.json     â”‚            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ types.ts    â”‚  â”‚permissions.tsâ”‚ â”‚ zh-CN.json  â”‚            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ errors.ts   â”‚  â”‚             â”‚  â”‚             â”‚            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        Browser APIs                                  â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  getUserMedia  â”‚  WebCodecs  â”‚  DeviceMotion  â”‚  Web Crypto  â”‚  IDB â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ HTTPS
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CLOUDFLARE EDGE                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Cloudflare      â”‚  â”‚ Cloudflare      â”‚  â”‚ Cloudflare      â”‚            â”‚
â”‚  â”‚ Pages           â”‚  â”‚ Stream          â”‚  â”‚ Workers AI      â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚ (future)        â”‚            â”‚
â”‚  â”‚ - Static assets â”‚  â”‚ - Video storage â”‚  â”‚                 â”‚            â”‚
â”‚  â”‚ - SSR           â”‚  â”‚ - TUS endpoint  â”‚  â”‚ - Quick verify  â”‚            â”‚
â”‚  â”‚ - Edge functionsâ”‚  â”‚ - Transcoding   â”‚  â”‚ - Pose detectionâ”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ HTTPS
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CONVEX BACKEND                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         Convex Functions                             â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ sessions    â”‚  â”‚ jumps       â”‚  â”‚ uploads     â”‚  â”‚ deviceKeys  â”‚â”‚   â”‚
â”‚  â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚â”‚   â”‚
â”‚  â”‚  â”‚ :create     â”‚  â”‚ :submit     â”‚  â”‚ :createUrl  â”‚  â”‚ :register   â”‚â”‚   â”‚
â”‚  â”‚  â”‚ :validate   â”‚  â”‚ :get        â”‚  â”‚ :confirm    â”‚  â”‚ :verify     â”‚â”‚   â”‚
â”‚  â”‚  â”‚ :expire     â”‚  â”‚ :list       â”‚  â”‚             â”‚  â”‚             â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         Convex Database                              â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  sessions â”‚ jumps â”‚ jumpUsers â”‚ deviceKeys â”‚ vpcs â”‚ uploads        â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.3 Package structure

```
packages/xlens-web/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ capture/
â”‚   â”‚   â”‚   â”œâ”€â”€ CameraManager.svelte.ts      # Svelte 5 runes, camera control
â”‚   â”‚   â”‚   â”œâ”€â”€ WebCodecsEncoder.ts          # VideoEncoder wrapper
â”‚   â”‚   â”‚   â”œâ”€â”€ MediaRecorderFallback.ts     # Fallback for old browsers
â”‚   â”‚   â”‚   â”œâ”€â”€ MotionCapture.ts             # DeviceMotion wrapper
â”‚   â”‚   â”‚   â”œâ”€â”€ Mp4Muxer.ts                  # mp4-muxer integration
â”‚   â”‚   â”‚   â””â”€â”€ index.ts                     # Barrel export
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ crypto/
â”‚   â”‚   â”‚   â”œâ”€â”€ WebCryptoSigner.ts           # ECDSA key management
â”‚   â”‚   â”‚   â”œâ”€â”€ ProofGenerator.ts            # Hash + sign payloads
â”‚   â”‚   â”‚   â”œâ”€â”€ KeyStorage.ts                # IndexedDB persistence
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ upload/
â”‚   â”‚   â”‚   â”œâ”€â”€ TusUploader.ts               # tus-js-client wrapper
â”‚   â”‚   â”‚   â”œâ”€â”€ CloudflareStream.ts          # Stream-specific logic
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ client/
â”‚   â”‚   â”‚   â”œâ”€â”€ XLensWebClient.svelte.ts     # Main SDK with $state
â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts                     # TypeScript interfaces
â”‚   â”‚   â”‚   â”œâ”€â”€ errors.ts                    # Error definitions
â”‚   â”‚   â”‚   â”œâ”€â”€ constants.ts                 # Configuration constants
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”‚   â”œâ”€â”€ captureStore.svelte.ts       # Capture state
â”‚   â”‚   â”‚   â”œâ”€â”€ sessionStore.svelte.ts       # Session state
â”‚   â”‚   â”‚   â”œâ”€â”€ resultStore.svelte.ts        # Result state
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ browser.ts                   # Feature detection
â”‚   â”‚   â”‚   â”œâ”€â”€ permissions.ts               # Permission helpers
â”‚   â”‚   â”‚   â”œâ”€â”€ format.ts                    # Number/date formatting
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ i18n/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts                     # i18n setup
â”‚   â”‚   â”‚   â”œâ”€â”€ en.json                      # English translations
â”‚   â”‚   â”‚   â””â”€â”€ zh-CN.json                   # Chinese translations
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ convex/
â”‚   â”‚       â”œâ”€â”€ client.ts                    # Convex client setup
â”‚   â”‚       â””â”€â”€ api.ts                       # Generated types
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ +layout.svelte                   # App shell, i18n provider
â”‚   â”‚   â”œâ”€â”€ +layout.ts                       # Load i18n, check browser
â”‚   â”‚   â”œâ”€â”€ +page.svelte                     # Landing page
â”‚   â”‚   â”œâ”€â”€ +error.svelte                    # Error page
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ capture/
â”‚   â”‚   â”‚   â”œâ”€â”€ +page.svelte                 # Main capture flow
â”‚   â”‚   â”‚   â”œâ”€â”€ +page.ts                     # Load session
â”‚   â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚   â”‚       â”œâ”€â”€ PermissionGate.svelte
â”‚   â”‚   â”‚       â”œâ”€â”€ CaptureView.svelte
â”‚   â”‚   â”‚       â”œâ”€â”€ ProcessingView.svelte
â”‚   â”‚   â”‚       â””â”€â”€ UploadView.svelte
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ result/
â”‚   â”‚   â”‚   â””â”€â”€ [jumpId]/
â”‚   â”‚   â”‚       â”œâ”€â”€ +page.svelte             # Results display
â”‚   â”‚   â”‚       â””â”€â”€ +page.ts                 # Load jump data
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ api/
â”‚   â”‚       â”œâ”€â”€ upload-url/
â”‚   â”‚       â”‚   â””â”€â”€ +server.ts               # Get Cloudflare upload URL
â”‚   â”‚       â””â”€â”€ health/
â”‚   â”‚           â””â”€â”€ +server.ts               # Health check endpoint
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.svelte
â”‚   â”‚   â”‚   â”œâ”€â”€ Card.svelte
â”‚   â”‚   â”‚   â”œâ”€â”€ Progress.svelte
â”‚   â”‚   â”‚   â”œâ”€â”€ Badge.svelte
â”‚   â”‚   â”‚   â””â”€â”€ Spinner.svelte
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ capture/
â”‚   â”‚   â”‚   â”œâ”€â”€ CameraPreview.svelte         # Video preview
â”‚   â”‚   â”‚   â”œâ”€â”€ NonceOverlay.svelte          # Nonce display
â”‚   â”‚   â”‚   â”œâ”€â”€ CaptureButton.svelte         # Record/stop
â”‚   â”‚   â”‚   â”œâ”€â”€ Timer.svelte                 # Recording timer
â”‚   â”‚   â”‚   â””â”€â”€ SessionTimer.svelte          # Session countdown
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ results/
â”‚   â”‚   â”‚   â”œâ”€â”€ JumpResult.svelte            # Main result card
â”‚   â”‚   â”‚   â”œâ”€â”€ TierBadge.svelte             # Bronze/Silver badge
â”‚   â”‚   â”‚   â””â”€â”€ ShareButton.svelte           # Share functionality
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ common/
â”‚   â”‚       â”œâ”€â”€ ErrorMessage.svelte
â”‚   â”‚       â”œâ”€â”€ LanguageSwitch.svelte
â”‚   â”‚       â””â”€â”€ LoadingScreen.svelte
â”‚   â”‚
â”‚   â”œâ”€â”€ app.html                             # HTML template
â”‚   â”œâ”€â”€ app.css                              # Global styles + Tailwind
â”‚   â””â”€â”€ hooks.server.ts                      # Server hooks (CSP, etc.)
â”‚
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ manifest.json                        # PWA manifest
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â”œâ”€â”€ icons/
â”‚   â”‚   â”œâ”€â”€ icon-192.png
â”‚   â”‚   â””â”€â”€ icon-512.png
â”‚   â””â”€â”€ og-image.png                         # Social sharing image
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”œâ”€â”€ capture/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WebCodecsEncoder.test.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ MotionCapture.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ crypto/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProofGenerator.test.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ KeyStorage.test.ts
â”‚   â”‚   â”‚   â””â”€â”€ upload/
â”‚   â”‚   â”‚       â””â”€â”€ TusUploader.test.ts
â”‚   â”‚   â””â”€â”€ setup.ts                         # Test setup
â”‚   â”‚
â”‚   â””â”€â”€ e2e/
â”‚       â”œâ”€â”€ capture-flow.spec.ts             # Full capture E2E
â”‚       â”œâ”€â”€ permission-flow.spec.ts          # Permission handling
â”‚       â””â”€â”€ error-recovery.spec.ts           # Error scenarios
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ svelte.config.js
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ playwright.config.ts
â”œâ”€â”€ vitest.config.ts
â””â”€â”€ README.md
```

---

## 10. API specifications

### 10.1 Convex API contracts

#### 10.1.1 Session management

##### `jump/sessions:create`

**Purpose:** Create a new capture session with nonce

**Request:**
```typescript
interface CreateSessionRequest {
  userId: string;           // User identifier
  platform: "web";          // Always "web" for this SDK
  deviceFingerprint?: string; // Browser fingerprint
}
```

**Response:**
```typescript
interface CreateSessionResponse {
  sessionId: string;        // Unique session ID
  nonce: string;            // Cryptographic nonce (32 bytes, base64)
  nonceDisplay: string;     // Human-readable (e.g., "A7B3X9")
  expiresAt: number;        // Unix timestamp (ms)
  expiresInMs: number;      // TTL in milliseconds (120000)
}
```

**Errors:**
| Error Code | Description |
|------------|-------------|
| USER_NOT_FOUND | User ID does not exist |
| RATE_LIMITED | Too many sessions created |

##### `jump/sessions:validate`

**Purpose:** Validate session before accepting submission

**Request:**
```typescript
interface ValidateSessionRequest {
  sessionId: string;
  nonce: string;
}
```

**Response:**
```typescript
interface ValidateSessionResponse {
  valid: boolean;
  reason?: string;  // If invalid: "expired" | "used" | "invalid_nonce"
}
```

#### 10.1.2 Jump submission

##### `jump/jumps:submit`

**Purpose:** Submit captured jump for verification

**Request:**
```typescript
interface SubmitJumpRequest {
  userId: string;
  sessionId: string;
  videoStorageId: string;
  sensorStorageId: string;
  proofPayload: WebProofPayload;
  platform: "web";
  gps?: {
    city: string;
    state?: string;
    country: string;
  };
}

interface WebProofPayload {
  sessionId: string;
  nonce: string;
  capture: {
    testType: "VERT_JUMP";
    startedAtMs: number;
    endedAtMs: number;
    fps: number;
    device: {
      platform: "web";
      userAgent: string;
      screenWidth: number;
      screenHeight: number;
    };
  };
  hashes: {
    videoSha256: string;
    sensorSha256: string;
    metadataSha256: string;
  };
  signature: {
    alg: "ES256";
    keyId: string;
    sig: string;
  };
  sensorsAvailable: boolean;
}
```

**Response:**
```typescript
interface SubmitJumpResponse {
  jumpId: string;
  status: "processing";
}
```

**Errors:**
| Error Code | Description |
|------------|-------------|
| SESSION_INVALID | Session expired or already used |
| SIGNATURE_INVALID | Proof signature verification failed |
| STORAGE_NOT_FOUND | Video or sensor file not uploaded |

##### `jump/jumps:get`

**Purpose:** Get jump details and results

**Request:**
```typescript
interface GetJumpRequest {
  jumpId: string;
}
```

**Response:**
```typescript
interface GetJumpResponse {
  _id: string;
  userId: string;
  sessionId: string;
  status: "processing" | "complete" | "flagged" | "rejected";
  heightInches?: number;
  heightCm?: number;
  flightTimeMs?: number;
  confidence?: number;
  verificationTier?: "measured" | "bronze" | "silver";
  rejectionReason?: string;
  createdAt: number;
  completedAt?: number;
}
```

#### 10.1.3 Upload management

##### `jump/uploads:createDirectUrl`

**Purpose:** Get Cloudflare Stream direct upload URL

**Request:**
```typescript
interface CreateUploadUrlRequest {
  userId: string;
  sessionId: string;
  contentType: "video/mp4" | "application/json";
  fileSizeBytes: number;
}
```

**Response:**
```typescript
interface CreateUploadUrlResponse {
  uploadUrl: string;        // TUS endpoint URL
  storageId: string;        // Pre-generated storage ID
  expiresAt: number;        // URL expiration (30 min)
}
```

#### 10.1.4 Device key management

##### `jump/deviceKeys:registerWeb`

**Purpose:** Register a new web device signing key

**Request:**
```typescript
interface RegisterKeyRequest {
  userId: string;
  publicKey: string;        // Base64 SPKI format
  deviceFingerprint: string;
}
```

**Response:**
```typescript
interface RegisterKeyResponse {
  keyId: string;
  hardwareLevel: "software";  // Always software for web
  registeredAt: number;
}
```

##### `jump/deviceKeys:verify`

**Purpose:** Verify a signature against registered key

**Request:**
```typescript
interface VerifyKeyRequest {
  keyId: string;
  data: string;             // Base64 encoded data
  signature: string;        // Base64 encoded signature
}
```

**Response:**
```typescript
interface VerifyKeyResponse {
  valid: boolean;
}
```

### 10.2 Cloudflare Stream API

#### 10.2.1 TUS upload protocol

**Endpoint:** `https://upload.cloudflarestream.com/tus/{upload-id}`

**Headers:**
```
Tus-Resumable: 1.0.0
Upload-Length: {file-size}
Upload-Metadata: filename {base64-filename}
Content-Type: application/offset+octet-stream
```

**Flow:**
1. POST to create upload â†’ returns upload URL
2. PATCH with byte chunks (5MB each)
3. HEAD to check progress
4. Upload complete when offset equals length

### 10.3 Browser API usage

#### 10.3.1 getUserMedia constraints

```typescript
const constraints: MediaStreamConstraints = {
  video: {
    facingMode: { ideal: "environment" },
    width: { ideal: 1920, min: 1280 },
    height: { ideal: 1080, min: 720 },
    frameRate: { ideal: 60, min: 30 }
  },
  audio: false
};
```

#### 10.3.2 WebCodecs VideoEncoder config

```typescript
const config: VideoEncoderConfig = {
  codec: "avc1.42E01E",      // H.264 Baseline Level 3.0
  width: 1280,
  height: 720,
  bitrate: 4_000_000,        // 4 Mbps
  framerate: 60,
  latencyMode: "quality",
  avc: {
    format: "annexb"
  }
};
```

#### 10.3.3 Web Crypto key generation

```typescript
const keyPair = await crypto.subtle.generateKey(
  {
    name: "ECDSA",
    namedCurve: "P-256"
  },
  true,  // extractable
  ["sign", "verify"]
);
```

---

*Continued in PRD-PART3.md...*
