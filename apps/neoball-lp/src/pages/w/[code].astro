---
import Layout from "../../layouts/Layout.astro";
import WaitlistApp from "../../components/WaitlistApp.tsx";

// Disable prerendering for dynamic referral codes
export const prerender = false;

const { code } = Astro.params;
const convexUrl = import.meta.env.PUBLIC_CONVEX_URL || "";

// Validate code format (8 alphanumeric characters)
const isValidCode = code && /^[A-Z0-9]{8}$/i.test(code);
---

<Layout title="NeoBall - Join the Alpha 8 Draft">
  <!-- Referral Landing - Auto-open modal with referrer code -->
  <section class="relative min-h-screen flex items-center justify-center overflow-hidden">
    <!-- Background -->
    <div class="absolute inset-0 bg-gradient-to-b from-wolf-black via-wolf-black/90 to-wolf-black">
      <div class="absolute inset-0 bg-[url('/images/court.webp')] bg-cover bg-center opacity-20"></div>
      <!-- Animated gradient overlay -->
      <div class="absolute inset-0 bg-gradient-to-br from-cyan/5 via-transparent to-pink/5 animate-pulse"></div>
    </div>

    <!-- Content -->
    <div class="relative z-10 text-center px-6 max-w-2xl">
      <!-- Referral Badge -->
      <div class="inline-flex items-center gap-2 px-4 py-2 bg-cyan/10 border border-cyan/30 rounded-full mb-8">
        <span class="text-cyan text-sm font-mono">üê∫ You've been invited to the Draft</span>
      </div>

      <h1 class="font-display text-4xl md:text-6xl lg:text-7xl tracking-wider leading-none mb-6">
        <span class="text-shimmer block">JOIN THE</span>
        <span class="text-pink block">ALPHA 8</span>
      </h1>

      <p class="text-lg md:text-xl text-gray-300 mb-4">
        We're flying <span class="text-cyan font-bold">8 athletes</span> to LA to train with
        <span class="text-white">James Scott</span> + <span class="text-white">Adam Harrington</span>.
      </p>

      <p class="text-gray-500 mb-10">
        $4,999 value. Top referrers win. Your friend is already in the draft.
      </p>

      <button
        id="join-draft-btn"
        class="inline-block px-12 py-5 bg-pink text-white font-bold text-xl rounded-lg glow-pink hover:bg-cyan hover:text-wolf-black transition-all duration-300 transform hover:scale-105"
      >
        üê∫ ENTER THE DRAFT
      </button>

      <p class="mt-6 text-gray-600 text-sm">
        888 Founders Edition ¬∑ Limited spots
      </p>
    </div>
  </section>

  <!-- Waitlist App with referrer code -->
  <div id="waitlist-app">
    <WaitlistApp
      client:load
      convexUrl={convexUrl}
      showLeaderboard={false}
      referrerCode={isValidCode ? code?.toUpperCase() : undefined}
      autoOpen={true}
    />
  </div>
</Layout>

<script>
  // Auto-open modal on page load (after slight delay for UX)
  document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
      window.dispatchEvent(new CustomEvent('open-waitlist-modal'));
    }, 500);
  });

  // Also handle manual click
  document.getElementById('join-draft-btn')?.addEventListener('click', () => {
    window.dispatchEvent(new CustomEvent('open-waitlist-modal'));
  });
</script>

<style>
  .glow-pink {
    box-shadow: 0 0 30px rgba(255, 20, 147, 0.4);
  }

  .text-shimmer {
    background: linear-gradient(90deg, #00f6e0, #ffffff, #00f6e0);
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: shimmer 3s linear infinite;
  }

  @keyframes shimmer {
    0% { background-position: 0% center; }
    100% { background-position: 200% center; }
  }
</style>
