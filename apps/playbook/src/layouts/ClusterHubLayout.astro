---
import BaseLayout from "./BaseLayout.astro";
import Header from "../components/layout/Header.astro";
import Footer from "../components/layout/Footer.astro";
import Breadcrumb from "../components/layout/Breadcrumb.astro";
import ArticleSchema from "../components/seo/ArticleSchema.astro";

interface PageLink {
  title: string;
  description: string;
  url: string;
  badge?: string;
  icon?: string;
}

interface HubLink {
  title: string;
  url: string;
  icon?: string;
}

interface Props {
  title: string;
  description: string;
  canonical: string;
  breadcrumbs: { label: string; url?: string }[];
  clusterIcon?: string;
  clusterBadge?: string;
  featuredPages?: PageLink[];
  relatedHubs?: HubLink[];
  showSafetyDisclaimer?: boolean;
  author?: {
    name: string;
    jobTitle: string;
    description: string;
  };
  publishedDate?: Date;
  updatedDate?: Date;
  keywords?: string[];
}

const {
  title,
  description,
  canonical,
  breadcrumbs,
  clusterIcon = "ü¶∂",
  clusterBadge,
  featuredPages = [],
  relatedHubs = [],
  showSafetyDisclaimer = true,
  author = {
    name: "James Scott",
    jobTitle: "Movement Specialist & Foot Performance Coach",
    description: "Creator of Weak Feet Don't Eat ‚Ä¢ Barefoot Reset Developer",
  },
  publishedDate = new Date("2025-12-19"),
  updatedDate = new Date("2026-01-07"),
  keywords = ["barefoot training", "foot strength", "youth athletes"],
} = Astro.props;
---

<BaseLayout
  title={title}
  description={description}
  canonical={canonical}
  author={author.name}
  publishedDate={publishedDate}
  updatedDate={updatedDate}
  keywords={keywords}
>
  <Fragment slot="head">
    <ArticleSchema
      title={title}
      description={description}
      author={author}
      publishedDate={publishedDate}
      updatedDate={updatedDate}
      keywords={keywords}
      canonical={canonical}
    />
  </Fragment>

  <Header />
  <Breadcrumb items={breadcrumbs} />

  <!-- Hero Section -->
  <header class="px-3 py-6 relative" style="background: var(--gradient-dark);">
    <div class="absolute top-0 left-0 right-0 h-0.5" style="background: linear-gradient(90deg, var(--accent-primary) 0%, var(--accent-gold) 50%, var(--accent-primary) 100%);"></div>

    <div class="max-w-4xl mx-auto">
      <div class="flex items-center gap-2 mb-3">
        <div class="w-10 h-10 rounded-lg flex items-center justify-center text-display-md" style="background-color: var(--accent-primary);">
          {clusterIcon}
        </div>
        <div>
          {clusterBadge && (
            <span class="inline-block px-2 py-1 rounded-full font-mono text-label uppercase tracking-widest mb-1" style="background-color: var(--accent-primary); color: var(--bg-primary);">
              {clusterBadge}
            </span>
          )}
          <h1 class="font-bebas text-display-lg leading-tight" style="color: var(--text-primary);">
            {title}
          </h1>
        </div>
      </div>

      <p class="text-body-lg max-w-2xl mb-3" style="color: var(--text-secondary);">
        {description}
      </p>

      <!-- Quick nav to related hubs -->
      {relatedHubs.length > 0 && (
        <div class="flex flex-wrap gap-1.5">
          {relatedHubs.map((hub) => (
            <a
              href={hub.url}
              class="px-2 py-1 rounded-full text-body-sm font-medium transition-colors"
              style="background-color: var(--glass-bg); color: var(--text-primary); border: 1px solid var(--border-default);"
            >
              {hub.icon && <span class="mr-0.5">{hub.icon}</span>}
              {hub.title}
            </a>
          ))}
        </div>
      )}
    </div>
  </header>

  <!-- Safety Disclaimer -->
  {showSafetyDisclaimer && (
    <div class="px-3 py-2" style="background-color: rgba(245, 158, 11, 0.1); border-left: 4px solid var(--state-warning);">
      <div class="max-w-4xl mx-auto flex items-start gap-2">
        <span class="text-display-xs">‚ö†Ô∏è</span>
        <div class="text-body-sm">
          <strong style="color: var(--text-primary);">Safety First:</strong>
          <span style="color: var(--text-secondary);"> Stop any exercise if you experience sharp pain, numbness, or swelling. </span>
          <a href="/barefoot-training/safety/level-1-foundational/checklists/barefoot-red-flags-checklist" class="font-medium hover:underline" style="color: var(--accent-primary);">See Red Flags ‚Üí</a>
        </div>
      </div>
    </div>
  )}

  <!-- Main Content -->
  <main class="py-6 px-3">
    <div class="max-w-4xl mx-auto">
      <slot />

      <!-- Featured Pages Grid -->
      {featuredPages.length > 0 && (
        <section class="mt-6">
          <h2 class="font-mono text-label uppercase tracking-widest mb-3" style="color: var(--text-muted);">In This Section</h2>
          <div class="grid gap-2">
            {featuredPages.map((page) => (
              <a
                href={page.url}
                class="block rounded-lg p-2.5 transition-all hover:-translate-y-0.5"
                style="background-color: var(--bg-elevated); border: 1px solid var(--border-default);"
              >
                <div class="flex items-start gap-2">
                  {page.icon && (
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center text-display-xs flex-shrink-0" style="background: rgba(var(--accent-primary-rgb), 0.1);">
                      {page.icon}
                    </div>
                  )}
                  <div class="flex-1">
                    <div class="flex items-center gap-1.5 mb-0.5">
                      <h3 class="font-bebas text-body-md" style="color: var(--text-primary);">{page.title}</h3>
                      {page.badge && (
                        <span class="px-1 py-0.5 rounded text-label font-mono uppercase" style={page.badge === 'Essential' ? 'background-color: var(--accent-gold); color: #000;' : 'background-color: var(--bg-tertiary); color: var(--text-muted);'}>
                          {page.badge}
                        </span>
                      )}
                    </div>
                    <p class="text-body-sm" style="color: var(--text-muted);">{page.description}</p>
                  </div>
                  <span style="color: var(--text-muted);">‚Üí</span>
                </div>
              </a>
            ))}
          </div>
        </section>
      )}

      <!-- Back to Hub Links -->
      <nav class="mt-6 pt-4 border-t" style="border-color: var(--border-default);">
        <div class="flex flex-wrap gap-2 text-body-sm">
          <a href="/barefoot-training/" class="hover:underline flex items-center gap-0.5" style="color: var(--accent-primary);">
            ‚Üê Back to Barefoot Training Hub
          </a>
          <a href="/barefoot-training/start-here/" class="hover:underline flex items-center gap-0.5" style="color: var(--accent-primary);">
            Start Here Guide ‚Üí
          </a>
        </div>
      </nav>
    </div>
  </main>

  <Footer />
</BaseLayout>
