---
import BaseLayout from "./BaseLayout.astro";
import Header from "../components/layout/Header.astro";
import Footer from "../components/layout/Footer.astro";
import Breadcrumb from "../components/layout/Breadcrumb.astro";
import ArticleSchema from "../components/seo/ArticleSchema.astro";
import FAQSchema from "../components/seo/FAQSchema.astro";
import DirectAnswer from "../components/content/DirectAnswer.astro";

interface FAQ {
  question: string;
  answer: string;
}

interface RelatedLink {
  title: string;
  url: string;
  description?: string;
}

interface Props {
  // Core metadata
  title: string;
  description: string;
  canonical: string;
  breadcrumbs: { label: string; url?: string }[];

  // Content type
  contentType: "Guide" | "Checklist" | "MythBuster" | "InjuryGuide" | "Plan" | "Research";

  // Cluster
  cluster: "safety" | "transition" | "injury-rehab" | "research" | "plans";

  // TL;DR / Direct Answer
  tldr: string;

  // Author
  author?: {
    name: string;
    jobTitle: string;
    description: string;
    sameAs?: string[];
  };

  // Dates
  publishedDate?: Date;
  updatedDate?: Date;

  // SEO
  keywords?: string[];

  // FAQ (optional)
  faqs?: FAQ[];

  // Internal linking (required baseline + optional extras)
  relatedReading?: RelatedLink[];

  // Flags
  showSafetyDisclaimer?: boolean;
  showCitations?: boolean;
}

const {
  title,
  description,
  canonical,
  breadcrumbs,
  contentType,
  cluster,
  tldr,
  author = {
    name: "James Scott",
    jobTitle: "Movement Specialist & Foot Performance Coach",
    description: "Creator of Weak Feet Don't Eat ‚Ä¢ Barefoot Reset Developer",
    sameAs: ["https://www.instagram.com/weakfeetdonteat/"],
  },
  publishedDate = new Date("2025-12-19"),
  updatedDate = new Date("2026-01-07"),
  keywords = [],
  faqs = [],
  relatedReading = [],
  showSafetyDisclaimer = true,
} = Astro.props;

// Content type badges
const contentTypeBadges: Record<string, { label: string; icon: string }> = {
  Guide: { label: "Guide", icon: "üìñ" },
  Checklist: { label: "Checklist", icon: "‚úÖ" },
  MythBuster: { label: "Myth Buster", icon: "üîç" },
  InjuryGuide: { label: "Injury Guide", icon: "ü©π" },
  Plan: { label: "Program", icon: "üìÖ" },
  Research: { label: "Research", icon: "üìö" },
};

// Cluster hub URLs for baseline linking
const clusterHubs: Record<string, { url: string; label: string }> = {
  safety: { url: "/barefoot-training/safety/", label: "Safety Hub" },
  transition: { url: "/barefoot-training/transition/", label: "Transition Guide" },
  "injury-rehab": { url: "/barefoot-training/injury-rehab/", label: "Injury Rehab" },
  research: { url: "/barefoot-training/research/", label: "Research Hub" },
  plans: { url: "/barefoot-training/start-here/", label: "Start Here" },
};

// Recommended plan based on cluster
const recommendedPlan =
  cluster === "transition"
    ? {
        url: "/barefoot-training/transition/level-2-core-skills/8-week-plan/8-week-minimal-shoe-transition-youth",
        label: "8-Week Transition Plan",
      }
    : { url: "/barefoot-training/plans/5-min-foot-primer", label: "5-Min Foot Primer" };

const typeBadge = contentTypeBadges[contentType];
const clusterHub = clusterHubs[cluster];
---

<BaseLayout
  title={title}
  description={description}
  canonical={canonical}
  author={author.name}
  publishedDate={publishedDate}
  updatedDate={updatedDate}
  keywords={keywords}
>
  <Fragment slot="head">
    <ArticleSchema
      title={title}
      description={description}
      author={author}
      publishedDate={publishedDate}
      updatedDate={updatedDate}
      keywords={keywords}
      canonical={canonical}
    />
    {faqs.length > 0 && <FAQSchema faqs={faqs} />}
  </Fragment>

  <Header />
  <Breadcrumb items={breadcrumbs} />

  <!-- Hero Section -->
  <header class="px-3 py-5 relative" style="background: var(--gradient-dark);">
    <div class="absolute top-0 left-0 right-0 h-0.5" style="background: linear-gradient(90deg, var(--accent-primary) 0%, var(--accent-gold) 50%, var(--accent-primary) 100%);"></div>

    <div class="max-w-3xl mx-auto">
      <!-- Content type badge -->
      <div class="flex items-center gap-2 mb-2">
        <span class="px-2 py-1 rounded-full font-mono text-label uppercase tracking-widest flex items-center gap-0.5" style="background-color: var(--accent-primary); color: var(--bg-primary);">
          <span>{typeBadge.icon}</span>
          <span>{typeBadge.label}</span>
        </span>
        <a href={clusterHub.url} class="text-body-xs transition-colors" style="color: var(--text-muted);">
          {clusterHub.label} ‚Üí
        </a>
      </div>

      <h1 class="font-bebas text-display-md leading-tight mb-2" style="color: var(--text-primary);">
        {title}
      </h1>

      <!-- Meta info -->
      <div class="flex flex-wrap gap-2 items-center text-body-sm mb-3" style="color: var(--text-muted);">
        <time datetime={updatedDate.toISOString()}>
          Updated {updatedDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
        </time>
        <span>‚Ä¢</span>
        <span>By {author.name}</span>
      </div>

      <!-- TL;DR / Direct Answer (Answer-First) -->
      <DirectAnswer>
        <p set:html={tldr} />
      </DirectAnswer>
    </div>
  </header>

  <!-- Safety Disclaimer -->
  {showSafetyDisclaimer && (
    <div class="px-3 py-2" style="background-color: rgba(245, 158, 11, 0.1); border-left: 4px solid var(--state-warning);">
      <div class="max-w-3xl mx-auto flex items-start gap-2">
        <span class="text-display-xs">‚ö†Ô∏è</span>
        <div class="text-body-sm">
          <strong style="color: var(--text-primary);">Safety First:</strong>
          <span style="color: var(--text-secondary);"> Stop any exercise if you experience sharp pain, numbness, or swelling. </span>
          <a href="/barefoot-training/safety/level-1-foundational/checklists/barefoot-red-flags-checklist" class="font-medium hover:underline" style="color: var(--accent-primary);">See Red Flags ‚Üí</a>
        </div>
      </div>
    </div>
  )}

  <!-- Main Content -->
  <main class="py-5 px-3">
    <article class="max-w-3xl mx-auto prose prose-lg max-w-none">
      <slot />
    </article>

    <!-- Related Reading -->
    {relatedReading.length > 0 && (
      <aside class="max-w-3xl mx-auto mt-6 pt-4 border-t" style="border-color: var(--border-default);">
        <h2 class="font-mono text-label uppercase tracking-widest mb-2" style="color: var(--text-muted);">Related Reading</h2>
        <div class="grid gap-2">
          {relatedReading.map((link) => (
            <a
              href={link.url}
              class="block rounded-lg p-2 transition-all hover:-translate-y-0.5"
              style="background-color: var(--bg-elevated); border: 1px solid var(--border-default);"
            >
              <div class="font-bebas text-body-md mb-0.5" style="color: var(--text-primary);">{link.title}</div>
              {link.description && <p class="text-body-sm" style="color: var(--text-muted);">{link.description}</p>}
            </a>
          ))}
        </div>
      </aside>
    )}

    <!-- Baseline Internal Links (always present) -->
    <nav class="max-w-3xl mx-auto mt-6 p-3 rounded-lg" style="background-color: var(--bg-tertiary);">
      <h2 class="font-mono text-label uppercase tracking-widest mb-2" style="color: var(--text-muted);">Explore More</h2>
      <div class="grid md:grid-cols-2 gap-2 text-body-sm">
        <div class="space-y-1">
          <a href="/barefoot-training/" class="block hover:underline" style="color: var(--accent-primary);">‚Üê Barefoot Training Hub</a>
          <a href="/barefoot-training/start-here/" class="block hover:underline" style="color: var(--accent-primary);">Start Here Guide</a>
          <a href={clusterHub.url} class="block hover:underline" style="color: var(--accent-primary);">{clusterHub.label}</a>
        </div>
        <div class="space-y-1">
          <a href="/barefoot-training/research/" class="block hover:underline" style="color: var(--accent-primary);">Research Hub</a>
          <a href={recommendedPlan.url} class="block hover:underline" style="color: var(--accent-primary);">{recommendedPlan.label}</a>
          <a href="/barefoot-training/safety/level-1-foundational/checklists/barefoot-red-flags-checklist" class="block hover:underline" style="color: var(--accent-primary);">Red Flags Checklist</a>
        </div>
      </div>
    </nav>
  </main>

  <Footer />
</BaseLayout>
