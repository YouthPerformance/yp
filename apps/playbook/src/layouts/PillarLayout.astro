---
import BaseLayout from './BaseLayout.astro';
import Breadcrumb from '@/components/layout/Breadcrumb.astro';
import Footer from '@/components/layout/Footer.astro';
import DirectAnswer from '@/components/content/DirectAnswer.astro';
import KeyTakeaways from '@/components/content/KeyTakeaways.astro';
import ExpertBox from '@/components/content/ExpertBox.astro';
import ArticleSchema from '@/components/seo/ArticleSchema.astro';
import FAQSchema from '@/components/seo/FAQSchema.astro';

interface Props {
  frontmatter: {
    title: string;
    description: string;
    author: string;
    publishedDate: Date;
    updatedDate: Date;
    readTime: string;
    directAnswer: string;
    keyTakeaways: string[];
    category: string;
    keywords: string[];
    canonical: string;
    theme: 'basketball' | 'barefoot';
    programBadge?: string;
  };
  authorData: {
    name: string;
    initials: string;
    tagline?: string;
    credentials: string[];
    socialLinks?: {
      instagram?: string;
      twitter?: string;
      wikipedia?: string;
    };
  };
  breadcrumbs: { label: string; url?: string }[];
  faqs?: { question: string; answer: string }[];
  toc?: { id: string; label: string }[];
}

const { frontmatter, authorData, breadcrumbs, faqs = [], toc = [] } = Astro.props;

const {
  title,
  description,
  publishedDate,
  updatedDate,
  readTime,
  directAnswer,
  keyTakeaways,
  keywords,
  canonical,
  theme,
  programBadge,
} = frontmatter;

// Theme-specific styles
const heroGradient = theme === 'barefoot'
  ? 'from-earth-dark to-earth'
  : 'from-paper-dark to-paper';
const heroBorder = theme === 'barefoot' ? 'border-copper' : 'border-gold';
const heroTopBorder = theme === 'barefoot'
  ? 'from-moss via-copper to-moss'
  : 'from-gold via-action-orange to-gold';

// Build credentials string
const credentialsStr = authorData.credentials.join(' • ');

// Build social links for schema
const sameAs = [
  authorData.socialLinks?.instagram,
  authorData.socialLinks?.twitter,
  authorData.socialLinks?.wikipedia,
].filter(Boolean) as string[];
---

<BaseLayout
  title={title}
  description={description}
  canonical={canonical}
  theme={theme}
  author={authorData.name}
  publishedDate={publishedDate}
  updatedDate={updatedDate}
  keywords={keywords}
>
  <Fragment slot="head">
    <ArticleSchema
      title={title}
      description={description}
      author={{
        name: authorData.name,
        jobTitle: authorData.credentials[0],
        description: credentialsStr,
        sameAs,
      }}
      publishedDate={publishedDate}
      updatedDate={updatedDate}
      keywords={keywords}
      canonical={canonical}
    />
    {faqs.length > 0 && <FAQSchema faqs={faqs} />}
  </Fragment>

  <Breadcrumb items={breadcrumbs} />

  <!-- Hero Section -->
  <header class={`bg-gradient-to-b ${heroGradient} px-6 py-12 pb-8 border-b-[3px] ${heroBorder} relative`}>
    <!-- Top gradient line -->
    <div class={`absolute top-0 left-0 right-0 h-1 bg-gradient-to-r ${heroTopBorder}`}></div>

    <div class="container-article">
      {programBadge && (
        <span class={`inline-block ${theme === 'barefoot' ? 'bg-moss' : 'bg-trust-blue'} text-white px-3 py-1.5 rounded-full font-mono text-[0.65rem] uppercase tracking-widest mb-4`}>
          {programBadge}
        </span>
      )}

      <h1 class="font-display text-3xl md:text-4xl font-bold leading-tight mb-4">
        {title}
      </h1>

      <div class="flex flex-wrap gap-4 items-center text-sm text-ink-muted mb-6">
        <time datetime={updatedDate.toISOString()}>
          Updated {updatedDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}
        </time>
        <span>•</span>
        <span>{readTime}</span>
        <span>•</span>
        <span>Expert Reviewed</span>
      </div>

      <!-- Direct Answer -->
      <DirectAnswer theme={theme}>
        <p set:html={directAnswer} />
      </DirectAnswer>

      <!-- Key Takeaways -->
      <KeyTakeaways takeaways={keyTakeaways} theme={theme} />

      <!-- Expert Box -->
      <ExpertBox
        name={authorData.name}
        initials={authorData.initials}
        tagline={authorData.tagline}
        credentials={credentialsStr}
        theme={theme}
      />
    </div>
  </header>

  <!-- Table of Contents -->
  {toc.length > 0 && (
    <div class="container-article">
      <nav class="bg-paper-dark p-6 rounded-md my-8" aria-label="Table of Contents">
        <h2 class="font-display text-base mb-4">In This Guide</h2>
        <ol class="pl-5 space-y-2">
          {toc.map((item) => (
            <li class="text-[0.95rem]">
              <a href={`#${item.id}`} class="text-trust-blue-light hover:underline">{item.label}</a>
            </li>
          ))}
        </ol>
      </nav>
    </div>
  )}

  <!-- Main Content -->
  <main class="py-8">
    <div class="container-article prose prose-lg max-w-none">
      <slot />
    </div>
  </main>

  <Footer theme={theme} />
</BaseLayout>
