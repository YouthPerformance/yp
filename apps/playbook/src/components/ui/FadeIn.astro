---
/**
 * FadeIn Component
 * YP Design System - Playbook
 *
 * Scroll-triggered fade-in animation using Intersection Observer.
 * Native CSS/JS - no React/Framer Motion dependencies.
 *
 * @prop delay - Animation delay in ms (default 0)
 * @prop duration - Animation duration in ms (default 600)
 * @prop direction - 'up' | 'down' | 'left' | 'right' | 'none'
 * @prop distance - Distance to travel in px (default 30)
 * @prop threshold - Intersection threshold 0-1 (default 0.1)
 * @prop once - Only animate once (default true)
 * @prop as - HTML element type (default 'div')
 */

interface Props {
  delay?: number;
  duration?: number;
  direction?: "up" | "down" | "left" | "right" | "none";
  distance?: number;
  threshold?: number;
  once?: boolean;
  as?: keyof HTMLElementTagNameMap;
  class?: string;
}

const {
  delay = 0,
  duration = 600,
  direction = "up",
  distance = 30,
  threshold = 0.1,
  once = true,
  as: Element = "div",
  class: className = "",
} = Astro.props;

// Calculate initial transform
const transforms = {
  up: `translateY(${distance}px)`,
  down: `translateY(-${distance}px)`,
  left: `translateX(${distance}px)`,
  right: `translateX(-${distance}px)`,
  none: "none",
};
---

<Element
  class={`fade-in-element ${className}`}
  data-fade-in
  data-threshold={threshold}
  data-once={once}
  style={`
    opacity: 0;
    transform: ${transforms[direction]};
    transition: opacity ${duration}ms ease-out ${delay}ms, transform ${duration}ms ease-out ${delay}ms;
  `}
>
  <slot />
</Element>

<style is:global>
  .fade-in-element[data-visible="true"] {
    opacity: 1 !important;
    transform: none !important;
  }
</style>

<script>
  function initFadeIn() {
    const elements = document.querySelectorAll("[data-fade-in]");

    if (!elements.length) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.setAttribute("data-visible", "true");

            // Unobserve if once is true
            const once = entry.target.getAttribute("data-once") === "true";
            if (once) {
              observer.unobserve(entry.target);
            }
          } else {
            // Reset if not once
            const once = entry.target.getAttribute("data-once") === "true";
            if (!once) {
              entry.target.setAttribute("data-visible", "false");
            }
          }
        });
      },
      {
        rootMargin: "0px 0px -50px 0px",
        threshold: 0.1,
      }
    );

    elements.forEach((el) => {
      observer.observe(el);
    });
  }

  // Run on load and on Astro page transitions
  document.addEventListener("DOMContentLoaded", initFadeIn);
  document.addEventListener("astro:page-load", initFadeIn);
</script>
