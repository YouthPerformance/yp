---
/**
 * ScrollProgress Component
 * YP Design System - Playbook
 *
 * Fixed progress bar at top of viewport showing reading progress.
 * Uses native JS - no React/Framer Motion dependencies.
 *
 * @prop variant - 'cyan' | 'gold' | 'gradient'
 * @prop height - Bar height in pixels
 * @prop zIndex - z-index value (default 9999)
 */

interface Props {
  variant?: "cyan" | "gold" | "gradient";
  height?: number;
  zIndex?: number;
}

const { variant = "cyan", height = 3, zIndex = 9999 } = Astro.props;

// Variant styles for the fill
const variantStyles = {
  cyan: "background: var(--accent-primary);",
  gold: "background: var(--accent-gold);",
  gradient:
    "background: linear-gradient(90deg, var(--accent-primary) 0%, var(--accent-gold) 100%);",
};
---

<div
  class="scroll-progress"
  style={`height: ${height}px; z-index: ${zIndex};`}
  aria-hidden="true"
>
  <div
    class="scroll-progress-fill"
    id="scroll-progress-fill"
    style={variantStyles[variant]}
  />
</div>

<style>
  .scroll-progress {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: transparent;
    pointer-events: none;
  }

  .scroll-progress-fill {
    height: 100%;
    width: 0%;
    border-radius: 0 2px 2px 0;
    transition: width 50ms ease-out;
    box-shadow: 0 0 10px rgba(0, 246, 224, 0.5);
  }
</style>

<script>
  function initScrollProgress() {
    const fill = document.getElementById("scroll-progress-fill");
    if (!fill) return;

    let ticking = false;

    function updateProgress() {
      const scrollTop = window.scrollY;
      const docHeight =
        document.documentElement.scrollHeight - window.innerHeight;
      const progress = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;

      fill.style.width = `${Math.min(100, Math.max(0, progress))}%`;
      ticking = false;
    }

    window.addEventListener(
      "scroll",
      () => {
        if (!ticking) {
          requestAnimationFrame(updateProgress);
          ticking = true;
        }
      },
      { passive: true }
    );

    // Initial update
    updateProgress();
  }

  // Run on load and on Astro page transitions
  document.addEventListener("DOMContentLoaded", initScrollProgress);
  document.addEventListener("astro:page-load", initScrollProgress);
</script>
